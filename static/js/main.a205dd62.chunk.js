(this["webpackJsonpexcel-web"]=this["webpackJsonpexcel-web"]||[]).push([[0],{140:function(e,t,r){e.exports=r.p+"static/media/github.741c0ae1.svg"},142:function(e,t,r){e.exports=r.p+"static/media/main-bg.197637b0.png"},143:function(e,t,r){e.exports=r.p+"static/media/login-input-bg.cf01c34c.png"},155:function(e,t,r){e.exports=r(275)},164:function(e,t,r){},230:function(e,t,r){},237:function(e,t,r){},239:function(e,t,r){},242:function(e,t,r){},247:function(e,t,r){},261:function(e,t,r){},264:function(e,t,r){},273:function(e,t,r){},274:function(e,t,r){},275:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(8),i=r.n(o),c=r(77),l=r(20),s=(r(164),r(14)),u=r(15),p=r(17),d=r(16),h=r(18),f=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).createSrc=function(){var e=r.props.options,t=e.goto,n=e.style,a=e.href,o=r.state.url+encodeURIComponent(t);return o+=n?"&style="+n:"",o+=a?"&href="+a:""},r.state={url:"https://login.dingtalk.com/login/qrcode.htm?goto="},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e={id:this.props.options.id,src:this.createSrc(),frameBorder:"0",allowtransparency:"true",scrolling:"no",width:this.props.options.width,height:this.props.options.height,className:this.props.className};return a.a.createElement("iframe",e)}}]),t}(a.a.Component);f.defaultProps={options:{id:"login_container",goto:"",style:"",href:"",width:"350px",height:"350px"},className:""};var g=f,b=r(39),m=r.n(b),v=r(19),y=r(63),O="DINGDING_LOGIN",E="GITHUB_LOGIN",w="USER_LOGOUT",j="RECEIVE_USER_INFO",D=(r(166),r(106)),x=r(137),P=r.n(x),C=r(31),S=r.n(C),k={postDinging:function(){return new Promise((function(e){S.a.remove("loginCookie",{path:"/"}),setTimeout((function(){var t={userInfo:{errcode:0,username:"DingUser",avatarUrl:"https://gtms03.alicdn.com/tps/i3/TB1opXxHXXXXXahXpXXvBLt6FXX-230-230.png"}};S.a.save("loginCookie",window.btoa(JSON.stringify(t)),{path:"/"}),e(t)}),300)}))}};k.getGithub=function(){var e=Object(y.a)(m.a.mark((function e(t){var r,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={userInfo:{errcode:0}},e.prev=1,e.next=4,P.a.get("https://api.github.com/users/".concat(t));case 4:n=e.sent,S.a.remove("loginCookie",{path:"/"}),void 0!==n.data.login?(r.userInfo.username=n.data.login,r.userInfo.avatarUrl=n.data.avatar_url,S.a.save("loginCookie",window.btoa(JSON.stringify(r)),{path:"/"})):(D.a.error("User name not found."),r.errcode=-1),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),D.a.error("User name not found.");case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();var I=k;function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _=function(e){return{type:j,data:e}},A=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={APPID:"dingoauctaoft7kia4pdvx",REDIRECT_URI:"https://gaobowen.github.io/excel-web/login/dingding"},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"UNSAFE_componentWillMount",value:function(){if(void 0!==this.props.location.search)if(-1===this.props.location.search.indexOf("dinglogin"));else{for(var e=this.props.location.search.replace("?","").split("&"),t={},r=0;r<e.length;r++){var n=e[r].split("=");t[n[0].toString()]=n[1]}this.props.loginDingding({})}}},{key:"componentDidMount",value:function(){var e=this,t=function(t){"https://login.dingtalk.com"===t.origin&&e.props.loginDingding({})};"undefined"!=typeof window.addEventListener?window.addEventListener("message",t,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onmessage",t)}},{key:"loginDingding",value:function(){console.log("loginDingding")}},{key:"render",value:function(){var e={id:"login-container",goto:"https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=".concat(this.state.APPID,"&response_type=code&scope=snsapi_login&state=dinglogin&redirect_uri=").concat(this.state.REDIRECT_URI),width:"350px",height:"350px"};return a.a.createElement("div",{id:"login-container",style:{opacity:.78}},a.a.createElement(g,{options:e}))}}]),t}(a.a.Component),M=Object(l.b)((function(e){return{login:e.login}}),{loginDingding:function(e){return function(){var t=Object(y.a)(m.a.mark((function t(r){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.postDinging(e);case 2:n=t.sent,console.log(n),r(_(T({},n)));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(A),X=(r(74),r(34)),L=(r(227),r(151)),R=(r(127),r(79)),H=r(140),G=r.n(H),U=(r(230),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).loginGithub=function(){r.props.loginGithub(r.userName)},r.handleChange=function(e){r.userName=e.target.value},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{style:{width:"100%",height:"100%"}},a.a.createElement(R.a,{src:G.a,size:64,className:"login-github-svg"}),a.a.createElement("div",{className:"login-username-text"},"Github User Name"),a.a.createElement(L.a,{className:"login-username-input",placeholder:"User Name",onChange:this.handleChange,onPressEnter:this.loginGithub}),a.a.createElement(X.a,{type:"primary",className:"login-github-btn",onClick:this.loginGithub},"Login"))}}]),t}(a.a.Component)),z=Object(l.b)((function(e){return{login:e.login}}),{loginGithub:function(e){return function(){var t=Object(y.a)(m.a.mark((function t(r){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.getGithub(e);case 2:n=t.sent,r(_(T({},n)));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(U),K=r(45),W=(r(237),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).changeLoginMode=function(e){var t="tab-li-github"===e.target.id?"github":"dingding";r.props.history.replace("/excel-web/login/"+t),r.setState({options:{loginMode:t}})},r.state={options:{loginMode:"dingding"}},void 0!==e.location&&("/excel-web/login/github"===e.location.pathname?e.options.loginMode="github":e.options.loginMode="dingding"),r.state.options.loginMode=e.options.loginMode,r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"login-view"},a.a.createElement("div",{className:"tab-div"},a.a.createElement("ul",{className:"tabs"},a.a.createElement("li",{id:"tab-li-dingding",className:"dingding"===this.state.options.loginMode?"tab-item current":"tab-item",onClick:this.changeLoginMode},"Dingding"),a.a.createElement("li",{id:"tab-li-github",className:"dingding"===this.state.options.loginMode?"tab-item":"tab-item current",onClick:this.changeLoginMode},"Github"))),a.a.createElement("div",{className:"login-view-content",key:this.props.location.key},a.a.createElement(K.d,null,a.a.createElement(K.b,{path:"/excel-web/login/dingding",component:M}),a.a.createElement(K.b,{path:"/excel-web/login/github",component:z}),a.a.createElement(K.a,{to:"/excel-web/login/dingding"}))))}}]),t}(a.a.Component));W.defaultProps={options:{loginMode:"dingding"}};var B=Object(K.g)(W),Y=r(142),F=r.n(Y),J=r(143),V=r.n(J),Z=(r(239),function(e){function t(e){var r;Object(s.a)(this,t),r=Object(p.a)(this,Object(d.a)(t).call(this,e));var n=S.a.load("loginCookie");if(void 0!==n){var a=window.atob(n),o=JSON.parse(a);void 0!==o.userInfo.username&&r.props.receiveUserInfo(o)}return r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){void 0!==this.props.userInfo.username&&this.props.history.replace("/excel-web/sheet",this.state)}},{key:"componentDidUpdate",value:function(){void 0!==this.props.userInfo.username&&this.props.history.replace("/excel-web/sheet",this.state)}},{key:"render",value:function(){return void 0!==this.props.userInfo.username?a.a.createElement("div",null):a.a.createElement("div",null,a.a.createElement("div",{className:"bgdiv"},a.a.createElement("img",{className:"bgimg",src:F.a,alt:"loginbgimg"})),a.a.createElement("div",{className:"logincontainer"},a.a.createElement("div",null,a.a.createElement("div",{className:"loginviewbg outradius"},a.a.createElement("img",{className:"loginviewbgimg",src:V.a,alt:""})),a.a.createElement(B,null))))}}]),t}(a.a.Component)),q=Object(l.b)((function(e){return{userInfo:e.login.userInfo}}),{receiveUserInfo:_})(Z),$=r(66),Q=r(144),ee=r.n(Q),te=function(e){return{type:"CHANGED_EXCEL_SIZE",data:e}},re=function(e){return{type:"CHANGE_EXCEL_SHEET_SELECTED",data:e}},ne=function(e){return{type:"HIT_TEST_OPERATE",data:e}};r(242);function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var oe=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).getCoordinates=function(e){var t=e.match(/[0-9]+/g)||[],r=e.match(/[A-Z]+/g)||[];if(1===t.length&&1===r.length){for(var n=r[0].toString(),a="A".charCodeAt(),o=0,i=0;i<n.length;i++){var c=n[i].charCodeAt()-a+1;o+=Math.pow(26,n.length-i-1)*c}return{x:o-1,y:parseInt(t[0])-1}}},r.getPositionStr=function(e){var t=parseInt(e.x);return r.getPositionStrX(t)+(e.y+1)},r.getPositionStrX=function(e){if(e<0)throw Error("Error getPositionStrX inputX < 0");var t="A".charCodeAt(0),r=e+1,n="";do{var a=r-1,o=a%26;n=String.fromCharCode(t+o)+n,r=parseInt(a/26)}while(r>0);return n},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return this.grid=this.props.gridDatas.dic[this.props.gridDatas.selectedKey].grid,this.totalWidth=60*this.grid[0].length,this.totalHeight=22*this.grid.length,this.totalWidth===this.props.excelSheet.width&&this.totalHeight===this.props.excelSheet.height||this.props.changedExcelSize({width:this.totalWidth,height:this.totalHeight}),a.a.createElement("div",{style:{width:this.totalWidth}},a.a.createElement(ee.a,{data:this.grid,valueRenderer:function(e){return e.value},onContextMenu:function(e,t,r,n){return t.readOnly?e.preventDefault():null},onCellsChanged:function(t){var r=e.grid.map((function(e){return Object($.a)(e)}));t.forEach((function(t){var n=t.row,a=t.col,o=t.value;e.grid[n][a]=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r[n][a],{value:o})})),e.render()}}))}}]),t}(a.a.Component),ie=Object(l.b)((function(e){return{gridDatas:e.gridDatas,excelSheet:e.excelSheet}}),{changedExcelSize:te,changeExcelSheetSelected:re})(oe),ce=(r(243),r(152)),le=(r(276),r(80)),se=(r(247),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).download=function(){r.props.downloadExcel()},r.state={},r.handleMenuClick=function(e){"2"===e.key&&(r.props.logout({}),window.open(encodeURI("http://"+window.location.host+"/excel-web"),"_parent"))},r.state.downMenu=a.a.createElement(le.a,{onClick:r.handleMenuClick},a.a.createElement(le.a.Item,{className:"menu-item",key:"1"},r.props.login.userInfo.username),a.a.createElement(le.a.Item,{className:"menu-item",key:"2"},"Logout")),r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"user-header"},a.a.createElement("div",{className:"header-title"},"Technology Changes Lives"),a.a.createElement("div",{className:"items"},a.a.createElement(ce.a,{overlay:this.state.downMenu,className:"item avatar"},a.a.createElement(R.a,{size:40,src:this.props.login.userInfo.avatarUrl,className:"item avatar"})),a.a.createElement("div",{className:"item split"}),a.a.createElement(X.a,{type:"primary",icon:"download",className:"item btn",onClick:this.download},"Download")))}}]),t}(a.a.Component)),ue=Object(l.b)((function(e){return e}),{logout:function(e){return{type:w,data:e}},downloadExcel:function(e){return{type:"DOWNLOAD_EXCEL",data:e}}})(se),pe=(r(259),r(10)),de=(r(261),function(e){function t(){var e,r;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).iconbtn=function(e,t){return a.a.createElement("div",{className:"item",key:t},a.a.createElement(pe.a,{type:e}))},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"tools-header"},a.a.createElement("div",{className:"item split"}),["edit","copy","delete","align-center","align-left","align-right","bg-colors","bold","italic","underline","font-colors","font-size"].map((function(t,r){return e.iconbtn(t,r)})),a.a.createElement("div",{className:"item split"}),["area-chart","pie-chart","bar-chart","dot-chart","line-chart","radar-chart","fund"].map((function(e,t){return a.a.createElement("div",{className:"item",key:"chart"+t},a.a.createElement(pe.a,{type:e}))})),a.a.createElement("div",{className:"item split"}),["line-height","column-width","column-height","sort-ascending","sort-descending"].map((function(e,t){return a.a.createElement("div",{className:"item",key:"editExts"+t},a.a.createElement(pe.a,{type:e}))})))}}]),t}(a.a.Component)),he=Object(l.b)((function(e){return e}),{})(de),fe=(r(262),r(105)),ge=(r(264),fe.a.TabPane),be={refObj:null,eleType:"cell",hit:{x:60,y:22},rect:{x:60,y:22,r:0,width:60,height:22},preRect:{x:60,y:22,r:0,width:60,height:22}},me=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChange=function(e){r.props.changeExcelSheetSelected({key:e}),r.props.hitTestOperate({ctrlData:be})},r.onEdit=function(e,t){r[t](e),r.props.hitTestOperate({ctrlData:be})},r.add=function(){r.props.addExcelSheet()},r.remove=function(e){r.props.removeExcelSheet({key:e})},r.componentDidMount=function(){},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e in this.panes=[],this.props.gridDatas.dic)this.panes.push({title:this.props.gridDatas.dic[e].name,content:"",key:e});return a.a.createElement("div",{className:"tools-footer"},a.a.createElement(fe.a,{onChange:this.onChange,activeKey:this.props.gridDatas.selectedKey,type:"editable-card",onEdit:this.onEdit},this.panes.map((function(e){return a.a.createElement(ge,{tab:e.title,key:e.key},e.content)}))))}}]),t}(a.a.Component),ve=Object(l.b)((function(e){return{gridDatas:e.gridDatas}}),{addExcelSheet:function(e){return{type:"ADD_EXCEL_SHEET",data:e}},removeExcelSheet:function(e){return{type:"REMOVE_EXCEL_SHEET",data:e}},changeExcelSheetName:function(e){return{type:"CHANGE_EXCEL_SHEET_NAME",data:e}},changeExcelSheetSelected:re,hitTestOperate:ne})(me),ye={offsetX:0,offsetY:0},Oe={offsetHeight:0},Ee=function(e,t){return{x:e+ye.offsetX,y:t-Oe.offsetHeight+ye.offsetY}},we={x:0,y:0,isDrag:!1,start:function(e,t){this.isDrag=!0,this.x=e,this.y=t},changed:function(e,t){if(!this.isDrag)return this.x=0,this.y=0,{dx:0,dy:0};var r=e-this.x,n=t-this.y;return this.x=e,this.y=t,{dx:r,dy:n}},completed:function(){this.x=0,this.y=0,this.isDrag=!1}},je={callback:function(){}},De=r(153);function xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xe(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xe(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ce=Object(l.b)((function(e){return{ctrlData:e.ctrlData}}),{sortMediaElements:function(e){return{type:"SORT_MEDIA_ELEMENTS",data:e}},hitTestOperate:ne})((function(e){var t=Object(n.useState)(e.data),r=Object(De.a)(t,2),o=(r[0],r[1]),i=Object(n.useRef)(null),c=function(t){e.data.rect=Pe({},t),e.data.location=t,i.current.style.left="".concat(t.x,"px"),i.current.style.top="".concat(t.y,"px"),i.current.style.width="".concat(t.width,"px"),i.current.style.height="".concat(t.height,"px")},l={backgroundColor:"#00000088",position:"absolute",left:"".concat(e.data.location.x,"px"),top:"".concat(e.data.location.y,"px"),zIndex:e.data.zIndex};if(!e.data.rect){var s=new Image;s.src=e.data.src,s.onload=function(){var t=s.width,r=s.height;if(e.data.originalSize={width:t,height:r},t>500){var n=r/t;t=500,r=500*n}if(r>500){var a=t/r;r=500,t=500*a}e.data.rect={x:0,y:0},e.data.rect.x=e.data.location.x-t/2,e.data.rect.y=e.data.location.y-r/2,e.data.rect.width=t,e.data.rect.height=r,e.data.location.x=e.data.rect.x,e.data.location.y=e.data.rect.y,o(Pe({},e.data))}}return e.data&&e.data.rect&&(l.left="".concat(e.data.rect.x,"px"),l.top="".concat(e.data.rect.y,"px"),l.width="".concat(e.data.rect.width,"px"),l.height="".concat(e.data.rect.height,"px")),console.log("ImageView render",e),a.a.createElement("div",{style:Pe({},l),ref:i,"\u03bfndragstart":"return false;",draggable:"false",onClick:function(e){e.stopPropagation(),e.preventDefault()},onMouseDown:function(t){t.stopPropagation(),t.preventDefault(),e.data.zIndex=9990,i.current.style.zIndex=9990,e.sortMediaElements(),je.callback(),e.hitTestOperate({ctrlData:{refObj:{current:i.current,divRef:i,onChangeRect:c,data:e.data},eleType:"media",hit:{x:e.data.rect.x,y:e.data.rect.y},rect:Pe({r:0},e.data.rect)}})},onMouseUp:function(t){o(e.data),t.stopPropagation(),t.preventDefault()},onLoad:function(){e.data.autoSeleted&&(e.data.autoSeleted=!1,e.hitTestOperate({ctrlData:{refObj:{current:i.current,onChangeRect:c,data:e.data},eleType:"media",hit:{x:e.data.rect.x,y:e.data.rect.y},rect:Pe({r:0},e.data.rect)}}))}},a.a.createElement("img",{src:e.data.src,width:"100%",height:"100%","\u03bfndragstart":"return false;",draggable:"false"}))})),Se=function(e){function t(){var e,r;Object(s.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).getStamp=function(){return(new Date).getTime().toString()+parseInt(100*Math.random())},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){je.callback=function(){},console.log("MediaContainer",this.props);var e=this.props.media.map((function(e,t){return a.a.createElement(Ce,{data:e,key:t})}));return a.a.createElement(a.a.Fragment,null,e)}}]),t}(a.a.Component),ke=Object(l.b)((function(e){var t=e.gridDatas.selectedKey,r=[];return t&&(r=e.gridDatas.dic[t].media),{media:r}}),{})(Se);function Ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ie(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ie(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Te=function(e){var t={display:"cell"===e.ctrlData.eleType?"block":"none",backgroundColor:"#00000000",color:"#33333",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",opacity:"0"},r=!1,n=function(e,t){t?(r=!0,e.setAttribute("contentEditable","plaintext-only"),e.style.opacity="1",e.focus()):(e.blur(),e.setAttribute("contentEditable",r),r=!1)};return a.a.createElement("div",{style:Ne({},t),onDoubleClick:function(e){n(e.target,!0)},onBlur:function(e){r=!1,e.target.setAttribute("contentEditable",r),e.target.style.opacity="0"},onKeyDown:function(e){13==(e.keyCode||e.which)&&n(e.target,!r)}})};function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Me=function(e){we.completed();var t={display:"cell"===e.ctrlData.eleType?"block":"none",backgroundColor:"#ffffff00",position:"absolute",left:"".concat(e.ctrlData.rect.x-1.9,"px"),top:"".concat(e.ctrlData.rect.y-1.5,"px"),width:"".concat(e.ctrlData.rect.width+3,"px"),height:"".concat(e.ctrlData.rect.height+3.5,"px"),overflow:"visible"};return a.a.createElement("div",{autoFocus:!0,style:Ae({},t,{border:"2.2px solid #1890ff",contentEditable:!0,zIndex:99999}),onClick:function(e){e.stopPropagation()}},a.a.createElement(Te,{ctrlData:e.ctrlData}),a.a.createElement("div",{style:{position:"absolute",right:"-3.7px",bottom:"-3.8px",width:"6px",height:"6px",border:"1px solid #ffffff",backgroundColor:"#1890ff",overflow:"visible"}}))};function Xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xe(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xe(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Re=function(e){we.completed();var t=Object(n.useRef)(null),r="media"===e.ctrlData.eleType?"block":"none",o={display:r,backgroundColor:"#ffffff00",position:"absolute",overflow:"visible"};"block"===r&&(o.left="".concat(e.ctrlData.rect.x-1.9,"px"),o.top="".concat(e.ctrlData.rect.y-1.5,"px"),o.width="".concat(e.ctrlData.rect.width+3,"px"),o.height="".concat(e.ctrlData.rect.height+3.5,"px"));var i=!1,c=0,l=0;return a.a.createElement("div",{autoFocus:!0,ref:t,"user-select":"none","webkit-user-select":"none",style:Le({},o,{border:"2.2px solid #1890ff",contentEditable:!0,zIndex:99999}),onClick:function(e){e.stopPropagation(),e.preventDefault()},onMouseDown:function(t){if(t.stopPropagation(),t.preventDefault(),"block"===r){we.start(t.clientX,t.clientY),c=t.clientX,l=t.clientY,i=!0;var n=Le({},e.ctrlData.rect);e.ctrlData.refObj.data.rect=Le({},n)}},onMouseMove:function(r){if(r.stopPropagation(),r.preventDefault(),i){var n=r.clientX-c,a=r.clientY-l;if(c=r.clientX,l=r.clientY,0!==n||0!==a){var o=Le({},e.ctrlData.rect);o.x+=n,o.y+=a,e.ctrlData.rect=Le({},o),function(e){t.current.style.left="".concat(e.x,"px"),t.current.style.top="".concat(e.y,"px"),t.current.style.width="".concat(e.width,"px"),t.current.style.height="".concat(e.height,"px")}(Le({},o)),e.ctrlData.refObj.data.rect=Le({},o),e.ctrlData.refObj.onChangeRect(Le({},o))}}},onMouseUp:function(e){e.stopPropagation(),e.preventDefault(),i=!1,c=0,l=0}},a.a.createElement("div",{style:{position:"absolute",right:"-3.7px",bottom:"-3.8px",width:"6px",height:"6px",border:"1px solid #ffffff",backgroundColor:"#1890ff",overflow:"visible",pointerEvents:"none"}}))};r(273);function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ue=function(e){function t(e){var r;Object(s.a)(this,t),(r=Object(p.a)(this,Object(d.a)(t).call(this,e))).currentController=null,r.mediaElements=[],r.getController=function(){return"cell"===r.props.ctrlData.eleType?(r.currentController&&r.currentController,r.currentController=a.a.createElement(Me,{ctrlData:r.props.ctrlData})):"media"===r.props.ctrlData.eleType&&(r.currentController=a.a.createElement(Re,{ctrlData:r.props.ctrlData})),r.currentController},r.getScrollData=function(e){ye.offsetX=e.target.scrollLeft,ye.offsetY=e.target.scrollTop},r.hitOperateLayerHandle=function(e){r.ignoreDrag(e);var t=Ee(e.clientX,e.clientY);if(!(e.clientX>r.props.excelSheet.width||e.clientY>r.props.excelSheet.height)){var n=Ge({},r.props.ctrlData);n.preRect=Ge({},r.props.ctrlData.preRect),n.rect=Ge({},r.props.ctrlData.rect),n.refObj=null,n.hit=t,n.eleType="cell",r.props.hitTestOperate({ctrlData:n})}},r.ignoreDrag=function(e){e.stopPropagation(),e.preventDefault()},r.dropInHandle=function(e){r.ignoreDrag(e);var t=e.dataTransfer.files[0];if(t){console.log(t);var n=new FileReader,a=Ee(e.clientX,e.clientY),o=r.props.addDragImage,i=t.name.split(".");n.onload=function(e){o({fileType:"img",ext:i[i.length-1],src:e.target.result,location:a,zIndex:9990,autoSeleted:!0})},n.readAsDataURL(t)}};var n=S.a.load("loginCookie");if(void 0!==n){var o=window.atob(n),i=JSON.parse(o);void 0!==i.userInfo.username&&r.props.receiveUserInfo(i)}return r.getController(),r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){void 0===this.props.login.userInfo.username&&this.props.history.replace("/excel-web/login/github");var e=document.getElementById("toolHeaderId");e&&(this.toolsHeaderOffsetHeight=e.offsetHeight,Oe.offsetHeight=e.offsetHeight)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"excel-main"},a.a.createElement("div",{className:"tool-header",id:"toolHeaderId"},a.a.createElement(ue,null),a.a.createElement(he,null)),a.a.createElement("div",{className:"content-main",id:"contentMainId",onScroll:this.getScrollData},a.a.createElement("div",{className:"excel-container"},a.a.createElement("div",{className:"excel-component",style:{width:this.props.excelSheet.width+300,height:parseInt(this.props.excelSheet.height)+300}},a.a.createElement(ie,null),a.a.createElement("div",{className:"operateLayer",id:"operateLayerId",onClick:function(t){return e.ignoreDrag(t)},onMouseDown:this.hitOperateLayerHandle,onDragEnter:this.ignoreDrag,onDragOver:function(t){e.ignoreDrag(t)},onDrop:this.dropInHandle},a.a.createElement(ke,null),this.getController())))),a.a.createElement("div",{className:"tool-footer-container"},a.a.createElement(ve,null)))}}]),t}(a.a.Component),ze=Object(l.b)((function(e){return e}),{receiveUserInfo:_,changedExcelSize:te,hitTestOperate:ne,addDragImage:function(e){return{type:"ADD_DRAG_IMAGE",data:e}}})(Ue),Ke=(r(274),function(e){function t(){return Object(s.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(K.d,null,a.a.createElement(K.b,{path:"/excel-web/sheet",component:ze}),a.a.createElement(K.b,{path:"/excel-web/login",component:q}),a.a.createElement(K.a,{to:"/excel-web/login"})))}}]),t}(a.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var We=r(50),Be=r(148);function Ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ye(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ye(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Je={userInfo:{errcode:0}};var Ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:case E:return e;case w:return S.a.remove("loginCookie",{path:"/"}),Fe({},Je);case j:var r=Fe({},t.data);return void 0!==t.data.errcode?r.userInfo.errcode=t.data.errcode:r.userInfo.errcode=0,Fe({},r);default:return Fe({},e)}};function Ze(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ze(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ze(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $e={width:0,height:0},Qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$e,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGED_EXCEL_SIZE":return qe({},t.data);default:return e}},et=r(149),tt=r.n(et),rt=r(150),nt=r.n(rt);function at(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ot(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?at(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):at(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var it=60,ct=22,lt=function(e){if(e<0)throw Error("Error getPositionStrX inputX < 0");var t="A".charCodeAt(0),r=e+1,n="";do{var a=r-1,o=a%26;n=String.fromCharCode(t+o)+n,r=parseInt(a/26)}while(r>0);return n},st=function(e){var t=e.match(/[0-9]+/g)||[],r=e.match(/[A-Z]+/g)||[];if(1===t.length&&1===r.length){for(var n=r[0].toString(),a="A".charCodeAt(),o=0,i=0;i<n.length;i++){var c=n[i].charCodeAt()-a+1;o+=Math.pow(26,n.length-i-1)*c}return{x:o-1,y:parseInt(t[0])-1}}},ut=function(e){for(var t=[],r=0;r<160;r++){t.push([]);for(var n=0;n<30;n++)if(0===r&&0===n)t[0].push({readOnly:!0,value:""});else if(0===r&&n>0){var a=lt(n-1);t[0].push({readOnly:!0,value:a})}else if(r>0&&0===n)t[r].push({readOnly:!0,value:r});else if(e){if(r>0&&n>0){var o=st(t[0][n].value+r);t[r].push({value:"(".concat(o.x,", ").concat(o.y,")")})}}else t[r].push({value:""})}return t},pt=function(e){var t=new tt.a.Workbook;for(var r in e){var n=t.addWorksheet(e[r].name);n.properties.defaultRowHeight=17;for(var a=e[r].grid.length,o=e[r].grid[0].length,i=1;i<a;i++)for(var c=1;c<o;c++){var l=n.getRow(i);if(!l){var s=new Array(o).fill("");n.addRow(s),l=n.getRow(i)}l.height=17,l.getCell(c).value=e[r].grid[i][c].value}if(e[r].media.length>0)for(var u=e[r].media,p=0;p<e[r].media.length;p++){var d=t.addImage({base64:u[p].src,extension:u[p].ext}),h={col:2,row:2},f={col:6,row:5};u[p].rect&&(h.col=u[p].rect.x/it,h.row=u[p].rect.y/ct-1,f.col=(u[p].rect.x+u[p].rect.width)/it,f.row=(u[p].rect.y+u[p].rect.height)/ct-1,h.col=h.col<0?0:h.col,h.row=h.row<0?0:h.row,f.col=f.col<0?5:f.col,f.row=f.row<0?5:f.row),n.addImage(d,{tl:h,br:f,editAs:"oneCell"})}}t.xlsx.writeBuffer().then((function(e){return nt.a.saveAs(new Blob([e]),"excel-web".concat(Date.now(),".xlsx"))})).catch((function(e){return console.log("Error writing excel export",e)}))},dt=function(){return(new Date).getTime().toString()+parseInt(100*Math.random())},ht=function(){var e=new Array,t=dt();return e[t]={name:"Sheet1",grid:ut(!1),media:[]},e[dt()]={name:"Sheet2",grid:ut(!0),media:[]},{dic:e,selectedKey:t,length:2}}(),ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ht,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_EXCEL_SHEET":var r=ot({},e),n=r.length+1;for(var a in r.dic)r.dic[a].name==="Sheet"+n&&n++;var o=dt();return r.dic[o]={grid:ut(),name:"Sheet"+n,media:[]},r.selectedKey=o,r.length+=1,r;case"REMOVE_EXCEL_SHEET":if(e.length<2)return e;var i=new Array,c=void 0;t.data.key!==e.selectedKey&&(c=e.selectedKey);var l=!1;for(var s in e.dic)s===t.data.key?l=!0:(i[s]=e.dic[s],c||(c=s));return l?{dic:i,selectedKey:c,length:e.length-1}:e;case"CHANGE_EXCEL_SHEET_NAME":var u=ot({},e);return e[t.data.key]?(u.dic[t.data.key].name=t.data.name,u):e;case"CHANGE_EXCEL_SHEET_SELECTED":var p=ot({},e);return p.selectedKey?(p.selectedKey=t.data.key,p):e;case"DOWNLOAD_EXCEL":return pt(e.dic),e;case"GET_SELECTED_GRID":return e;case"ADD_DRAG_IMAGE":var d=e.selectedKey;if(d){var h=e.dic[d];h.media.push(t.data),h.media=Object($.a)(h.media)}return e;case"SORT_MEDIA_ELEMENTS":var f=e.selectedKey;if(f){var g=e.dic[f];g.media=Object($.a)(g.media)}return e;default:return e}};function gt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gt(r,!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gt(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var mt={width:60,height:22},vt={refObj:null,eleType:"cell",hit:{x:60,y:22},rect:bt({x:60,y:22,r:0},mt),preRect:bt({x:60,y:22,r:0},mt)};function yt(e,t,r){for(var n=t.length,a=0,o=0;o<n;o++){var i=(a+=t[o][1])+(t[o][0]-o)*e-r;if(i>=0)return 0===i?t[o][0]+1:i<t[o][1]?t[o][0]:t[o][0]-Math.ceil((i-t[o][1])/e,0)}return parseInt((r-a)/e+n)}function Ot(e,t,r){for(var n=t.length,a=0,o=0;o<n;o++){var i=(a+=t[o][1])+(t[o][0]-o)*e-r;if(i>=0)return 0===i?t[o][0]+1:i<t[o][1]?t[o][0]:t[o][0]-Math.ceil((i-t[o][1])/e,0)}return parseInt((r-a)/e+n)}var Et=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"HIT_TEST_OPERATE":if(e.refObj=null,e.eleType=t.data.ctrlData.eleType,"cell"===t.data.ctrlData.eleType){var r=Ot(mt.width,[],t.data.ctrlData.hit.x),n=yt(mt.height,[],t.data.ctrlData.hit.y),a=r*mt.width,o=n*mt.height,i=mt.width,c=mt.height;e.rect={x:a,y:o,width:i,height:c},e.coord={x:r,y:n}}else"media"===t.data.ctrlData.eleType&&(e.refObj=t.data.ctrlData.refObj,t.data.ctrlData.preRect=bt({},e.rect),e.rect=bt({},t.data.ctrlData.rect));return bt({},e);default:return e}},wt=Object(We.d)(Object(We.c)({login:Ve,excelSheet:Qe,gridDatas:ft,ctrlData:Et}),Object(We.a)(Be.a));i.a.render(a.a.createElement(l.a,{store:wt},a.a.createElement(c.a,null,a.a.createElement(Ke,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[155,1,2]]]);
//# sourceMappingURL=main.a205dd62.chunk.js.map