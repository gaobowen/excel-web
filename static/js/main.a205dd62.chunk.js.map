{"version":3,"sources":["static/images/login/github.svg","static/images/login/main-bg.png","static/images/login/login-input-bg.png","components/login/ding-qrcode-login.jsx","redux/login/action-types.js","http.js","redux/login/actions.js","components/login/ddlogin.jsx","components/login/github-login.jsx","components/login/login-view.jsx","components/login/main-login.jsx","redux/workplace/actions.js","redux/workplace/action-types.js","components/workplace/excel-sheet.jsx","components/workplace/user-header.jsx","components/workplace/tools-header.jsx","components/workplace/tools-footer.jsx","components/workplace/current-operate.jsx","components/workplace/element-content/image-view.jsx","components/workplace/media-container.jsx","components/workplace/element-content/cell-input.jsx","components/workplace/controllers/cell-controller.jsx","components/workplace/controllers/media-controller.jsx","components/workplace/main-workplace.jsx","App.js","serviceWorker.js","redux/login/reducers.js","redux/workplace/reducers.js","redux/workplace/reducers-grid-datas.js","redux/workplace/reducers-operate.js","redux/store.js","index.js"],"names":["module","exports","DingQrcodeLogin","props","createSrc","options","goto","style","href","src","state","url","encodeURIComponent","iframeOption","id","this","frameBorder","allowtransparency","scrolling","width","height","className","React","Component","defaultProps","DINGDING_LOGIN","GITHUB_LOGIN","USER_LOGOUT","RECEIVE_USER_INFO","httpApi","Promise","resolve","cookie","remove","path","setTimeout","retobj","userInfo","errcode","username","avatarUrl","save","window","btoa","JSON","stringify","getGithub","a","axios","get","resp","undefined","data","login","avatar_url","message","error","receiveUserInfo","params","type","DDLogin","APPID","REDIRECT_URI","location","search","indexOf","keyvalues","replace","split","kv","index","length","pairs","toString","loginDingding","handleMessage","event","origin","addEventListener","attachEvent","console","log","opacity","connect","dispatch","postDinging","ret","GithubLogin","loginGithub","userName","handleChange","target","value","githubimg","size","placeholder","onChange","onPressEnter","onClick","LoginView","changeLoginMode","loginMode","history","setState","pathname","key","component","to","withRouter","MainLogin","loginCookie","load","jstr","atob","parse","bgimg","alt","loginviewbgimg","changedExcelSize","changeExcelSheetSelected","hitTestOperate","ExcelSheet","getCoordinates","positionStr","row","match","col","colstr","baseCode","charCodeAt","colno","charIdx","Math","pow","x","y","parseInt","getPositionStr","coordinates","getPositionStrX","inputX","Error","codeA","inX","numIdx","ascIdx","String","fromCharCode","grid","gridDatas","dic","selectedKey","totalWidth","totalHeight","excelSheet","valueRenderer","cell","onContextMenu","e","i","j","readOnly","preventDefault","onCellsChanged","changes","map","forEach","render","UserHeader","download","downloadExcel","handleMenuClick","logout","open","encodeURI","host","downMenu","Item","overlay","icon","ToolsHeader","iconbtn","TabPane","initData","refObj","eleType","hit","rect","r","preRect","ToolsFooter","activeKey","ctrlData","onEdit","targetKey","action","add","addExcelSheet","removeExcelSheet","componentDidMount","dickey","panes","push","title","name","content","pane","tab","changeExcelSheetName","scrollData","offsetX","offsetY","headerData","offsetHeight","getOperatePositon","clientX","clientY","dragMove","isDrag","start","changed","dx","dy","completed","zIndexEventListener","callback","sortMediaElements","useState","setData","divEle","useRef","onChangeRect","current","left","top","mystyle","backgroundColor","position","zIndex","img","Image","onload","wid","heig","originalSize","ratio","ref","οndragstart","draggable","stopPropagation","onMouseDown","divRef","onMouseUp","onLoad","autoSeleted","MediaContainer","getStamp","Date","getTime","random","elements","media","val","idx","CellInput","display","color","isEditable","setEditable","isEdit","setAttribute","focus","blur","onDoubleClick","onBlur","onKeyDown","keyCode","which","CellController","overflow","autoFocus","border","contentEditable","right","bottom","MediaController","dragX","dragY","user-select","webkit-user-select","onMouseMove","pointerEvents","MainWorkplace","currentController","mediaElements","getController","getScrollData","scrollLeft","scrollTop","hitOperateLayerHandle","ignoreDrag","dropInHandle","file","dataTransfer","files","reader","FileReader","pos","addDragImage","exts","fileType","ext","result","readAsDataURL","toolHeaderBox","document","getElementById","toolsHeaderOffsetHeight","onScroll","onDragEnter","onDragOver","onDrop","App","Boolean","hostname","initState","initSize","defaultCellSize","createBlankGridData","isTest","initGrid","coor","wb","Excel","Workbook","ws","addWorksheet","properties","defaultRowHeight","rowcount","colcount","rowidx","colidx","getRow","rowdata","Array","fill","addRow","getCell","imageId","addImage","base64","extension","tl","br","editAs","xlsx","writeBuffer","then","buffer","FileSaver","saveAs","Blob","now","catch","err","blankData","key1","initGridDatas","addstate","nameidx","asKey","addkey","rmdic","wouldSelect","hasRemove","changeState","selectedState","locateVertical","defaultHeight","heights","changedCount","changedOffset","checkoffset","ceil","locateHorizontal","defaultWidth","widths","idxH","idxV","coord","createStore","combineReducers","applyMiddleware","thunk","ReactDOM","store","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.a205dd62.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/github.741c0ae1.svg\";","module.exports = __webpack_public_path__ + \"static/media/main-bg.197637b0.png\";","module.exports = __webpack_public_path__ + \"static/media/login-input-bg.cf01c34c.png\";","import React from 'react'\nimport PropTypes from 'prop-types'\n\n// https://ding-doc.dingtalk.com/doc#/serverapi3/mrugr3\nclass DingQrcodeLogin extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            url: \"https://login.dingtalk.com/login/qrcode.htm?goto=\"\n        }\n    }\n    createSrc = () => {\n        const { goto, style, href } = this.props.options\n        let src = this.state.url + encodeURIComponent(goto)\n        src += style ? \"&style=\" + style : \"\";\n        src += href ? \"&href=\" + href : \"\";\n        return src\n    }\n    render() {\n        const iframeOption = {\n            id: this.props.options.id,\n            src: this.createSrc(),\n            frameBorder: \"0\",\n            allowtransparency: \"true\",\n            scrolling: \"no\",\n            width: this.props.options.width,\n            height: this.props.options.height,\n            className: this.props.className\n        }\n        return (\n            <iframe {...iframeOption} />\n        )\n    }\n}\n\nDingQrcodeLogin.propTypes = {\n    options: PropTypes.shape({\n        id: PropTypes.string,\n        goto: PropTypes.string.isRequired,\n        style: PropTypes.string,\n        href: PropTypes.string,\n        width: PropTypes.string,\n        height: PropTypes.string,\n    }),\n    className: PropTypes.string\n}\n\nDingQrcodeLogin.defaultProps = {\n    options: {\n        id: \"login_container\",\n        goto: \"\",\n        style: \"\",\n        href: \"\",\n        width: \"350px\",\n        height: \"350px\",\n    },\n    className: ''\n}\n\nexport default DingQrcodeLogin","export const DINGDING_LOGIN = 'DINGDING_LOGIN';\nexport const GITHUB_LOGIN = 'GITHUB_LOGIN';\nexport const USER_LOGOUT = 'USER_LOGOUT';\nexport const RECEIVE_USER_INFO = 'RECEIVE_USER_INFO';\n\n\n","import axios from 'axios';\nimport cookie from 'react-cookies'\nimport { message } from 'antd';\n\nlet httpApi = {};\n\n//let dingurl = 'https://oapi.dingtalk.com/sns/getuserinfo_bycode?accessKey=dingoauctaoft7kia4pdvx';\n\nhttpApi.postDinging = () => {\n    //https://oapi.dingtalk.com/ 此api需要服务端完成，这里用timeout模拟\n    return new Promise((resolve) => {\n        cookie.remove('loginCookie', { path: '/' })\n        setTimeout(() => {\n            let retobj = {\n                    userInfo: {\n                        errcode: 0,\n                        username: 'DingUser',\n                        avatarUrl: 'https://gtms03.alicdn.com/tps/i3/TB1opXxHXXXXXahXpXXvBLt6FXX-230-230.png'\n                    }\n                }\n            cookie.save('loginCookie', window.btoa(JSON.stringify(retobj)), { path: '/' });\n            resolve(retobj);\n        }, 300)\n    })\n\n};\n\nhttpApi.getGithub = async(username) => {\n    let retobj = {\n        userInfo: {\n            errcode: 0\n        }\n    };\n    try {\n        let resp = await axios.get(`https://api.github.com/users/${username}`);\n        //debugger;\n        cookie.remove('loginCookie', { path: '/' })\n        if (resp.data.login !== undefined) {\n            retobj.userInfo.username = resp.data.login;\n            retobj.userInfo.avatarUrl = resp.data.avatar_url;\n            cookie.save('loginCookie', window.btoa(JSON.stringify(retobj)), { path: '/' });\n        } else {\n            message.error('User name not found.');\n            retobj.errcode = -1;\n        }\n    } catch (error) {\n        message.error('User name not found.');\n    }\n    return retobj;\n}\n\n\n\nexport default httpApi;","import { USER_LOGOUT, RECEIVE_USER_INFO } from './action-types';\nimport httpApi from '../../http' \n\nexport const loginDingding = (params) => {\n    return async dispatch => {\n        \n        let ret = await httpApi.postDinging(params);\n        console.log(ret);\n        dispatch(receiveUserInfo({...ret}));\n            \n\n    }\n}\n\nexport const loginGithub = (params) => {\n    return async dispatch => {\n        let ret = await httpApi.getGithub(params)\n        dispatch(receiveUserInfo({...ret}));\n    }\n}\n\nexport const logout = (params) => ({ type: USER_LOGOUT, data: params });\n\nexport const receiveUserInfo = (params) => ({ type: RECEIVE_USER_INFO, data: params })","import React from 'react'\nimport PropTypes from 'prop-types'\nimport DingQrcodeLogin from './ding-qrcode-login'\nimport { connect } from 'react-redux'\nimport { loginDingding } from '../../redux/login/actions'\n\n\n// https://ding-doc.dingtalk.com/doc#/serverapi3/mrugr3\nclass DDLogin extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            // 测试 appid\n            APPID: 'dingoauctaoft7kia4pdvx',  \n            // 跳转页面\n            REDIRECT_URI: 'https://gaobowen.github.io/excel-web/login/dingding' //https://gaobowen.github.io/excel-web\n        }\n    }\n    UNSAFE_componentWillMount () {\n        // 触发回调时处理回调链接,举例：如果查询字符串中含有state,且为dinglogin（可自行设置）,\n        // 则触发扫描登录的相应处理方法，比如登录。\n        if (this.props.location.search === undefined) {\n            return;\n        }\n        //const state = this.props.location && this.props.location.query.state;\n        if (this.props.location.search.indexOf('dinglogin') !== -1) {\n            let keyvalues = this.props.location.search.replace(\"?\", \"\").split(\"&\");\n            let kv = {};\n            for (let index = 0; index < keyvalues.length; index++) {\n                const pairs = keyvalues[index].split('=');\n                kv[pairs[0].toString()] = pairs[1];\n            }\n            //模拟获取用户数据\n            this.props.loginDingding({});\n            return;\n            //getuserinfo_bycode为服务端api 前端不支持\n            // let keyvalues = this.props.location.search.replace(\"?\", \"\").split(\"&\");\n            // let kv = {};\n            // for (let index = 0; index < keyvalues.length; index++) {\n            //     const pairs = keyvalues[index].split('=');\n            //     kv[pairs[0].toString()] = pairs[1];\n            // }\n            // console.log(kv);\n            // const code = kv.code;\n            // const timestamp = new Date().getTime().toString();\n            // let hash = CryptoJS.HmacSHA256(timestamp, \"1e2K9qeTnKJCEbQwBTiFWVZKDoEvlzgpcw2Psv3kmOguuezpbmRl2k37dMbHFaIC\");\n            // var hashInBase64 = CryptoJS.enc.Base64.stringify(hash);\n            // axios.post(`https://oapi.dingtalk.com/sns/getuserinfo_bycode?accessKey=dingoauctaoft7kia4pdvx&timestamp=${timestamp}&signature=${hashInBase64}`, {\n            //     tmp_auth_code: code,\n            // })\n            //     .then(function (response) {\n            //         console.log('resp')\n            //         console.log(response)\n            //     })\n            //     .catch(function (error) {\n            //         console.log('error')\n            //         console.log(error);\n            //     });\n            // ex: dispatch(scanLogin({tmp_auth_code: code}));\n        }\n    }\n    componentDidMount() {\n        // 监听消息处理方法\n        const handleMessage = (event) => {\n            // 获取loginTempCode\n            //const loginTempCode = event.data;\n            // 获取消息来源\n            const origin = event.origin;\n            // 拼接 url\n            //const url = `https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=${this.state.APPID}&response_type=code&scope=snsapi_login&state=dinglogin&redirect_uri=${this.state.REDIRECT_URI}&loginTmpCode=${loginTempCode}`\n            // 如果来源为https://login.dingtalk.com，则在当前窗口打开回调链接\n            if (origin === 'https://login.dingtalk.com') {\n                this.props.loginDingding({});\n                // github pages 为静态页面跳转后会丢失页面js信息。这里跳过此步骤\n                //window.open(encodeURI(url), '_parent')\n            }\n        };\n        // 监听iframe的消息\n        if (typeof window.addEventListener != 'undefined') {\n            window.addEventListener('message', handleMessage, false);\n        } else if (typeof window.attachEvent != 'undefined') {\n            window.attachEvent('onmessage', handleMessage);\n        }\n    }\n\n    //这是错误的写法，方法需要绑定，或者可以使用箭头函数自动绑定\n    loginDingding() {\n        console.log('loginDingding')\n    }\n\n    render() {\n        const options = {\n            id: \"login-container\",\n            goto: `https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=${this.state.APPID}&response_type=code&scope=snsapi_login&state=dinglogin&redirect_uri=${this.state.REDIRECT_URI}`,\n            width: '350px',\n            height: '350px',\n        }\n\n        return (\n            <div id=\"login-container\" style={{ opacity: 0.78 }}>\n                <DingQrcodeLogin options={options} />\n            </div>\n        )\n    }\n}\n\nDDLogin.propTypes = {\n    loginDingding: PropTypes.func.isRequired,\n    location : PropTypes.object.isRequired,\n}\n\nexport default connect(\n    state => ({ login : state.login }),\n    { loginDingding }\n)(DDLogin)\n","import React from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { loginGithub } from '../../redux/login/actions'\nimport { Input, Button, Avatar } from 'antd'\n\nimport githubimg from '../../static/images/login/github.svg';\nimport '../../static/css/github-login.css'\n\nclass GithubLogin extends React.Component {\n  constructor(props) {\n    super(props);\n    //props 不能扩展，只能外部传入\n  }\n\n  loginGithub = () => {\n    this.props.loginGithub(this.userName);\n  }\n\n  handleChange = (event) => {\n    this.userName = event.target.value;\n  }\n\n  render() {\n    return (\n      <div style={{ width: '100%', height: '100%' }}>\n        <Avatar src={githubimg} size={64} className='login-github-svg' />\n        <div className='login-username-text'>\n          Github User Name\n        </div>\n\n        <Input className='login-username-input' placeholder='User Name' onChange={this.handleChange}\n          onPressEnter={this.loginGithub} />\n\n        <Button type=\"primary\" className='login-github-btn' onClick={this.loginGithub}>Login</Button>\n      </div>)\n  }\n}\n\nGithubLogin.propTypes = {\n  loginGithub: PropTypes.func.isRequired,\n}\n\nexport default connect(\n  state => ({ login: state.login }),\n  { loginGithub }\n)(GithubLogin)\n","import React from 'react';\nimport PropTypes from 'prop-types'\nimport DDLogin from './ddlogin';\nimport GithubLogin from './github-login'\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom'\n\nimport '../../static/css/loginview.css'\n\n\nclass LoginView extends React.Component {\n  \n  // 设置props默认值防止报错\n  static defaultProps = {\n    options: {\n      loginMode: 'dingding'\n    }\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      options: { loginMode: 'dingding' }\n    }\n    if(props.location !== undefined)\n    {\n      if(props.location.pathname === '/excel-web/login/github')\n      {\n        props.options.loginMode = 'github';\n      }\n      else\n      {\n        props.options.loginMode = 'dingding';\n      }\n    }\n    this.state.options.loginMode = props.options.loginMode;\n\n    \n  }\n\n  changeLoginMode = (event) => {\n    let loginMode = event.target.id === 'tab-li-github' ? 'github' : 'dingding';\n    // 使用props.history前首先使用withRoute\n    this.props.history.replace('/excel-web/login/' + loginMode);\n    this.setState({ options: { loginMode } });\n  }\n\n\n  render() {\n    //刷新页面后，路由与state不匹配，导致页面显示错误\n    //解决方案：\n    //1、把路由相关参数在state中剥离\n    //2、state中相关的默认参数根据路由重新负责\n\n    return (\n      <div className='login-view'>\n        {/*这里ul没有把div撑开，需要确定height*/}\n        <div className='tab-div'>\n          <ul className='tabs'>\n            {/* 这里还可以优化，使用Link或NavLink */}\n            <li id='tab-li-dingding'\n              className={this.state.options.loginMode === 'dingding' ? 'tab-item current' : 'tab-item'}\n              onClick={this.changeLoginMode}>Dingding</li>\n            <li id='tab-li-github'\n              className={this.state.options.loginMode === 'dingding' ? 'tab-item' : 'tab-item current'}\n              onClick={this.changeLoginMode}>Github</li>\n          </ul>\n        </div>\n        \n        <div className='login-view-content' key={this.props.location.key}>\n          <Switch>\n            <Route path='/excel-web/login/dingding' component={DDLogin} />\n            <Route path='/excel-web/login/github' component={GithubLogin}/>\n            <Redirect to='/excel-web/login/dingding' />\n          </Switch>\n          {}\n        </div>\n      </div>\n    )\n  }\n}\n\n//PropTypes.shape 用于检测对象的不同属性的不同类型\nLoginView.propTypes = {\n  options:\n    PropTypes.shape({\n      loginMode: PropTypes.string.isRequired,\n    }),\n    location: PropTypes.object.isRequired,\n    history : PropTypes.object.isRequired,\n}\n\n\nexport default withRouter(LoginView);","import React from 'react';\nimport LoginView from './login-view'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\nimport { receiveUserInfo } from '../../redux/login/actions'\nimport cookie from 'react-cookies'\n\nimport bgimg from '../../static/images/login/main-bg.png';\nimport loginviewbgimg from '../../static/images/login/login-input-bg.png';\nimport '../../static/css/mainlogin.css'\n\nclass MainLogin extends React.Component {\n  constructor(props) {\n    super(props);\n\n    //在正式的web应用中，通常使用浏览器缓存的cookie值作为key，向redis等缓存服务端获取session信息，\n    //进而判断用户是否需要登录。这里刷新页面后会丢失dom中登录状态，尝试用cookie base 64 存储登录信息\n    let loginCookie = cookie.load('loginCookie');\n    if (loginCookie !== undefined) {\n      var jstr = window.atob(loginCookie)\n      let login = JSON.parse(jstr);\n      if (login.userInfo.username !== undefined) {\n        this.props.receiveUserInfo(login);\n      }\n    }\n  }\n\n\n  componentDidMount() {\n    if (this.props.userInfo.username !== undefined) {\n      this.props.history.replace('/excel-web/sheet', this.state);\n    }\n  }\n  componentDidUpdate() {\n    if (this.props.userInfo.username !== undefined) {\n      this.props.history.replace('/excel-web/sheet', this.state);\n    }\n  }\n\n  render() {\n\n    if (this.props.userInfo.username !== undefined) {\n      return (<div></div>)\n    }\n\n    return (\n      <div>\n        <div className='bgdiv'>\n          <img className='bgimg' src={bgimg} alt='loginbgimg' />\n        </div>\n        <div className='logincontainer'>\n          <div>\n            <div className='loginviewbg outradius'>\n              <img className='loginviewbgimg' src={loginviewbgimg} alt='' />\n            </div>\n            <LoginView />\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nMainLogin.propTypes = {\n  userInfo: PropTypes.object.isRequired,\n  receiveUserInfo: PropTypes.func.isRequired,\n  history :PropTypes.object.isRequired,\n}\n\n//react diff 通过setState来更新ui，这里绑定的数据集合越小，ui更新的次数越少\n//这里的state.login\nexport default connect(\n  state => ({ userInfo: state.login.userInfo }),\n  { receiveUserInfo }\n)(MainLogin)\n","import {\n    CHANGED_EXCEL_SIZE,\n    ADD_EXCEL_SHEET,\n    REMOVE_EXCEL_SHEET,\n    CHANGE_EXCEL_SHEET_NAME,\n    CHANGE_EXCEL_SHEET_SELECTED,\n    DOWNLOAD_EXCEL,\n    HIT_TEST_OPERATE,\n    GET_SELECTED_GRID,\n    ADD_DRAG_IMAGE,\n    SORT_MEDIA_ELEMENTS\n} from './action-types';\n\n\nexport const changedExcelSize = (params) => ({ type: CHANGED_EXCEL_SIZE, data: params });\n\nexport const addExcelSheet = (params) => ({ type: ADD_EXCEL_SHEET, data: params });\n\nexport const getSelectedGrid = (params) => ({ type: GET_SELECTED_GRID, data: params });\n\nexport const removeExcelSheet = (params) => ({ type: REMOVE_EXCEL_SHEET, data: params });\n\nexport const changeExcelSheetName = (params) => ({ type: CHANGE_EXCEL_SHEET_NAME, data: params });\n\nexport const changeExcelSheetSelected = (params) => ({ type: CHANGE_EXCEL_SHEET_SELECTED, data: params });\n\nexport const downloadExcel = (params) => ({ type: DOWNLOAD_EXCEL, data: params });\n\nexport const hitTestOperate = (params) => ({ type: HIT_TEST_OPERATE, data: params });\n\nexport const addDragImage = (params) => ({ type: ADD_DRAG_IMAGE, data: params });\n\nexport const sortMediaElements = (params) => ({ type: SORT_MEDIA_ELEMENTS, data: params });","export const CHANGED_EXCEL_SIZE = 'CHANGED_EXCEL_SIZE';\n\nexport const ADD_EXCEL_SHEET = 'ADD_EXCEL_SHEET';\n\nexport const REMOVE_EXCEL_SHEET = 'REMOVE_EXCEL_SHEET';\n\nexport const CHANGE_EXCEL_SHEET_NAME = 'CHANGE_EXCEL_SHEET_NAME';\n\nexport const CHANGE_EXCEL_SHEET_SELECTED = 'CHANGE_EXCEL_SHEET_SELECTED';\n\nexport const DOWNLOAD_EXCEL = 'DOWNLOAD_EXCEL';\n\nexport const HIT_TEST_OPERATE = 'HIT_TEST_OPERATE';\n\nexport const GET_SELECTED_GRID = 'GET_SELECTED_GRID';\n\nexport const ADD_DRAG_IMAGE = 'ADD_DRAG_IMAGE';\n\nexport const SORT_MEDIA_ELEMENTS = 'SORT_MEDIA_ELEMENTS';\n\n\n\n\n\n","import React from 'react';\nimport PropTypes from 'prop-types'\nimport Datasheet from 'react-datasheet';\nimport { connect } from 'react-redux'\nimport { changedExcelSize, changeExcelSheetSelected } from '../../redux/workplace/actions'\n\nimport '../../static/css/excel-sheet.css'\n\n\n\n//此开源控件在每个cell上都单独处理了事件，当初始化数组达到几百上千行时，操作会延迟卡顿，\n//作为excel这种数据量比较大的控件来说，这样的设计思路是不可行的\n//excel正确的设计方式 因该是数据展示层在下面，上面覆盖统一操作层（建议用canvas）作为交互层\nclass ExcelSheet extends React.Component {\n    constructor(props) {\n        super(props)\n    }\n\n\n    //坐标换算\n    //列A-ZZ 行1-n\n    //双字母把A看作1  列在前行在后例如 AA3\n    //返回的坐标index从0开始\n    getCoordinates = (positionStr) => {\n        const row = positionStr.match(/[0-9]+/g) || [];\n        const col = positionStr.match(/[A-Z]+/g) || [];\n\n        if (row.length === 1 && col.length === 1) {\n            let colstr = col[0].toString();\n            let baseCode = 'A'.charCodeAt();\n            let colno = 0;\n            for (let index = 0; index < colstr.length; index++) {\n                const charIdx = colstr[index].charCodeAt() - baseCode + 1;\n                let temp = (Math.pow(26, colstr.length - index - 1) * charIdx)\n                colno += temp;\n            }\n            // x列号 y行号\n            return { x: colno - 1, y: parseInt(row[0]) - 1 }\n        }\n    }\n\n    //坐标转字符串index 从0开始\n    getPositionStr = (coordinates) => {\n        let x = parseInt(coordinates.x);\n        return this.getPositionStrX(x) + (coordinates.y + 1);\n    }\n\n    getPositionStrX = (inputX) => {\n        if (inputX < 0) {\n            throw Error('Error getPositionStrX inputX < 0')\n        }\n        let codeA = 'A'.charCodeAt(0);\n        let inX = inputX + 1;\n        let x = ''\n        do {\n            let numIdx = inX - 1;\n            let ascIdx = numIdx % 26;\n            x = String.fromCharCode(codeA + ascIdx) + x;\n            inX = parseInt(numIdx / 26);\n        }\n        while (inX > 0)\n        return x;\n    }\n\n    render() {\n        this.grid = this.props.gridDatas.dic[this.props.gridDatas.selectedKey].grid;\n        this.totalWidth = this.grid[0].length * 60;\n        this.totalHeight = this.grid.length * 22;\n        if (this.totalWidth !== this.props.excelSheet.width\n            || this.totalHeight !== this.props.excelSheet.height) {\n            this.props.changedExcelSize({\n                width: this.totalWidth,\n                height: this.totalHeight,\n            })\n        }\n\n        return (\n            <div style={{ width: this.totalWidth }}>\n                <Datasheet\n                    data={this.grid}\n                    valueRenderer={(cell) => cell.value}\n                    // eslint-disable-next-line no-unused-vars\n                    onContextMenu={(e, cell, i, j) => cell.readOnly ? e.preventDefault() : null}\n                    onCellsChanged={changes => {\n                        const grid = this.grid.map(row => [...row])\n                        changes.forEach(({ row, col, value }) => {\n                            this.grid[row][col] = { ...grid[row][col], value }\n                        })\n                        this.render()\n                    }}\n                />\n            </div>\n        )\n    }\n}\n\nExcelSheet.propTypes = {\n    gridDatas: PropTypes.object.isRequired,\n    excelSheet: PropTypes.object.isRequired,\n    changedExcelSize: PropTypes.func.isRequired,\n    changeExcelSheetSelected: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => { return ({ gridDatas: state.gridDatas, excelSheet: state.excelSheet }) },\n    { changedExcelSize, changeExcelSheetSelected }\n)(ExcelSheet);","import React from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { logout } from '../../redux/login/actions'\nimport { downloadExcel } from '../../redux/workplace/actions'\nimport { Dropdown, Menu, Avatar, Button } from 'antd'\n\nimport '../../static/css/user-header.css'\n\nclass UserHeader extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {};\n        this.handleMenuClick = e => {\n            if (e.key === '2') {\n                this.props.logout({});\n                window.open(encodeURI('http://' + window.location.host + '/excel-web'), '_parent');\n            }\n        };\n\n        this.state.downMenu = (\n            <Menu onClick={this.handleMenuClick}>\n                <Menu.Item className='menu-item' key='1' >\n                    {this.props.login.userInfo.username}\n                </Menu.Item>\n                <Menu.Item className='menu-item' key='2' >\n                    Logout\n                </Menu.Item>\n            </Menu>\n        );\n    }\n\n    download = () => {\n        this.props.downloadExcel()\n    }\n\n    render() {\n\n        return (\n            <div className='user-header'>\n                <div className='header-title'>Technology Changes Lives</div>\n                <div className='items'>\n                    <Dropdown overlay={this.state.downMenu} className='item avatar'>\n                        <Avatar size={40} src={this.props.login.userInfo.avatarUrl} className='item avatar'></Avatar>\n                    </Dropdown>\n                    <div className='item split' ></div>\n                    <Button type=\"primary\" icon=\"download\" className='item btn' onClick={this.download}>Download</Button>\n                </div>\n\n            </div>\n        );\n    }\n}\n\nUserHeader.propTypes ={\n    login : PropTypes.object.isRequired,\n    logout : PropTypes.func.isRequired,\n    downloadExcel : PropTypes.func.isRequired,\n}\n\n\nexport default connect(\n    state => state,\n    { logout, downloadExcel }//这里要用大括号，容易遗漏\n)(UserHeader);","import React from 'react';\nimport { connect } from 'react-redux'\nimport { Icon } from 'antd'\n\nimport '../../static/css/tools-header.css'\n\nclass ToolsHeader extends React.Component {\n\n    iconbtn = (type,index) => {\n        return (<div className='item' key={index}><Icon type={type} /></div>)\n    }\n\n    render() {\n        let editTypes = ['edit', 'copy', 'delete', 'align-center', 'align-left', 'align-right',\n            'bg-colors', 'bold', 'italic', 'underline', 'font-colors', 'font-size'];\n        let charts = ['area-chart', 'pie-chart', 'bar-chart', 'dot-chart', 'line-chart','radar-chart','fund'];\n        let editExts = ['line-height','column-width','column-height','sort-ascending','sort-descending'];\n        return (<div className='tools-header'>\n            <div className='item split'></div>\n            {editTypes.map((x, i) => (this.iconbtn(x,i)))}\n            <div className='item split'></div>\n            {charts.map((x, i)=> (<div className='item' key={'chart'+i}><Icon type={x} /></div>))}\n            <div className='item split'></div>\n            {editExts.map((x, i)=> (<div className='item' key={'editExts'+i}><Icon type={x} /></div>))}\n        </div>)\n    }\n}\n\nexport default connect(\n    state => state,\n    {}\n)(ToolsHeader)\n\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport {\n  addExcelSheet,\n  removeExcelSheet,\n  changeExcelSheetName,\n  changeExcelSheetSelected,\n  hitTestOperate\n} from '../../redux/workplace/actions'\n\n\nimport { Tabs } from 'antd';\n\nimport '../../static/css/tools-footer.css'\n\nconst { TabPane } = Tabs;\n\nconst initData = {\n  refObj: null,\n  eleType: 'cell',\n  hit: { x: 60, y: 22 },\n  rect: {\n    x: 60,\n    y: 22,\n    r: 0,\n    width: 60,\n    height: 22\n  },\n  preRect: {\n    x: 60,\n    y: 22,\n    r: 0,\n    width: 60,\n    height: 22\n  }\n}\n\nclass ToolsFooter extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  onChange = activeKey => {\n    this.props.changeExcelSheetSelected({ key: activeKey });\n    this.props.hitTestOperate({\n      ctrlData: initData,\n    })\n  };\n\n  onEdit = (targetKey, action) => {\n    //action 包含下面的 add 和 remove\n    this[action](targetKey);\n    this.props.hitTestOperate({\n      ctrlData: initData,\n    })\n  };\n\n  add = () => {\n    this.props.addExcelSheet();\n  };\n\n  remove = targetKey => {\n    this.props.removeExcelSheet({\n      key: targetKey\n    })\n  };\n\n  componentDidMount = () => {\n\n  }\n\n  render() {\n    this.panes = [];\n    for (let dickey in this.props.gridDatas.dic) {\n      this.panes.push({\n        title: this.props.gridDatas.dic[dickey].name,\n        content: '',\n        key: dickey\n      })\n    }\n    return (\n      <div className='tools-footer'>\n        <Tabs\n          onChange={this.onChange}\n          activeKey={this.props.gridDatas.selectedKey}\n          type=\"editable-card\"\n          onEdit={this.onEdit}\n        >\n          {this.panes.map(pane => (\n            <TabPane tab={pane.title} key={pane.key}>\n              {pane.content}\n            </TabPane>\n          ))}\n        </Tabs>\n      </div>\n    );\n  }\n}\n\nToolsFooter.propTypes = {\n  gridDatas: PropTypes.object.isRequired,\n  addExcelSheet: PropTypes.func.isRequired,\n  removeExcelSheet: PropTypes.func.isRequired,\n  changeExcelSheetName: PropTypes.func.isRequired,\n  changeExcelSheetSelected: PropTypes.func.isRequired,\n  hitTestOperate: PropTypes.func.isRequired,\n}\n\nexport default connect(\n  state => ({ gridDatas: state.gridDatas }),\n  {\n    addExcelSheet,\n    removeExcelSheet,\n    changeExcelSheetName,\n    changeExcelSheetSelected,\n    hitTestOperate\n  }\n)(ToolsFooter)\n\n\n\n","\nexport const scrollData = { offsetX: 0, offsetY: 0 }\n\nexport const headerData = { offsetHeight: 0 }\n\nexport const getOperatePositon = (clientX, clientY) => {\n    return {\n        x: clientX + scrollData.offsetX,\n        y: clientY - headerData.offsetHeight + scrollData.offsetY,\n    }\n}\n\nexport const dragMove = {\n    x: 0,\n    y: 0,\n    isDrag: false,\n\n    start: function (clientX, clientY) {\n        this.isDrag = true;\n        this.x = clientX;\n        this.y = clientY;\n    },\n\n    changed: function (clientX, clientY) {\n        if (!this.isDrag) {\n            this.x = 0;\n            this.y = 0;\n            return {\n                dx: 0,\n                dy: 0\n            }\n        }\n        let dx = clientX - this.x;\n        let dy = clientY - this.y;\n        this.x = clientX;\n        this.y = clientY;\n        //console.log('dragMovechanged')\n        return { dx, dy }\n    },\n\n    completed: function () {\n        this.x = 0;\n        this.y = 0;\n        this.isDrag = false;\n    }\n}\n\n\nexport const zIndexEventListener = {\n    callback : ()=>{}\n}\n\n//export const copyRect()\n","import React, { useState, useRef } from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { sortMediaElements, hitTestOperate } from '../../../redux/workplace/actions'\nimport { zIndexEventListener } from '../current-operate'\n/*\ndata:{\n    fileType: 'img',\n    src: e.target.result,\n    location: pos,\n    zIndex: 9990,\n    autoSeleted: true\n}\n*/\n\nfunction ImageView(props) {\n    //console.log(props)//方法已挂载\n    const [data, setData] = useState(props.data);\n    const divEle = useRef(null);\n    \n    const onChangeRect = (rect) => {\n        props.data.rect = { ...rect }\n        props.data.location = rect\n        divEle.current.style.left = `${rect.x}px`;\n        divEle.current.style.top = `${rect.y}px`;\n        divEle.current.style.width = `${rect.width}px`;\n        divEle.current.style.height = `${rect.height}px`;\n    }\n\n\n    const mystyle = {\n        backgroundColor: '#00000088',\n        position: 'absolute',\n        left: `${props.data.location.x}px`,\n        top: `${props.data.location.y}px`,\n        zIndex: props.data.zIndex,\n    }\n\n    if (!props.data.rect) {\n        let img = new Image();\n        img.src = props.data.src;\n        img.onload = () => {\n            let wid = img.width;\n            let heig = img.height;\n            props.data.originalSize = {\n                width: wid,\n                height: heig\n            }\n            //等比缩小\n            if (wid > 500) {\n                let ratio = heig / wid;\n                wid = 500;\n                heig = ratio * 500;\n            }\n            if (heig > 500) {\n                let ratio = wid / heig;\n                heig = 500;\n                wid = ratio * 500;\n            }\n            props.data.rect = { x: 0, y: 0 }\n            props.data.rect.x = props.data.location.x - wid / 2;\n            props.data.rect.y = props.data.location.y - heig / 2;\n            props.data.rect.width = wid;\n            props.data.rect.height = heig;\n\n            props.data.location.x = props.data.rect.x;\n            props.data.location.y = props.data.rect.y;\n            setData({ ...props.data })\n            //console.log(wid, heig)\n            //console.log(img.width, img.height)\n        }\n\n    }\n\n    if (props.data && props.data.rect) {\n        mystyle.left = `${props.data.rect.x}px`\n        mystyle.top = `${props.data.rect.y}px`\n        mystyle.width = `${props.data.rect.width}px`;\n        mystyle.height = `${props.data.rect.height}px`;\n    }\n\n    function setRect(rect) {\n        props.data.rect = { ...rect }\n        setData({ ...props.data })\n    }\n\n    function setOriginalSize() {\n        props.data.rect.width = props.data.originalSize.width;\n        props.data.rect.height = props.data.originalSize.height;\n        setData({ ...props.data })\n    }\n    \n    console.log('ImageView render', props)\n    return (\n        <div style={{ ...mystyle }}\n            ref={divEle}\n            οndragstart=\"return false;\"\n            draggable=\"false\"\n            onClick={e => {\n                e.stopPropagation();\n                e.preventDefault();\n            }}\n            onMouseDown={event => {\n                event.stopPropagation();\n                event.preventDefault();\n                props.data.zIndex = 9990;\n                divEle.current.style.zIndex = 9990;\n                props.sortMediaElements();\n                zIndexEventListener.callback();\n                props.hitTestOperate({\n                    ctrlData: {\n                        refObj: {\n                            current: divEle.current,\n                            divRef: divEle,\n                            onChangeRect,\n                            data: props.data\n                        },\n                        eleType: 'media',\n                        hit: {\n                            x: props.data.rect.x,\n                            y: props.data.rect.y\n                        },\n                        rect: {\n                            r: 0,\n                            ...props.data.rect\n                        }\n                    }\n                });\n\n            }}\n            onMouseUp={event => {\n                setData(props.data)\n                event.stopPropagation();\n                event.preventDefault();\n            }}\n            onLoad={() => {\n                if (props.data.autoSeleted) {\n                    props.data.autoSeleted = false;\n                    props.hitTestOperate({\n                        ctrlData: {\n                            refObj: {\n                                current: divEle.current,\n                                onChangeRect,\n                                data: props.data\n                            },\n                            eleType: 'media',\n                            hit: {\n                                x: props.data.rect.x,\n                                y: props.data.rect.y\n                            },\n                            rect: {\n                                r: 0,\n                                ...props.data.rect\n                            }\n                        }\n                    })\n                }\n            }}\n        >\n            <img src={props.data.src}\n                width='100%'\n                height='100%'\n                οndragstart=\"return false;\"\n                draggable=\"false\"\n            />\n        </div>\n    );\n}\n\nImageView.propTypes = {\n    data: PropTypes.object.isRequired,\n    sortMediaElements: PropTypes.func.isRequired,\n    hitTestOperate: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => {\n        return {\n            ctrlData: state.ctrlData,\n        }\n    },\n    { sortMediaElements, hitTestOperate }\n)(ImageView);\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport ImageView from './element-content/image-view'\nimport {zIndexEventListener} from './current-operate'\n\n\nclass MediaContainer extends React.Component {\n\n    //优化点：shouldComponentUpdate 比较集合或者选中的sheet是否发生变化。浅比较即可。\n\n    getStamp = () => (new Date().getTime().toString() + parseInt(Math.random() * 100))\n\n    render() {\n        zIndexEventListener.callback = ()=>{\n            //console.log('MediaContainer',this.props)\n            //this.forceUpdate();\n        }\n\n        console.log('MediaContainer',this.props)\n        let elements = this.props.media.map((val, idx) => {\n            return (\n                <ImageView data={val} key={idx}  />\n            )\n        })\n\n        return (\n            <>\n                {elements}\n            </>\n        )\n    }\n}\n\nMediaContainer.propTypes = {\n    media: PropTypes.array,\n}\n\nexport default connect(\n    state => {\n        let key = state.gridDatas['selectedKey'];\n        let media = [];\n        if (key) {\n            media = state.gridDatas.dic[key].media;\n        }\n        return { media }\n    },\n    {}\n)(MediaContainer);\n\n","import React, { useState } from 'react';\nimport PropTypes from 'prop-types'\n\n\nfunction CellInput(props) {\n    //const [data, setData] = useState(null);\n    //console.log(props)\n    let display = props.ctrlData.eleType === 'cell' ? 'block' : 'none';\n    const mystyle = {\n        display: display,\n        backgroundColor: '#00000000',\n        color: '#33333',\n        position: 'absolute',\n        left: `0px`,\n        top: `0px`,\n        width: '100%',\n        height: '100%',\n        opacity: '0'\n    }\n    let isEditable = false;\n\n    let setEditable = (target, isEdit) => {\n        if (isEdit) {\n            isEditable = true;\n            target.setAttribute(\"contentEditable\", 'plaintext-only');\n            target.style.opacity = '1';\n            target.focus();\n        } else {\n            target.blur();\n            target.setAttribute(\"contentEditable\", isEditable);\n            isEditable = false;\n        }\n    }\n\n    return (\n        <div style={{ ...mystyle, }}\n            onDoubleClick={e => {\n                setEditable(e.target, true);\n            }}\n            onBlur={e => {\n                isEditable = false;\n                e.target.setAttribute(\"contentEditable\", isEditable);\n                e.target.style.opacity = '0'\n            }}\n            onKeyDown={e => {\n                if ((e.keyCode || e.which) == 13) {\n                    if (isEditable) {\n                        //提交数据\n                        \n                        setEditable(e.target, false);\n                    } else {\n                        setEditable(e.target, true);\n                    }\n\n                }\n            }}\n        >\n\n        </div>\n    );\n}\n\nCellInput.propTypes = {\n    ctrlData: PropTypes.object.isRequired,\n}\n\n\nexport default CellInput;","import React, { useState } from 'react';\nimport PropTypes from 'prop-types'\nimport { dragMove } from '../current-operate'\nimport CellInput from '../element-content/cell-input'\n//import { Motion, spring } from 'react-motion';\n\nfunction CellController(props) {\n    dragMove.completed();\n    //const [data, setData] = useState(null);\n    //console.log(props)\n    let display = props.ctrlData.eleType === 'cell' ? 'block' : 'none';\n    const mystyle = {\n        display: display,\n        backgroundColor: '#ffffff00',\n        position: 'absolute',\n        left: `${props.ctrlData.rect.x - 1.9}px`,\n        top: `${props.ctrlData.rect.y - 1.5}px`,\n        width: `${props.ctrlData.rect.width + 3}px`,\n        height: `${props.ctrlData.rect.height + 3.5}px`,\n        overflow: 'visible',\n    }\n\n    function getDisplayRect(props) {\n        return {\n            left: `${props.ctrlData.rect.x - 1.9}px`,\n            top: `${props.ctrlData.rect.y - 1.5}px`,\n            width: `${props.ctrlData.rect.width + 3}px`,\n            height: `${props.ctrlData.rect.height + 3.5}px`,\n        }\n    }\n\n\n\n    return (\n        //contentEditable=\"true\"\n        //pointer-events: none; 忽略所有鼠标事件\n        <div autoFocus style={{\n            ...mystyle,\n            border: '2.2px solid #1890ff',\n            contentEditable: true,\n            zIndex: 99999,\n        }}\n            onClick={event => {\n                event.stopPropagation();\n            }}>\n                <CellInput ctrlData={props.ctrlData} />\n            <div style={{\n                position: 'absolute',\n                right: '-3.7px',\n                bottom: '-3.8px',\n                width: '6px',\n                height: '6px',\n                border: '1px solid #ffffff',\n                backgroundColor: '#1890ff',\n                overflow: 'visible',\n            }}>\n                \n            </div>\n        </div>\n\n    );\n}\n\nCellController.propTypes = {\n    ctrlData: PropTypes.object.isRequired,\n\n}\n\nexport default CellController;\n\n","import React, { useState, useRef } from 'react';\nimport PropTypes from 'prop-types'\nimport { dragMove } from '../current-operate'\n\n/*\nctrlData:{\n    refObj: null,\n    eleType: 'cell',\n    hit: { x: 60, y: 22 },\n    rect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        width,\n        height,\n    },\n    preRect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        width,\n        height,\n    }\n}\n*/\n\nfunction MediaController(props) {\n    dragMove.completed();\n\n    //const [rect, setRect] = useState(props.ctrlData.rect);\n    const divEle = useRef(null);\n    let display = props.ctrlData.eleType === 'media' ? 'block' : 'none';\n    //if()\n    const mystyle = {\n        display: display,\n        backgroundColor: '#ffffff00',\n        position: 'absolute',\n        overflow: 'visible',\n    }\n\n    if (display === 'block') {\n        mystyle.left = `${props.ctrlData.rect.x - 1.9}px`;\n        mystyle.top = `${props.ctrlData.rect.y - 1.5}px`;\n        mystyle.width = `${props.ctrlData.rect.width + 3}px`;\n        mystyle.height = `${props.ctrlData.rect.height + 3.5}px`;\n    }\n\n    const onChangeRect = (rect) => {\n        divEle.current.style.left = `${rect.x}px`;\n        divEle.current.style.top = `${rect.y}px`;\n        divEle.current.style.width = `${rect.width}px`;\n        divEle.current.style.height = `${rect.height}px`;\n    }\n\n\n\n    // eslint-disable-next-line no-unused-vars\n    function getDisplayRect(props) {\n        return {\n            left: `${props.ctrlData.rect.x - 1.9}px`,\n            top: `${props.ctrlData.rect.y - 1.5}px`,\n            width: `${props.ctrlData.rect.width + 3}px`,\n            height: `${props.ctrlData.rect.height + 3.5}px`,\n        }\n    }\n\n\n    let isDrag = false;\n    let dragX = 0;\n    let dragY = 0;\n\n\n    //console.log('render MediaController ')\n\n    return (\n        //contentEditable=\"true\"\n        //pointer-events: none; 忽略所有鼠标事件\n        <div autoFocus ref={divEle}\n            user-select='none'\n            webkit-user-select=\"none\"\n            style={{\n                ...mystyle,\n                border: '2.2px solid #1890ff',\n                contentEditable: true,\n                zIndex: 99999\n            }}\n\n            onClick={event => {\n                event.stopPropagation();\n                event.preventDefault();\n            }}\n\n            onMouseDown={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n                if (display === 'block') {\n                    dragMove.start(e.clientX, e.clientY);\n                    dragX = e.clientX;\n                    dragY = e.clientY\n                    isDrag = true;\n                    //console.log('onMouseDown')\n                    let rect = { ...props.ctrlData.rect }\n                    props.ctrlData.refObj.data.rect = { ...rect }\n\n                }\n\n            }}\n\n            onMouseMove={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n                if (!isDrag) {\n                    return;\n                }\n                //const { dx, dy } = dragMove.changed(e.clientX, e.clientY);\n                let dx = e.clientX - dragX;\n                let dy = e.clientY - dragY;\n                dragX = e.clientX;\n                dragY = e.clientY;\n                if (dx === 0 && dy === 0) {\n                    return;\n                }\n                let rect = { ...props.ctrlData.rect }\n                rect.x += dx;\n                rect.y += dy;\n                props.ctrlData.rect = { ...rect }\n                onChangeRect({ ...rect });\n                props.ctrlData.refObj.data.rect = { ...rect }\n                props.ctrlData.refObj.onChangeRect({ ...rect })\n                //console.log(dx)\n                //setRect(props.ctrlData.rect);\n            }}\n            onMouseUp={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n                //dragMove.completed();\n                isDrag = false;\n                dragX = 0;\n                dragY = 0;\n            }}\n        >\n            <div style={{\n                position: 'absolute',\n                right: '-3.7px',\n                bottom: '-3.8px',\n                width: '6px',\n                height: '6px',\n                border: '1px solid #ffffff',\n                backgroundColor: '#1890ff',\n                overflow: 'visible',\n                pointerEvents: 'none'\n            }}>\n            </div>\n        </div>\n\n    );\n}\n\nMediaController.propTypes = {\n    ctrlData: PropTypes.object.isRequired,\n}\n\nexport default MediaController;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ExcelSheet from './excel-sheet'\nimport UserHeader from './user-header'\nimport ToolsHeader from './tools-header'\nimport ToolsFooter from './tools-footer'\nimport cookie from 'react-cookies'\nimport { connect } from 'react-redux'\nimport { receiveUserInfo } from '../../redux/login/actions'\nimport {\n    changedExcelSize,\n    hitTestOperate,\n    addDragImage\n} from '../../redux/workplace/actions'\nimport {\n    scrollData,\n    headerData,\n    getOperatePositon\n} from './current-operate'\n\nimport MediaContainer from './media-container'\nimport CellController from './controllers/cell-controller'\nimport MediaController from './controllers/media-controller'\n\nimport '../../static/css/main-workplace.css'\n\n\nclass MainWorkplace extends React.Component {\n    constructor(props) {\n        super(props);\n        let loginCookie = cookie.load('loginCookie');\n        if (loginCookie !== undefined) {\n            var jstr = window.atob(loginCookie)\n            let login = JSON.parse(jstr);\n            if (login.userInfo.username !== undefined) {\n                this.props.receiveUserInfo(login);\n            }\n        }\n        this.getController();\n    }\n\n    currentController = null;\n    mediaElements = [];\n\n    componentDidMount() {\n        if (this.props.login.userInfo.username === undefined) {\n            this.props.history.replace('/excel-web/login/github')\n        }\n        let toolHeaderBox = document.getElementById(\"toolHeaderId\");\n        if (toolHeaderBox) {\n            this.toolsHeaderOffsetHeight = toolHeaderBox.offsetHeight\n            headerData.offsetHeight = toolHeaderBox.offsetHeight\n            //console.log(this.toolsHeaderOffsetHeight)\n        }\n    }\n\n    getController = () => {\n        if (this.props.ctrlData.eleType === 'cell') {\n            if (this.currentController && this.currentController instanceof CellController) {\n                //this.currentController.props.ctrlData\n                //console.log(this.currentController)\n            }\n            this.currentController = (<CellController ctrlData={this.props.ctrlData} />)\n        } else if (this.props.ctrlData.eleType === 'media') {\n            this.currentController = (<MediaController ctrlData={this.props.ctrlData} />)\n        }\n        return this.currentController;\n    }\n\n    getScrollData = (e) => {\n        scrollData.offsetX = e.target.scrollLeft;\n        scrollData.offsetY = e.target.scrollTop;\n    }\n\n    hitOperateLayerHandle = (e) => {\n        this.ignoreDrag(e)\n        //console.log('clickOperateLayerHandle', e.target)\n        let hit = getOperatePositon(e.clientX, e.clientY)\n        //console.log(this.props.ctrlData.hit)\n        if (e.clientX > this.props.excelSheet.width\n            || e.clientY > this.props.excelSheet.height) {\n            return;\n        }\n        let ctrlData = { ...this.props.ctrlData };\n        ctrlData.preRect = { ...this.props.ctrlData.preRect };\n        ctrlData.rect = { ...this.props.ctrlData.rect };\n        ctrlData.refObj = null;\n        ctrlData.hit = hit;\n        ctrlData.eleType = 'cell'\n        this.props.hitTestOperate({\n            ctrlData\n        })\n    }\n\n    ignoreDrag = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n    }\n\n    dropInHandle = (event) => {\n        this.ignoreDrag(event);\n        let files = event.dataTransfer.files;\n        let file = files[0];\n        if (file) {\n            console.log(file)\n            let reader = new FileReader();\n            let pos = getOperatePositon(event.clientX, event.clientY)\n            let add = this.props.addDragImage;\n            let exts = file.name.split('.');\n            reader.onload = function (e) {\n                add({\n                    fileType: 'img',\n                    ext: exts[exts.length - 1],\n                    src: e.target.result,\n                    location: pos,\n                    zIndex: 9990,\n                    autoSeleted: true\n                })\n            }\n            reader.readAsDataURL(file);\n        }\n    }\n    //功能增多后，主界面需要 shouldComponentUpdate 优化\n    render() {\n        //console.log('main work render')\n        //console.log(this.props)\n\n        return (\n            <div className='excel-main'>\n                <div className='tool-header' id='toolHeaderId'>\n                    <UserHeader />\n                    <ToolsHeader />\n                </div>\n                <div className='content-main' id='contentMainId' onScroll={this.getScrollData}>\n                    <div className='excel-container'>\n                        <div className='excel-component'\n                            style={{\n                                width: this.props.excelSheet.width + 300,\n                                height: parseInt(this.props.excelSheet.height) + 300\n                            }} >\n                            <ExcelSheet />\n                            <div className='operateLayer' id='operateLayerId'\n                                //屏蔽点击穿透！\n                                onClick={e => this.ignoreDrag(e)}\n                                onMouseDown={this.hitOperateLayerHandle}\n                                onDragEnter={this.ignoreDrag}\n                                onDragOver={(event => {\n                                    this.ignoreDrag(event)\n                                })}\n                                onDrop={this.dropInHandle}\n                            >\n                                <MediaContainer />\n\n                                {/* <CellController ctrlData={this.props.ctrlData} />\n                                <MediaController ctrlData={this.props.ctrlData} /> */}\n                                {this.getController()}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div className='tool-footer-container'>\n                    <ToolsFooter />\n                </div>\n            </div>\n        )\n    }\n}\n\nMainWorkplace.propTypes = {\n    history: PropTypes.object.isRequired,\n    login: PropTypes.object.isRequired,\n    excelSheet: PropTypes.object.isRequired,\n    ctrlData: PropTypes.object.isRequired,\n    gridDatas: PropTypes.object.isRequired,\n    receiveUserInfo: PropTypes.func.isRequired,\n    changedExcelSize: PropTypes.func.isRequired,\n    hitTestOperate: PropTypes.func.isRequired,\n    addDragImage: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => (state),\n    {\n        receiveUserInfo,\n        changedExcelSize,\n        hitTestOperate,\n        addDragImage\n    }\n)(MainWorkplace);\n\n","import React from 'react';\nimport MainLogin from './components/login/main-login'\nimport MainWorkplace from './components/workplace/main-workplace'\nimport { Route, Switch, Redirect } from 'react-router-dom'\nimport './App.css';\n\n\nclass App extends React.Component {\n  render() {\n    return (< div className=\"App\" >\n      < Switch >\n        < Route path='/excel-web/sheet' component={MainWorkplace} />\n        < Route path='/excel-web/login' component={MainLogin} />\n        < Redirect to='/excel-web/login' />\n      </Switch >\n    </div >\n    );\n  }\n}\n\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { DINGDING_LOGIN, GITHUB_LOGIN, USER_LOGOUT, RECEIVE_USER_INFO } from './action-types';\nimport cookie from 'react-cookies'\n\n\nconst initState = { userInfo: { errcode: 0 } };\n\nfunction login(state = initState, action) {\n  switch (action.type) {\n    //login的状态触发由receive完成\n    case DINGDING_LOGIN: \n      return state;\n    case GITHUB_LOGIN:\n      return state;\n    case USER_LOGOUT:\n      //删除缓存的额cookie，把状态设置为初始值\n      cookie.remove('loginCookie', { path: '/' });\n      return { ...initState };\n    case RECEIVE_USER_INFO:\n      // 这里的case要用大括号，防止变量穿透，由eslint报错提醒\n      {\n        let ret = { ...action.data };\n        if (action.data.errcode !== undefined) {\n          ret.userInfo.errcode = action.data.errcode;\n        }\n        else {\n          ret.userInfo.errcode = 0;\n        }\n        return { ...ret };\n      }\n    default:\n      return { ...state };\n  }\n}\n\nexport default login;","import { CHANGED_EXCEL_SIZE } from './action-types'\n\nconst initSize = { width: 0, height: 0 }\n\nconst excelSheet = (state = initSize, action) => {\n    switch (action.type) {\n        case CHANGED_EXCEL_SIZE:\n            return {...action.data }\n        default:\n            return state;\n    }\n}\n\nexport default excelSheet;","import {\n    ADD_EXCEL_SHEET,\n    REMOVE_EXCEL_SHEET,\n    CHANGE_EXCEL_SHEET_NAME,\n    CHANGE_EXCEL_SHEET_SELECTED,\n    DOWNLOAD_EXCEL,\n    GET_SELECTED_GRID,\n    ADD_DRAG_IMAGE,\n    SORT_MEDIA_ELEMENTS\n} from './action-types'\nimport Excel from 'exceljs';\nimport FileSaver from 'file-saver'\n\nconst defaultCellSize = {\n    width: 60,\n    height: 22\n}\n\nconst getPositionStrX = (inputX) => {\n    if (inputX < 0) {\n        throw Error('Error getPositionStrX inputX < 0')\n    }\n    let codeA = 'A'.charCodeAt(0);\n    let inX = inputX + 1;\n    let x = ''\n    do {\n        let numIdx = inX - 1;\n        let ascIdx = numIdx % 26;\n        x = String.fromCharCode(codeA + ascIdx) + x;\n        inX = parseInt(numIdx / 26);\n    }\n    while (inX > 0)\n    return x;\n}\n\nconst getCoordinates = (positionStr) => {\n    const row = positionStr.match(/[0-9]+/g) || [];\n    const col = positionStr.match(/[A-Z]+/g) || [];\n\n    if (row.length === 1 && col.length === 1) {\n        let colstr = col[0].toString();\n        let baseCode = 'A'.charCodeAt();\n        let colno = 0;\n        for (let index = 0; index < colstr.length; index++) {\n            const charIdx = colstr[index].charCodeAt() - baseCode + 1;\n            let temp = (Math.pow(26, colstr.length - index - 1) * charIdx)\n            colno += temp;\n        }\n        // x列 y行\n        return { x: colno - 1, y: parseInt(row[0]) - 1 }\n    }\n}\n\nconst createBlankGridData = (isTest) => {\n    let initGrid = [];\n    for (let row = 0; row < 160; row++) {\n        initGrid.push([]);\n        for (let col = 0; col < 30; col++) {\n            if (row === 0 && col === 0) {\n                initGrid[0].push({ readOnly: true, value: '' })\n            } else if (row === 0 && col > 0) {\n                let colstr = getPositionStrX(col - 1);\n                initGrid[0].push({ readOnly: true, value: colstr })\n            } else if (row > 0 && col === 0) {\n                initGrid[row].push({ readOnly: true, value: row })\n            } else {\n                //坐标测试验证\n                if (isTest) {\n                    if (row > 0 && col > 0) {\n                        var coor = getCoordinates(initGrid[0][col].value + row)\n                        initGrid[row].push({ value: `(${coor.x}, ${coor.y})` })\n                    }\n                } else {\n                    initGrid[row].push({ value: `` })\n                }\n            }\n        }\n    }\n    return initGrid;\n}\n\n\nconst download = (dic) => {\n    const wb = new Excel.Workbook();\n    for (let key in dic) {\n        const ws = wb.addWorksheet(dic[key].name);\n        ws.properties.defaultRowHeight = 17;\n        //这里行列不能搞混\n        let rowcount = dic[key].grid.length;\n        let colcount = dic[key].grid[0].length;\n\n        for (let rowidx = 1; rowidx < rowcount; rowidx++) {\n            for (let colidx = 1; colidx < colcount; colidx++) {\n                let row = ws.getRow(rowidx)\n                if (!row) {\n                    let rowdata = new Array(colcount).fill('');\n                    ws.addRow(rowdata);\n                    row = ws.getRow(rowidx)\n                }\n                row.height = 17;\n                row.getCell(colidx).value = dic[key].grid[rowidx][colidx].value;\n            }\n        }\n        //add image\n        if (dic[key].media.length > 0) {\n            let media = dic[key].media;\n            for (let index = 0; index < dic[key].media.length; index++) {\n                let imageId = wb.addImage({\n                    base64: media[index].src,\n                    extension: media[index].ext,\n                });\n                //console.log(media[index])\n                let tl = { col: 2, row: 2 }\n                let br = { col: 6, row: 5 }\n                if (media[index].rect) {\n                    tl.col = media[index].rect.x / defaultCellSize.width;\n                    tl.row = media[index].rect.y / defaultCellSize.height - 1;\n                    br.col = (media[index].rect.x + media[index].rect.width) / defaultCellSize.width;\n                    br.row = (media[index].rect.y + media[index].rect.height) / defaultCellSize.height - 1;\n                    tl.col = tl.col < 0 ? 0 : tl.col;\n                    tl.row = tl.row < 0 ? 0 : tl.row;\n                    br.col = br.col < 0 ? 5 : br.col;\n                    br.row = br.row < 0 ? 5 : br.row;\n                }\n                ws.addImage(imageId, { tl, br, editAs: 'oneCell' });\n            }\n        }\n\n    }\n\n    //网上的a标签+blob下载的例子会文件损坏，原因不明。\n    wb.xlsx.writeBuffer()\n        .then(buffer => FileSaver.saveAs(new Blob([buffer]), `excel-web${Date.now()}.xlsx`))\n        .catch(err => console.log('Error writing excel export', err))\n}\n\n\nconst getStamp = () => (new Date().getTime().toString() + parseInt(Math.random() * 100))\n\n/*\nmedia[]\n{\nfileType: 'img',\next:'png'\nsrc: e.target.result,\nlocation: pos,\nzIndex: 9990\n}\n*/\nconst initGridDatas = () => {\n    //字典\n    let dic = new Array();\n    let key1 = getStamp()\n    dic[key1] = {\n        name: 'Sheet1',\n        grid: createBlankGridData(false),\n        media: [],\n    }\n    dic[getStamp()] = {\n        name: 'Sheet2',\n        grid: createBlankGridData(true),\n        media: [],\n    }\n    return {\n        dic,\n        selectedKey: key1,\n        length: 2\n    };\n\n}\n\nconst blankData = initGridDatas();\n\nconst gridDatas = (state = blankData, action) => {\n    //console.log(\"gridDatas\", action);\n    switch (action.type) {\n        case ADD_EXCEL_SHEET:\n            {\n                let addstate = { ...(state) }\n                let nameidx = addstate.length + 1;\n                //sheetname 不能重复，否则download会报错\n                for (let asKey in addstate.dic) {\n                    if (addstate.dic[asKey].name === ('Sheet' + nameidx)) {\n                        nameidx++;\n                    }\n                }\n                let addkey = getStamp();\n                addstate.dic[addkey] = {\n                    grid: createBlankGridData(),\n                    name: 'Sheet' + nameidx,\n                    media: [],\n                };\n                addstate['selectedKey'] = addkey;\n                addstate.length += 1;\n                return addstate;\n            }\n        case REMOVE_EXCEL_SHEET:\n            {\n                //至少需要存在一张表\n                if (state.length < 2) {\n                    return state;\n                }\n                let rmdic = new Array();\n                let wouldSelect = undefined;\n                if (action.data.key !== state.selectedKey) {\n                    wouldSelect = state.selectedKey;\n                }\n                let hasRemove = false;\n                for (let key in state.dic) {\n                    if (key !== action.data.key) {\n                        rmdic[key] = state.dic[key]\n                        if (!wouldSelect) { wouldSelect = key }\n                        continue;\n                    }\n                    hasRemove = true;\n                }\n                if (hasRemove) {\n                    return {\n                        dic: rmdic,\n                        selectedKey: wouldSelect,\n                        length: state.length - 1\n                    };\n                }\n                return state;\n            }\n        case CHANGE_EXCEL_SHEET_NAME:\n            {\n                let changeState = { ...state }\n                if (state[action.data.key]) {\n                    changeState.dic[action.data.key].name =\n                        action.data.name;\n                    return changeState;\n                }\n                return state;\n            }\n        case CHANGE_EXCEL_SHEET_SELECTED:\n            {\n                let selectedState = { ...state }\n                if (selectedState['selectedKey']) {\n                    selectedState['selectedKey'] =\n                        action.data.key;\n                    return selectedState;\n                }\n                return state;\n            }\n        case DOWNLOAD_EXCEL:\n            {\n                download(state.dic)\n                return state;\n            }\n        case GET_SELECTED_GRID:\n            {\n                return state;\n            }\n        case ADD_DRAG_IMAGE:\n            {\n                let key = state['selectedKey'];\n                if (key) {\n                    let dic = state.dic[key];\n                    dic.media.push(action.data);\n                    dic.media = [...dic.media]\n                }\n                return state;\n            }\n        case SORT_MEDIA_ELEMENTS:\n            {\n                let key = state['selectedKey'];\n                if (key) {\n                    let dic = state.dic[key];\n                    //排序是正常\n                    //dic.media.sort((a, b) => (a.zIndex - b.zIndex));\n                    // let top = dic.media.filter(data => data.zIndex > 9900);\n                    // if(top.length === 1)\n                    // {\n                    //     let rmidx = dic.media.indexOf(top[0]);\n                    //     dic.media.splice(rmidx,1);\n                    //     dic.media.push(top[0]);\n                    //     console.log('SORT_MEDIA_ELEMENTS HAS CHANGED', state)\n                    // }\n                    //console.log('SORT_MEDIA_ELEMENTS HAS CHANGED', dic)\n                    // let hasChange = false;\n                    // for (let idx = 0; idx < dic.media.length; idx++) {\n                    //     if (dic.media[idx].zIndex != idx) {\n                    //         hasChange = true;\n                    //     }\n                    //     dic.media[idx].zIndex = idx;\n                    // }\n                    // if (!hasChange || dic.media.length < 2) {\n                    //     //console.log('SORT_MEDIA_ELEMENTS NO CHANGE', state)\n                    //     return state;\n                    // }\n\n                    dic.media = [...dic.media]\n                }\n                return state;\n            }\n        default:\n            return state;\n    }\n}\n\nexport default gridDatas;","import {\n    HIT_TEST_OPERATE\n} from './action-types'\n\n\nconst defaultCellSize = {\n    width: 60,\n    height: 22\n}\n\nconst initData = {\n    refObj: null,\n    eleType: 'cell',\n    hit: { x: 60, y: 22 },\n    rect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        ...defaultCellSize\n    },\n    preRect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        ...defaultCellSize\n    }\n}\n\nfunction locateVertical(defaultHeight, heights, offsetY) {\n    let changedCount = heights.length;\n    let changedOffset = 0;\n    for (let i = 0; i < changedCount; i++) {\n        changedOffset += heights[i][1];\n        // 之前的默认row height\n        let defaultoffset = (heights[i][0] - i) * defaultHeight;\n        // 检查是否超过offsetY\n        let checkoffset = (changedOffset + defaultoffset) - offsetY;\n        if (checkoffset >= 0) {\n            // 平齐\n            if (checkoffset === 0) {\n                return heights[i][0] + 1;\n            }\n            // 落在改变区间内\n            else if (checkoffset < heights[i][1]) {\n                return heights[i][0];\n            }\n            // 落在改变区间外\n            else {\n                // 当前的row坐标 - 多余的defaultHeight个数\n                return heights[i][0] - Math.ceil((checkoffset - heights[i][1]) / defaultHeight, 0);\n            }\n        }\n    }\n    let defaultOffset = offsetY - changedOffset;\n    let defaultCount = defaultOffset / defaultHeight;\n    let localPositionY = defaultCount + changedCount;\n    return parseInt(localPositionY)\n}\n\nfunction locateHorizontal(defaultWidth, widths, offsetX) {\n    let changedCount = widths.length;\n    let changedOffset = 0;\n    for (let i = 0; i < changedCount; i++) {\n        changedOffset += widths[i][1];\n        let defaultoffset = (widths[i][0] - i) * defaultWidth;\n        let checkoffset = (changedOffset + defaultoffset) - offsetX;\n        if (checkoffset >= 0) {\n            if (checkoffset === 0) {\n                return widths[i][0] + 1;\n            }\n            else if (checkoffset < widths[i][1]) {\n                return widths[i][0];\n            }\n            else {\n                return widths[i][0] - Math.ceil((checkoffset - widths[i][1]) / defaultWidth, 0);\n            }\n        }\n    }\n    let defaultOffset = offsetX - changedOffset;\n    let defaultCount = defaultOffset / defaultWidth;\n    let localPositionX = defaultCount + changedCount;\n    return parseInt(localPositionX)\n}\n\n\nconst ctrlData = (state = initData, action) => {\n    switch (action.type) {\n        case HIT_TEST_OPERATE:\n            {\n                //注意引用\n                state.refObj = null;\n                state.eleType = action.data.ctrlData.eleType;\n                if (action.data.ctrlData.eleType === 'cell') {\n                    let idxH = locateHorizontal(defaultCellSize.width, [], action.data.ctrlData.hit.x);\n                    let idxV = locateVertical(defaultCellSize.height, [], action.data.ctrlData.hit.y);\n\n                    // 将来要改成实际宽高\n                    let x = idxH * defaultCellSize.width;\n                    let y = idxV * defaultCellSize.height;\n                    let width = defaultCellSize.width;\n                    let height = defaultCellSize.height;\n                    state.rect = { x, y, width, height }\n                    state.coord = { x: idxH, y: idxV }\n                    \n                } else if (action.data.ctrlData.eleType === 'media') {\n                    state.refObj = action.data.ctrlData.refObj;\n                    action.data.ctrlData.preRect = { ...state.rect }\n                    state.rect = { ...action.data.ctrlData.rect }\n                    //action.data.ctrlData.refObj\n                }\n                //console.log('HIT_TEST_OPERATE')\n                return { ...state }\n            }\n        default:\n            return state;\n    }\n}\n\nexport default ctrlData;\n\n\n\n\n\n\n//cell 只有位置，拖拽为框选（宽高+位置），无缩放\n//image 交互，有缩放，有位移，有旋转\n\n\n","import { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nimport login from './login/reducers'\nimport excelSheet from './workplace/reducers'\nimport gridDatas from './workplace/reducers-grid-datas'\nimport  ctrlData  from './workplace/reducers-operate'\n\nimport { combineReducers } from 'redux'; //用于合并多个模块的reducers\n\n\n\n\nexport default createStore(\n    combineReducers({ login, excelSheet, gridDatas, ctrlData }),\n    applyMiddleware(thunk) // 应用异步中间件\n)","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter } from 'react-router-dom'\nimport { Provider } from 'react-redux'\n\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\n//绑定时会默认调用\nimport store from './redux/store'\n\n\nReactDOM.render(\n\n  <Provider store={store}> \n    <BrowserRouter>\n      <App />\n    </BrowserRouter>\n  </Provider>\n\n  ,\n  document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}