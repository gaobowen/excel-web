(this["webpackJsonpexcel-web"]=this["webpackJsonpexcel-web"]||[]).push([[0],{132:function(e,t,r){e.exports=r.p+"static/media/github.741c0ae1.svg"},134:function(e,t,r){e.exports=r.p+"static/media/main-bg.197637b0.png"},135:function(e,t,r){e.exports=r.p+"static/media/login-input-bg.cf01c34c.png"},146:function(e,t,r){e.exports=r(265)},155:function(e,t,r){},221:function(e,t,r){},228:function(e,t,r){},230:function(e,t,r){},231:function(e,t,r){},232:function(e,t,r){},237:function(e,t,r){},251:function(e,t,r){},254:function(e,t,r){},263:function(e,t,r){},264:function(e,t,r){},265:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(8),i=r.n(o),c=r(76),l=r(13),s=(r(155),r(15)),u=r(16),d=r(18),p=r(17),h=r(19),f=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).createSrc=function(){var e=r.props.options,t=e.goto,n=e.style,a=e.href,o=r.state.url+encodeURIComponent(t);return o+=n?"&style="+n:"",o+=a?"&href="+a:""},r.state={url:"https://login.dingtalk.com/login/qrcode.htm?goto="},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e={id:this.props.options.id,src:this.createSrc(),frameBorder:"0",allowtransparency:"true",scrolling:"no",width:this.props.options.width,height:this.props.options.height,className:this.props.className};return a.a.createElement("iframe",e)}}]),t}(a.a.Component);f.defaultProps={options:{id:"login_container",goto:"",style:"",href:"",width:"350px",height:"350px"},className:""};var g=f,b=r(40),m=r.n(b),y=r(21),v=r(63),O="DINGDING_LOGIN",E="GITHUB_LOGIN",w="USER_LOGOUT",j="RECEIVE_USER_INFO",D=(r(157),r(102)),x=r(129),S=r.n(x),P=r(32),I=r.n(P),k={postDinging:function(){return new Promise((function(e){I.a.remove("loginCookie",{path:"/"}),setTimeout((function(){var t={userInfo:{errcode:0,username:"DingUser",avatarUrl:"https://gtms03.alicdn.com/tps/i3/TB1opXxHXXXXXahXpXXvBLt6FXX-230-230.png"}};I.a.save("loginCookie",window.btoa(JSON.stringify(t)),{path:"/"}),e(t)}),300)}))}};k.getGithub=function(){var e=Object(v.a)(m.a.mark((function e(t){var r,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={userInfo:{errcode:0}},e.prev=1,e.next=4,S.a.get("https://api.github.com/users/".concat(t));case 4:n=e.sent,I.a.remove("loginCookie",{path:"/"}),void 0!==n.data.login?(r.userInfo.username=n.data.login,r.userInfo.avatarUrl=n.data.avatar_url,I.a.save("loginCookie",window.btoa(JSON.stringify(r)),{path:"/"})):(D.a.error("User name not found."),r.errcode=-1),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),D.a.error("User name not found.");case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();var C=k;function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _=function(e){return{type:j,data:e}},M=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={APPID:"dingoauctaoft7kia4pdvx",REDIRECT_URI:"https://gaobowen.github.io/excel-web/login/dingding"},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"UNSAFE_componentWillMount",value:function(){if(void 0!==this.props.location.search)if(-1===this.props.location.search.indexOf("dinglogin"));else{for(var e=this.props.location.search.replace("?","").split("&"),t={},r=0;r<e.length;r++){var n=e[r].split("=");t[n[0].toString()]=n[1]}this.props.loginDingding({})}}},{key:"componentDidMount",value:function(){var e=this,t=function(t){"https://login.dingtalk.com"===t.origin&&e.props.loginDingding({})};"undefined"!=typeof window.addEventListener?window.addEventListener("message",t,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onmessage",t)}},{key:"loginDingding",value:function(){console.log("loginDingding")}},{key:"render",value:function(){var e={id:"login-container",goto:"https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=".concat(this.state.APPID,"&response_type=code&scope=snsapi_login&state=dinglogin&redirect_uri=").concat(this.state.REDIRECT_URI),width:"350px",height:"350px"};return a.a.createElement("div",{id:"login-container",style:{opacity:.78}},a.a.createElement(g,{options:e}))}}]),t}(a.a.Component),A=Object(l.b)((function(e){return{login:e.login}}),{loginDingding:function(e){return function(){var t=Object(v.a)(m.a.mark((function t(r){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C.postDinging(e);case 2:n=t.sent,console.log(n),r(_(T({},n)));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(M),R=(r(73),r(35)),L=(r(218),r(142)),X=(r(123),r(78)),H=r(132),G=r.n(H),U=(r(221),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).loginGithub=function(){r.props.loginGithub(r.userName)},r.handleChange=function(e){r.userName=e.target.value},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{style:{width:"100%",height:"100%"}},a.a.createElement(X.a,{src:G.a,size:64,className:"login-github-svg"}),a.a.createElement("div",{className:"login-username-text"},"Github User Name"),a.a.createElement(L.a,{className:"login-username-input",placeholder:"User Name",onChange:this.handleChange,onPressEnter:this.loginGithub}),a.a.createElement(R.a,{type:"primary",className:"login-github-btn",onClick:this.loginGithub},"Login"))}}]),t}(a.a.Component)),z=Object(l.b)((function(e){return{login:e.login}}),{loginGithub:function(e){return function(){var t=Object(v.a)(m.a.mark((function t(r){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C.getGithub(e);case 2:n=t.sent,r(_(T({},n)));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(U),K=r(46),B=(r(228),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).changeLoginMode=function(e){var t="tab-li-github"===e.target.id?"github":"dingding";r.props.history.replace("/excel-web/login/"+t),r.setState({options:{loginMode:t}})},r.state={options:{loginMode:"dingding"}},void 0!==e.location&&("/excel-web/login/github"===e.location.pathname?e.options.loginMode="github":e.options.loginMode="dingding"),r.state.options.loginMode=e.options.loginMode,r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"login-view"},a.a.createElement("div",{className:"tab-div"},a.a.createElement("ul",{className:"tabs"},a.a.createElement("li",{id:"tab-li-dingding",className:"dingding"===this.state.options.loginMode?"tab-item current":"tab-item",onClick:this.changeLoginMode},"Dingding"),a.a.createElement("li",{id:"tab-li-github",className:"dingding"===this.state.options.loginMode?"tab-item":"tab-item current",onClick:this.changeLoginMode},"Github"))),a.a.createElement("div",{className:"login-view-content",key:this.props.location.key},a.a.createElement(K.d,null,a.a.createElement(K.b,{path:"/excel-web/login/dingding",component:A}),a.a.createElement(K.b,{path:"/excel-web/login/github",component:z}),a.a.createElement(K.a,{to:"/excel-web/login/dingding"}))))}}]),t}(a.a.Component));B.defaultProps={options:{loginMode:"dingding"}};var W=Object(K.g)(B),Y=r(134),F=r.n(Y),J=r(135),Z=r.n(J),V=(r(230),function(e){function t(e){var r;Object(s.a)(this,t),r=Object(d.a)(this,Object(p.a)(t).call(this,e));var n=I.a.load("loginCookie");if(void 0!==n){var a=window.atob(n),o=JSON.parse(a);void 0!==o.userInfo.username&&r.props.receiveUserInfo(o)}return r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){void 0!==this.props.userInfo.username&&this.props.history.replace("/excel-web/sheet",this.state)}},{key:"componentDidUpdate",value:function(){void 0!==this.props.userInfo.username&&this.props.history.replace("/excel-web/sheet",this.state)}},{key:"render",value:function(){return void 0!==this.props.userInfo.username?a.a.createElement("div",null):a.a.createElement("div",null,a.a.createElement("div",{className:"bgdiv"},a.a.createElement("img",{className:"bgimg",src:F.a,alt:"loginbgimg"})),a.a.createElement("div",{className:"logincontainer"},a.a.createElement("div",null,a.a.createElement("div",{className:"loginviewbg outradius"},a.a.createElement("img",{className:"loginviewbgimg",src:Z.a,alt:""})),a.a.createElement(W,null))))}}]),t}(a.a.Component)),q=Object(l.b)((function(e){return{userInfo:e.login.userInfo}}),{receiveUserInfo:_})(V),$={offsetX:0,offsetY:0},Q={offsetHeight:0},ee=function(e,t){return{x:e+$.offsetX,y:t-Q.offsetHeight+$.offsetY}},te=function(){return(new Date).getTime().toString()+parseInt(100*Math.random())},re={x:0,y:0,isDrag:!1,start:function(e,t){this.isDrag=!0,this.x=e,this.y=t},changed:function(e,t){if(!this.isDrag)return this.x=0,this.y=0,{dx:0,dy:0};var r=e-this.x,n=t-this.y;return this.x=e,this.y=t,{dx:r,dy:n}},completed:function(){this.x=0,this.y=0,this.isDrag=!1}},ne={callback:function(){}},ae={current:void 0},oe=function(e,t,r){ae.current.rows&&(ae.current.rows[e].cells[t].childNodes[0].innerHTML=r.value)},ie=function(e){return{type:"CHANGED_EXCEL_SIZE",data:e}},ce=function(e){return{type:"CHANGE_EXCEL_SHEET_SELECTED",data:e}},le=function(e){return{type:"HIT_TEST_OPERATE",data:e}},se=function(e){return{type:"SORT_MEDIA_ELEMENTS",data:e}},ue=(r(231),r(232),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).getCoordinates=function(e){var t=e.match(/[0-9]+/g)||[],r=e.match(/[A-Z]+/g)||[];if(1===t.length&&1===r.length){for(var n=r[0].toString(),a="A".charCodeAt(),o=0,i=0;i<n.length;i++){var c=n[i].charCodeAt()-a+1;o+=Math.pow(26,n.length-i-1)*c}return{x:o-1,y:parseInt(t[0])-1}}},r.getPositionStr=function(e){var t=parseInt(e.x);return r.getPositionStrX(t)+(e.y+1)},r.getPositionStrX=function(e){if(e<0)throw Error("Error getPositionStrX inputX < 0");var t="A".charCodeAt(0),r=e+1,n="";do{var a=r-1,o=a%26;n=String.fromCharCode(t+o)+n,r=parseInt(a/26)}while(r>0);return n},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.grid=this.props.gridDatas.dic[this.props.gridDatas.selectedKey].grid,this.totalWidth=60*this.grid[0].length,this.totalHeight=22*this.grid.length,this.totalWidth===this.props.excelSheet.width&&this.totalHeight===this.props.excelSheet.height||this.props.changedExcelSize({width:this.totalWidth,height:this.totalHeight}),a.a.createElement("div",{style:{width:this.totalWidth}},a.a.createElement("table",{className:"static-table",borderspacing:0,cellSpacing:0,cellPadding:0},a.a.createElement("tbody",{id:"excel-sheet-main-tbody",ref:function(e){ae.current=e}},this.grid.map((function(e,t){return a.a.createElement("tr",{key:"-".concat(t,"-"),className:"row",style:{}},e.map((function(e,r){return a.a.createElement("td",{key:"-".concat(t,"-|").concat(r,"|"),className:"cell",style:function(){if(0===t||0===r)return{backgroundColor:"#ddd"}}()},a.a.createElement("div",{style:{width:"58px",height:"20px",textOverflow:"ellipsis"}},e.value))})))})))))}}]),t}(a.a.Component)),de=Object(l.b)((function(e){return{gridDatas:e.gridDatas,excelSheet:e.excelSheet}}),{changedExcelSize:ie,changeExcelSheetSelected:ce})(ue),pe=(r(233),r(143)),he=(r(266),r(79)),fe=(r(237),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).download=function(){r.props.downloadExcel()},r.state={},r.handleMenuClick=function(e){"2"===e.key&&(r.props.logout({}),window.open(encodeURI("http://"+window.location.host+"/excel-web"),"_parent"))},r.state.downMenu=a.a.createElement(he.a,{onClick:r.handleMenuClick},a.a.createElement(he.a.Item,{className:"menu-item",key:"1"},r.props.login.userInfo.username),a.a.createElement(he.a.Item,{className:"menu-item",key:"2"},"Logout")),r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"user-header"},a.a.createElement("div",{className:"header-title"},"Technology Changes Lives"),a.a.createElement("div",{className:"items"},a.a.createElement(pe.a,{overlay:this.state.downMenu,className:"item avatar"},a.a.createElement(X.a,{size:40,src:this.props.login.userInfo.avatarUrl,className:"item avatar"})),a.a.createElement("div",{className:"item split"}),a.a.createElement(R.a,{type:"primary",icon:"download",className:"item btn",onClick:this.download},"Download")))}}]),t}(a.a.Component)),ge=Object(l.b)((function(e){return e}),{logout:function(e){return{type:w,data:e}},downloadExcel:function(e){return{type:"DOWNLOAD_EXCEL",data:e}}})(fe),be=(r(249),r(10)),me=(r(251),function(e){function t(){var e,r;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).iconbtn=function(e,t){return a.a.createElement("div",{className:"item",key:t},a.a.createElement(be.a,{type:e}))},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"tools-header"},a.a.createElement("div",{className:"item split"}),["edit","copy","delete","align-center","align-left","align-right","bg-colors","bold","italic","underline","font-colors","font-size"].map((function(t,r){return e.iconbtn(t,r)})),a.a.createElement("div",{className:"item split"}),["area-chart","pie-chart","bar-chart","dot-chart","line-chart","radar-chart","fund"].map((function(e,t){return a.a.createElement("div",{className:"item",key:"chart"+t},a.a.createElement(be.a,{type:e}))})),a.a.createElement("div",{className:"item split"}),["line-height","column-width","column-height","sort-ascending","sort-descending"].map((function(e,t){return a.a.createElement("div",{className:"item",key:"editExts"+t},a.a.createElement(be.a,{type:e}))})))}}]),t}(a.a.Component)),ye=Object(l.b)((function(e){return e}),{})(me),ve=(r(252),r(101)),Oe=(r(254),ve.a.TabPane),Ee={refObj:null,eleType:"cell",hit:{x:60,y:22},rect:{x:60,y:22,r:0,width:60,height:22},preRect:{x:60,y:22,r:0,width:60,height:22}},we=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).onChange=function(e){r.props.changeExcelSheetSelected({key:e}),r.props.hitTestOperate({ctrlData:Ee})},r.onEdit=function(e,t){r[t](e),r.props.hitTestOperate({ctrlData:Ee})},r.add=function(){r.props.addExcelSheet()},r.remove=function(e){r.props.removeExcelSheet({key:e})},r.componentDidMount=function(){},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e in this.panes=[],this.props.gridDatas.dic)this.panes.push({title:this.props.gridDatas.dic[e].name,content:"",key:e});return a.a.createElement("div",{className:"tools-footer"},a.a.createElement(ve.a,{onChange:this.onChange,activeKey:this.props.gridDatas.selectedKey,type:"editable-card",onEdit:this.onEdit},this.panes.map((function(e){return a.a.createElement(Oe,{tab:e.title,key:e.key},e.content)}))))}}]),t}(a.a.Component),je=Object(l.b)((function(e){return{gridDatas:e.gridDatas}}),{addExcelSheet:function(e){return{type:"ADD_EXCEL_SHEET",data:e}},removeExcelSheet:function(e){return{type:"REMOVE_EXCEL_SHEET",data:e}},changeExcelSheetName:function(e){return{type:"CHANGE_EXCEL_SHEET_NAME",data:e}},changeExcelSheetSelected:ce,hitTestOperate:le})(we),De=r(29);function xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xe(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xe(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Pe=Object(l.b)((function(e){return{ctrlData:e.ctrlData}}),{sortMediaElements:se,hitTestOperate:le})((function(e){var t=Object(n.useState)(e.data.id),r=Object(De.a)(t,2),o=(r[0],r[1]),i=Object(n.useState)(e.data),c=Object(De.a)(i,2),l=(c[0],c[1]),s=Object(n.useState)(e.data.zIndex),u=Object(De.a)(s,2),d=(u[0],u[1]),p=Object(n.useState)(null),h=Object(De.a)(p,2),f=(h[0],h[1]),g=Object(n.useState)(e.data.reat),b=Object(De.a)(g,2),m=(b[0],b[1],Object(n.useState)(null)),y=Object(De.a)(m,2),v=y[0],O=(y[1],Object(n.useRef)(null)),E=function(e,t){v&&(v.style.left="".concat(t.x,"px"),v.style.top="".concat(t.y,"px"),v.style.width="".concat(t.width,"px"),v.style.height="".concat(t.height,"px"))},w=Object(n.useRef)(E),j={backgroundColor:"#00000088",position:"absolute",left:"".concat(e.data.location.x,"px"),top:"".concat(e.data.location.y,"px"),zIndex:e.data.zIndex};if(!e.data.rect){var D=new Image;D.src=e.data.src,D.onload=function(){var t=D.width,r=D.height;if(e.data.originalSize={width:t,height:r},t>500){var n=r/t;t=500,r=500*n}if(r>500){var a=t/r;r=500,t=500*a}e.data.rect={x:0,y:0},e.data.rect.x=e.data.location.x-t/2,e.data.rect.y=e.data.location.y-r/2,e.data.rect.width=t,e.data.rect.height=r,e.data.location.x=e.data.rect.x,e.data.location.y=e.data.rect.y,l(Se({},e.data))}}return e.data&&e.data.rect&&(j.left="".concat(e.data.rect.x,"px"),j.top="".concat(e.data.rect.y,"px"),j.width="".concat(e.data.rect.width,"px"),j.height="".concat(e.data.rect.height,"px")),a.a.createElement("div",{id:e.data.id,style:Se({},j),ref:O,"\u03bfndragstart":"return false;",draggable:"false",onClick:function(e){e.stopPropagation(),e.preventDefault()},onMouseDown:function(t){t.stopPropagation(),t.preventDefault(),e.data.zIndex=9990,d(9990),e.sortMediaElements(),ne.callback(),f(t.target),document.getElementById(e.data.id).style.zIndex=9990,o(e.data.id),e.hitTestOperate({ctrlData:{refObj:{id:e.data.id,current:O.current,divRef:O,onChangeRect:E,data:e.data,onChangeRectRef:w},eleType:"media",hit:{x:t.clientX,y:t.clientY},rect:Se({r:0},e.data.rect),autoPress:!0}})},onMouseUp:function(t){l(e.data),t.stopPropagation(),t.preventDefault()},onLoad:function(){e.data.autoSeleted&&(e.data.autoSeleted=!1,e.hitTestOperate({ctrlData:{refObj:{current:O.current,onChangeRect:E,data:e.data},eleType:"media",hit:{x:e.data.rect.x,y:e.data.rect.y},rect:Se({r:0},e.data.rect)}}))}},a.a.createElement("img",{src:e.data.src,width:"100%",height:"100%","\u03bfndragstart":"return false;",draggable:"false"}))})),Ie=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.media.map((function(e,t){return a.a.createElement(Pe,{data:e,key:t})}));return a.a.createElement(a.a.Fragment,null,e)}}]),t}(a.a.Component),ke=Object(l.b)((function(e){var t=e.gridDatas.selectedKey,r=[];return t&&(r=e.gridDatas.dic[t].media),{media:r}}),{})(Ie);function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ce(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Te=Object(l.b)((function(e){return{gridDatas:e.gridDatas}}),{commitUpdateGridDatas:function(e){return{type:"COMMIT_UPDATE_GRIDDATAS",data:e}}})((function(e){var t=Object(n.useState)(e),r=Object(De.a)(t,2),o=r[0],i=r[1],c=Object(n.useRef)(),l=Object(n.useRef)(),s={position:"",display:"cell"===e.ctrlData.eleType?"block":"none",outlineStyle:"none",width:"".concat(e.ctrlData.rect.width,"px"),height:"".concat(e.ctrlData.rect.height,"px"),opacity:"0",whiteSpace:"nowrap"},u={left:"0px",top:"0px",borderWidth:"0px",outlineStyle:"none",pointerEvents:"none",width:"".concat(e.ctrlData.rect.width-1,"px"),height:"".concat(e.ctrlData.rect.height-1,"px"),position:"absolute",overflow:"hidden"},d={divStyle:s,inputStyle:u},p=Object(n.useState)(d),h=Object(De.a)(p,2),f=h[0],g=h[1],b=function(){var t=e.gridDatas.selectedKey;if(t)return e.gridDatas.dic[t].grid[e.ctrlData.coord.rowIdx][e.ctrlData.coord.colIdx]}(),m=Object(n.useState)(b),y=Object(De.a)(m,2),v=y[0],O=y[1];Object.is(b,v)||(oe(o.ctrlData.coord.rowIdx,o.ctrlData.coord.colIdx,v),O(b)),Object.is(o,e)||(i(e),g(d)),Object(n.useEffect)((function(){l.current&&(l.current.value=b.value)}));var E=function(e){if(e){var t=Ne({},s);t.opacity="1";var r=Ne({},u);r.pointerEvents="auto",g({divStyle:t,inputStyle:r}),l.current.readOnly="",l.current.focus()}else{l.current.blur();var n=Ne({},s);n.opacity="0";var a=Ne({},u);a.pointerEvents="none",l.current.readOnly="readonly",g({divStyle:n,inputStyle:a})}},w=function(e){e.stopPropagation(),e.preventDefault()};return a.a.createElement("div",{ref:c,style:f.divStyle,onDoubleClick:function(){E(!0)},onClick:w,onMouseDown:w},a.a.createElement("input",{type:"text",readOnly:"readonly",style:Ne({},f.inputStyle),ref:l,onChange:function(e){v.value=e.target.value,oe(o.ctrlData.coord.rowIdx,o.ctrlData.coord.colIdx,v)},onBlur:function(){oe(o.ctrlData.coord.rowIdx,o.ctrlData.coord.colIdx,v)},onKeyDown:function(e){"13"==e.keyCode&&E(!1)},width:"100%",height:"100%"}))}));function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ae=function(e){re.completed();var t={display:"cell"===e.ctrlData.eleType?"block":"none",backgroundColor:"#ffffff00",position:"absolute",left:"".concat(e.ctrlData.rect.x-1.9,"px"),top:"".concat(e.ctrlData.rect.y-1.5,"px"),width:"".concat(e.ctrlData.rect.width+3,"px"),height:"".concat(e.ctrlData.rect.height+3.5,"px"),overflow:"visible"};return a.a.createElement("div",{style:Me({},t,{border:"2.2px solid #1890ff",zIndex:99999}),onClick:function(e){e.stopPropagation()}},a.a.createElement(Te,{ctrlData:Me({},e.ctrlData)}),a.a.createElement("div",{style:{position:"absolute",right:"-3.7px",bottom:"-3.8px",width:"6px",height:"6px",border:"1px solid #ffffff",backgroundColor:"#1890ff",overflow:"visible"}}))};function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Xe=Object(l.b)((function(e){return{ctrlData:e.ctrlData}}),{sortMediaElements:se,hitTestOperate:le})((function(e){re.completed();var t=Object(n.useRef)(null),r=Object(n.useState)(e.ctrlData),o=Object(De.a)(r,2),i=o[0],c=o[1];Object.is(i,e.ctrlData)||c(e.ctrlData);var l=document.getElementById(e.ctrlData.refObj.data.id);e.ctrlData.refObj.data.zIndex=9991,l.style.zIndex=9991;var s="media"===e.ctrlData.eleType?"block":"none";if("media"===e.ctrlData.eleType){var u={display:s,backgroundColor:"#ffffff00",position:"absolute",overflow:"visible"},d=e.ctrlData.rect.x,p=e.ctrlData.rect.y,h=e.ctrlData.rect.width,f=e.ctrlData.rect.height;"block"===s&&(u.left="".concat(d-1.9,"px"),u.top="".concat(p-1.5,"px"),u.width="".concat(h+3,"px"),u.height="".concat(f+3.5,"px"));var g=function(e){e.stopPropagation(),e.preventDefault()},b=!1,m=0,y=0;window.onkeydown=function(e){i.refObj&&t.current&&8===e.keyCode&&v()},window.addEventListener("mouseup",(function(){b=!1,m=0,y=0}),!0),window.addEventListener("mousemove",(function(r){if(b&&e.ctrlData.refObj&&l){var n=r.clientX-m,a=r.clientY-y;if(m=r.clientX,y=r.clientY,0!==n||0!==a){var o=Le({},e.ctrlData.rect);o.x+=n,o.y+=a,function(e){t.current&&(t.current.style.left="".concat(e.x-1.9,"px"),t.current.style.top="".concat(e.y-1.5,"px"),t.current.style.width="".concat(e.width+3,"px"),t.current.style.height="".concat(e.height+3.5,"px"))}(o),e.ctrlData.rect=Le({},o),e.ctrlData.refObj.data.rect=Le({},o),l.style.left="".concat(o.x,"px"),l.style.top="".concat(o.y,"px"),l.style.width="".concat(o.width,"px"),l.style.height="".concat(o.height,"px")}}}),!0),e.ctrlData.autoPress&&(b=!0,m=e.ctrlData.hit.x,y=e.ctrlData.hit.y);var v=function(){e.ctrlData.refObj.data.isDelete=!0,e.sortMediaElements(),e.hitTestOperate({ctrlData:{refObj:null,eleType:"cell",hit:{x:60,y:22},rect:{x:60,y:22,r:0,width:60,height:22},preRect:{x:60,y:22,r:0,width:60,height:22}}}),l=null,e.ctrlData.refObj=null,t.current=null};return a.a.createElement("div",{autoFocus:!0,ref:t,tabIndex:0,"user-select":"none","webkit-user-select":"none",style:Le({},u,{border:"2.2px solid #1890ff",contentEditable:!0,zIndex:99999}),onClick:g,onMouseDown:function(t){g(t),"block"===s&&i.refObj&&(m=t.clientX,y=t.clientY,b=!0,e.ctrlData.refObj.data.rect=Le({},e.ctrlData.rect),e.ctrlData.hit=ee(t.clientX,t.clientY))},onMouseMove:function(e){g(e)},onMouseUp:function(e){e.stopPropagation(),e.preventDefault(),b=!1,m=0,y=0}},a.a.createElement("div",{style:{position:"absolute",right:"-3.7px",bottom:"-3.8px",width:"6px",height:"6px",border:"1px solid #ffffff",backgroundColor:"#1890ff",overflow:"visible",pointerEvents:"none"}}))}}));r(263);function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ue=function(e){function t(e){var r;Object(s.a)(this,t),(r=Object(d.a)(this,Object(p.a)(t).call(this,e))).currentController=null,r.mediaElements=[],r.getController=function(){return"cell"===r.props.ctrlData.eleType?(r.currentController&&r.currentController,r.currentController=a.a.createElement(Ae,{ctrlData:Ge({},r.props.ctrlData)})):"media"===r.props.ctrlData.eleType&&(r.currentController=a.a.createElement(Xe,{ctrlData:Ge({},r.props.ctrlData)})),r.currentController},r.getScrollData=function(e){$.offsetX=e.target.scrollLeft,$.offsetY=e.target.scrollTop},r.hitOperateLayerHandle=function(e){r.ignoreDrag(e),e.target.focus();var t=ee(e.clientX,e.clientY);if(!(e.clientX>r.props.excelSheet.width||e.clientY>r.props.excelSheet.height)){var n=Ge({},r.props.ctrlData);n.preRect=Ge({},r.props.ctrlData.preRect),n.rect=Ge({},r.props.ctrlData.rect),n.refObj=null,n.hit=t,n.eleType="cell",r.props.hitTestOperate({ctrlData:n})}},r.ignoreDrag=function(e){e.stopPropagation(),e.preventDefault()},r.dropInHandle=function(e){r.ignoreDrag(e);var t=e.dataTransfer.files[0];if(t){var n=new FileReader,a=ee(e.clientX,e.clientY),o=r.props.addDragImage,i=t.name.split(".");n.onload=function(e){o({id:te(),fileType:"img",ext:i[i.length-1],src:e.target.result,location:a,zIndex:9990,autoSeleted:!0})},n.readAsDataURL(t)}};var n=I.a.load("loginCookie");if(void 0!==n){var o=window.atob(n),i=JSON.parse(o);void 0!==i.userInfo.username&&r.props.receiveUserInfo(i)}return r.getController(),r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){void 0===this.props.login.userInfo.username&&this.props.history.replace("/excel-web/login/github");var e=document.getElementById("toolHeaderId");e&&(this.toolsHeaderOffsetHeight=e.offsetHeight,Q.offsetHeight=e.offsetHeight)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"excel-main"},a.a.createElement("div",{className:"tool-header",id:"toolHeaderId"},a.a.createElement(ge,null),a.a.createElement(ye,null)),a.a.createElement("div",{className:"content-main",id:"contentMainId",onScroll:this.getScrollData},a.a.createElement("div",{className:"excel-container"},a.a.createElement("div",{className:"excel-component",style:{width:this.props.excelSheet.width+300,height:parseInt(this.props.excelSheet.height)+300}},a.a.createElement(de,null),a.a.createElement("div",{className:"operateLayer",id:"operateLayerId",onClick:function(t){return e.ignoreDrag(t)},onContextMenu:function(t){return e.ignoreDrag(t)},onMouseDown:this.hitOperateLayerHandle,onDragEnter:this.ignoreDrag,onDragOver:function(t){e.ignoreDrag(t)},onDrop:this.dropInHandle},a.a.createElement(ke,null),this.getController())))),a.a.createElement("div",{className:"tool-footer-container"},a.a.createElement(je,null)))}}]),t}(a.a.Component),ze=Object(l.b)((function(e){return e}),{receiveUserInfo:_,changedExcelSize:ie,hitTestOperate:le,addDragImage:function(e){return{type:"ADD_DRAG_IMAGE",data:e}}})(Ue),Ke=(r(264),function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(K.d,null,a.a.createElement(K.b,{path:"/excel-web/sheet",component:ze}),a.a.createElement(K.b,{path:"/excel-web/login",component:q}),a.a.createElement(K.a,{to:"/excel-web/login"})))}}]),t}(a.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Be=r(51),We=r(139);function Ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ye(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ye(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Je={userInfo:{errcode:0}};var Ze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:case E:return e;case w:return I.a.remove("loginCookie",{path:"/"}),Fe({},Je);case j:var r=Fe({},t.data);return void 0!==t.data.errcode?r.userInfo.errcode=t.data.errcode:r.userInfo.errcode=0,Fe({},r);default:return Fe({},e)}};function Ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ve(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ve(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $e={width:0,height:0},Qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$e,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGED_EXCEL_SIZE":return qe({},t.data);default:return e}},et=r(144),tt=r(140),rt=r.n(tt),nt=r(141),at=r.n(nt);function ot(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function it(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ot(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ot(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ct=60,lt=22,st=function(e){if(e<0)throw Error("Error getPositionStrX inputX < 0");var t="A".charCodeAt(0),r=e+1,n="";do{var a=r-1,o=a%26;n=String.fromCharCode(t+o)+n,r=parseInt(a/26)}while(r>0);return n},ut=function(e){var t=e.match(/[0-9]+/g)||[],r=e.match(/[A-Z]+/g)||[];if(1===t.length&&1===r.length){for(var n=r[0].toString(),a="A".charCodeAt(),o=0,i=0;i<n.length;i++){var c=n[i].charCodeAt()-a+1;o+=Math.pow(26,n.length-i-1)*c}return{x:o-1,y:parseInt(t[0])-1}}},dt=function(e){for(var t=[],r=0;r<1001;r++){t.push([]);for(var n=0;n<32;n++)if(0===r&&0===n)t[0].push({readOnly:!0,value:""});else if(0===r&&n>0){var a=st(n-1);t[0].push({readOnly:!0,value:a})}else if(r>0&&0===n)t[r].push({readOnly:!0,value:r});else if(e){if(r>0&&n>0){var o=ut(t[0][n].value+r);t[r].push({value:"(".concat(o.x,", ").concat(o.y,")")})}}else t[r].push({value:""})}return t},pt=function(e){var t=new rt.a.Workbook;for(var r in e){var n=t.addWorksheet(e[r].name);n.properties.defaultRowHeight=17;for(var a=e[r].grid.length,o=e[r].grid[0].length,i=1;i<a;i++)for(var c=1;c<o;c++){var l=n.getRow(i);if(!l){var s=new Array(o).fill("");n.addRow(s),l=n.getRow(i)}l.height=17,l.getCell(c).value=e[r].grid[i][c].value}if(e[r].media.length>0)for(var u=e[r].media,d=0;d<e[r].media.length;d++){var p=t.addImage({base64:u[d].src,extension:u[d].ext}),h={col:2,row:2},f={col:6,row:5};u[d].rect&&(h.col=u[d].rect.x/ct-1,h.row=u[d].rect.y/lt-1,f.col=(u[d].rect.x+u[d].rect.width)/ct-1,f.row=(u[d].rect.y+u[d].rect.height)/lt-1,h.col=h.col<0?0:h.col,h.row=h.row<0?0:h.row,f.col=f.col<0?5:f.col,f.row=f.row<0?5:f.row),n.addImage(p,{tl:h,br:f,editAs:"oneCell"})}}t.xlsx.writeBuffer().then((function(e){return at.a.saveAs(new Blob([e]),"excel-web".concat(Date.now(),".xlsx"))})).catch((function(e){return console.log("Error writing excel export",e)}))},ht=function(){return(new Date).getTime().toString()+parseInt(100*Math.random())},ft=function(){var e=new Array,t=ht();return e[t]={name:"Sheet1",grid:dt(!1),media:[]},e[ht()]={name:"Sheet2",grid:dt(!0),media:[]},{dic:e,selectedKey:t,length:2}}(),gt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ft,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_EXCEL_SHEET":var r=it({},e),n=r.length+1;for(var a in r.dic)r.dic[a].name==="Sheet"+n&&n++;var o=ht();return r.dic[o]={grid:dt(),name:"Sheet"+n,media:[]},r.selectedKey=o,r.length+=1,r;case"REMOVE_EXCEL_SHEET":if(e.length<2)return e;var i=new Array,c=void 0;t.data.key!==e.selectedKey&&(c=e.selectedKey);var l=!1;for(var s in e.dic)s===t.data.key?l=!0:(i[s]=e.dic[s],c||(c=s));return l?{dic:i,selectedKey:c,length:e.length-1}:e;case"CHANGE_EXCEL_SHEET_NAME":var u=it({},e);return e[t.data.key]?(u.dic[t.data.key].name=t.data.name,u):e;case"CHANGE_EXCEL_SHEET_SELECTED":var d=it({},e);return d.selectedKey?(d.selectedKey=t.data.key,d):e;case"DOWNLOAD_EXCEL":return pt(e.dic),e;case"GET_SELECTED_GRID":return e;case"ADD_DRAG_IMAGE":var p=e.selectedKey;if(p){var h=e.dic[p];h.media.push(t.data),h.media=Object(et.a)(h.media)}return e;case"SORT_MEDIA_ELEMENTS":var f=e.selectedKey;if(f){var g=e.dic[f],b=g.media.findIndex((function(e){return e.isDelete}));b>-1&&(g.media=g.media.slice(0,b).concat(g.media.slice(b+1,g.media.length))),g.media.sort((function(e,t){return e.zIndex-t.zIndex}));for(var m=!1,y=0;y<g.media.length;y++)g.media[y].zIndex!==y&&(m=!0),g.media[y].zIndex=y;if(!m||g.media.length<2)return e}return e;case"COMMIT_UPDATE_GRIDDATAS":return it({},e);default:return e}};function bt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function mt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bt(r,!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bt(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var yt={width:60,height:22},vt={refObj:null,eleType:"cell",hit:{x:60,y:22},rect:mt({x:60,y:22,r:0},yt),preRect:mt({x:60,y:22,r:0},yt),coord:{rowIdx:1,colIdx:1}};function Ot(e,t,r){for(var n=t.length,a=0,o=0;o<n;o++){var i=(a+=t[o][1])+(t[o][0]-o)*e-r;if(i>=0)return 0===i?t[o][0]+1:i<t[o][1]?t[o][0]:t[o][0]-Math.ceil((i-t[o][1])/e,0)}return parseInt((r-a)/e+n)}function Et(e,t,r){for(var n=t.length,a=0,o=0;o<n;o++){var i=(a+=t[o][1])+(t[o][0]-o)*e-r;if(i>=0)return 0===i?t[o][0]+1:i<t[o][1]?t[o][0]:t[o][0]-Math.ceil((i-t[o][1])/e,0)}return parseInt((r-a)/e+n)}var wt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"HIT_TEST_OPERATE":if(e.refObj=null,e.preRect=e.rect,e.eleType=t.data.ctrlData.eleType,"cell"===t.data.ctrlData.eleType){var r=Et(yt.width,[],t.data.ctrlData.hit.x),n=Ot(yt.height,[],t.data.ctrlData.hit.y);if(r<1||n<1)return e;var a=r*yt.width,o=n*yt.height,i=yt.width,c=yt.height;e.rect={x:a,y:o,width:i,height:c},e.coord={rowIdx:n,colIdx:r}}else"media"===t.data.ctrlData.eleType&&(e.refObj=mt({},t.data.ctrlData.refObj),e.rect=mt({},t.data.ctrlData.rect),e.autoPress=t.data.ctrlData.autoPress,e.hit=mt({},t.data.ctrlData.hit));return mt({},e);default:return e}},jt=Object(Be.d)(Object(Be.c)({login:Ze,excelSheet:Qe,gridDatas:gt,ctrlData:wt}),Object(Be.a)(We.a));i.a.render(a.a.createElement(l.a,{store:jt},a.a.createElement(c.a,null,a.a.createElement(Ke,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[146,1,2]]]);
//# sourceMappingURL=main.5acab84a.chunk.js.map