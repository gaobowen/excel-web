{"version":3,"sources":["static/images/login/github.svg","static/images/login/main-bg.png","static/images/login/login-input-bg.png","components/login/ding-qrcode-login.jsx","redux/login/action-types.js","http.js","redux/login/actions.js","components/login/ddlogin.jsx","components/login/github-login.jsx","components/login/login-view.jsx","components/login/main-login.jsx","components/workplace/current-operate.jsx","redux/workplace/actions.js","redux/workplace/action-types.js","components/workplace/excel-sheet.jsx","components/workplace/user-header.jsx","components/workplace/tools-header.jsx","components/workplace/tools-footer.jsx","components/workplace/element-content/image-view.jsx","components/workplace/media-container.jsx","components/workplace/element-content/cell-input.jsx","components/workplace/controllers/cell-controller.jsx","components/workplace/controllers/media-controller.jsx","components/workplace/main-workplace.jsx","App.js","serviceWorker.js","redux/login/reducers.js","redux/workplace/reducers.js","redux/workplace/reducers-grid-datas.js","redux/workplace/reducers-operate.js","redux/store.js","index.js"],"names":["module","exports","DingQrcodeLogin","props","createSrc","options","goto","style","href","src","state","url","encodeURIComponent","iframeOption","id","this","frameBorder","allowtransparency","scrolling","width","height","className","React","Component","defaultProps","DINGDING_LOGIN","GITHUB_LOGIN","USER_LOGOUT","RECEIVE_USER_INFO","httpApi","Promise","resolve","cookie","remove","path","setTimeout","retobj","userInfo","errcode","username","avatarUrl","save","window","btoa","JSON","stringify","getGithub","a","axios","get","resp","undefined","data","login","avatar_url","message","error","receiveUserInfo","params","type","DDLogin","APPID","REDIRECT_URI","location","search","indexOf","keyvalues","replace","split","kv","index","length","pairs","toString","loginDingding","handleMessage","event","origin","addEventListener","attachEvent","console","log","opacity","connect","dispatch","postDinging","ret","GithubLogin","loginGithub","userName","handleChange","target","value","githubimg","size","placeholder","onChange","onPressEnter","onClick","LoginView","changeLoginMode","loginMode","history","setState","pathname","key","component","to","withRouter","MainLogin","loginCookie","load","jstr","atob","parse","bgimg","alt","loginviewbgimg","scrollData","offsetX","offsetY","headerData","offsetHeight","getOperatePositon","clientX","clientY","x","y","getStampId","Date","getTime","parseInt","Math","random","dragMove","isDrag","start","changed","dx","dy","completed","zIndexEventListener","callback","currentTbody","current","commitCellData","rowIdx","colIdx","rows","cells","childNodes","innerHTML","changedExcelSize","changeExcelSheetSelected","hitTestOperate","sortMediaElements","ExcelSheet","getCoordinates","positionStr","row","match","col","colstr","baseCode","charCodeAt","colno","charIdx","pow","getPositionStr","coordinates","getPositionStrX","inputX","Error","codeA","inX","numIdx","ascIdx","String","fromCharCode","grid","gridDatas","dic","selectedKey","totalWidth","totalHeight","excelSheet","borderspacing","cellSpacing","cellPadding","ref","map","i","cell","j","backgroundColor","textOverflow","UserHeader","download","e","stopPropagation","preventDefault","downloadExcel","handleMenuClick","logout","open","encodeURI","host","downMenu","Item","overlay","icon","ToolsHeader","iconbtn","TabPane","initData","refObj","eleType","hit","rect","r","preRect","ToolsFooter","activeKey","ctrlData","onEdit","targetKey","action","add","addExcelSheet","removeExcelSheet","componentDidMount","dickey","panes","push","title","name","content","pane","tab","changeExcelSheetName","useState","setId","setData","zIndex","setZidx","setTarget","reat","selEle","divEle","useRef","onChangeRect","left","top","onChangeRectRef","mystyle","position","img","Image","onload","wid","heig","originalSize","ratio","οndragstart","draggable","onMouseDown","document","getElementById","divRef","autoPress","onMouseUp","onLoad","autoSeleted","MediaContainer","elements","media","val","idx","commitUpdateGridDatas","inputRef","divStyle","display","outlineStyle","whiteSpace","inputStyle","borderWidth","pointerEvents","overflow","allStyle","allStyleData","setAllStyleData","oneGridDataObj","coord","getGridData","oneGridData","setoneGridData","Object","is","useEffect","setEditState","isEdit","dstyle","inStyle","readOnly","focus","blur","stopEvent","onDoubleClick","onBlur","onKeyDown","keyCode","CellController","border","right","bottom","ctrlMouseMove","removeEventListener","setstate","dragX","dragY","isScale","scaleX","scaleY","onkeydown","deleteEle","move","localDragMove","dw","dh","sw","sh","localScale","isDelete","autoFocus","tabIndex","user-select","webkit-user-select","contentEditable","onMouseMove","MainWorkplace","currentController","mediaElements","getController","getScrollData","scrollLeft","scrollTop","hitOperateLayerHandle","ignoreDrag","dropInHandle","file","dataTransfer","files","reader","FileReader","pos","addDragImage","exts","fileType","ext","result","readAsDataURL","toolHeaderBox","toolsHeaderOffsetHeight","onScroll","onContextMenu","onDragEnter","onDragOver","onDrop","App","Boolean","hostname","initState","initSize","defaultCellSize","createBlankGridData","isTest","initGrid","coor","wb","Excel","Workbook","ws","addWorksheet","properties","defaultRowHeight","rowcount","colcount","rowidx","colidx","getRow","rowdata","Array","fill","addRow","getCell","imageId","addImage","base64","extension","tl","br","editAs","xlsx","writeBuffer","then","buffer","FileSaver","saveAs","Blob","now","catch","err","getStamp","blankData","key1","initGridDatas","addstate","nameidx","asKey","addkey","rmdic","wouldSelect","hasRemove","changeState","selectedState","deleteIdx","findIndex","slice","concat","sort","b","hasChange","locateVertical","defaultHeight","heights","changedCount","changedOffset","checkoffset","ceil","locateHorizontal","defaultWidth","widths","idxH","idxV","createStore","combineReducers","applyMiddleware","thunk","ReactDOM","render","store","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.dc5db1c4.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/github.741c0ae1.svg\";","module.exports = __webpack_public_path__ + \"static/media/main-bg.197637b0.png\";","module.exports = __webpack_public_path__ + \"static/media/login-input-bg.cf01c34c.png\";","import React from 'react'\nimport PropTypes from 'prop-types'\n\n// https://ding-doc.dingtalk.com/doc#/serverapi3/mrugr3\nclass DingQrcodeLogin extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            url: \"https://login.dingtalk.com/login/qrcode.htm?goto=\"\n        }\n    }\n    createSrc = () => {\n        const { goto, style, href } = this.props.options\n        let src = this.state.url + encodeURIComponent(goto)\n        src += style ? \"&style=\" + style : \"\";\n        src += href ? \"&href=\" + href : \"\";\n        return src\n    }\n    render() {\n        const iframeOption = {\n            id: this.props.options.id,\n            src: this.createSrc(),\n            frameBorder: \"0\",\n            allowtransparency: \"true\",\n            scrolling: \"no\",\n            width: this.props.options.width,\n            height: this.props.options.height,\n            className: this.props.className\n        }\n        return (\n            <iframe {...iframeOption} />\n        )\n    }\n}\n\nDingQrcodeLogin.propTypes = {\n    options: PropTypes.shape({\n        id: PropTypes.string,\n        goto: PropTypes.string.isRequired,\n        style: PropTypes.string,\n        href: PropTypes.string,\n        width: PropTypes.string,\n        height: PropTypes.string,\n    }),\n    className: PropTypes.string\n}\n\nDingQrcodeLogin.defaultProps = {\n    options: {\n        id: \"login_container\",\n        goto: \"\",\n        style: \"\",\n        href: \"\",\n        width: \"350px\",\n        height: \"350px\",\n    },\n    className: ''\n}\n\nexport default DingQrcodeLogin","export const DINGDING_LOGIN = 'DINGDING_LOGIN';\nexport const GITHUB_LOGIN = 'GITHUB_LOGIN';\nexport const USER_LOGOUT = 'USER_LOGOUT';\nexport const RECEIVE_USER_INFO = 'RECEIVE_USER_INFO';\n\n\n","import axios from 'axios';\nimport cookie from 'react-cookies'\nimport { message } from 'antd';\n\nlet httpApi = {};\n\n//let dingurl = 'https://oapi.dingtalk.com/sns/getuserinfo_bycode?accessKey=dingoauctaoft7kia4pdvx';\n\nhttpApi.postDinging = () => {\n    //https://oapi.dingtalk.com/ 此api需要服务端完成，这里用timeout模拟\n    return new Promise((resolve) => {\n        cookie.remove('loginCookie', { path: '/' })\n        setTimeout(() => {\n            let retobj = {\n                    userInfo: {\n                        errcode: 0,\n                        username: 'DingUser',\n                        avatarUrl: 'https://gtms03.alicdn.com/tps/i3/TB1opXxHXXXXXahXpXXvBLt6FXX-230-230.png'\n                    }\n                }\n            cookie.save('loginCookie', window.btoa(JSON.stringify(retobj)), { path: '/' });\n            resolve(retobj);\n        }, 300)\n    })\n\n};\n\nhttpApi.getGithub = async(username) => {\n    let retobj = {\n        userInfo: {\n            errcode: 0\n        }\n    };\n    try {\n        let resp = await axios.get(`https://api.github.com/users/${username}`);\n        //debugger;\n        cookie.remove('loginCookie', { path: '/' })\n        if (resp.data.login !== undefined) {\n            retobj.userInfo.username = resp.data.login;\n            retobj.userInfo.avatarUrl = resp.data.avatar_url;\n            cookie.save('loginCookie', window.btoa(JSON.stringify(retobj)), { path: '/' });\n        } else {\n            message.error('User name not found.');\n            retobj.errcode = -1;\n        }\n    } catch (error) {\n        message.error('User name not found.');\n    }\n    return retobj;\n}\n\n\n\nexport default httpApi;","import { USER_LOGOUT, RECEIVE_USER_INFO } from './action-types';\nimport httpApi from '../../http' \n\nexport const loginDingding = (params) => {\n    return async dispatch => {\n        \n        let ret = await httpApi.postDinging(params);\n        console.log(ret);\n        dispatch(receiveUserInfo({...ret}));\n            \n\n    }\n}\n\nexport const loginGithub = (params) => {\n    return async dispatch => {\n        let ret = await httpApi.getGithub(params)\n        dispatch(receiveUserInfo({...ret}));\n    }\n}\n\nexport const logout = (params) => ({ type: USER_LOGOUT, data: params });\n\nexport const receiveUserInfo = (params) => ({ type: RECEIVE_USER_INFO, data: params })","import React from 'react'\nimport PropTypes from 'prop-types'\nimport DingQrcodeLogin from './ding-qrcode-login'\nimport { connect } from 'react-redux'\nimport { loginDingding } from '../../redux/login/actions'\n\n\n// https://ding-doc.dingtalk.com/doc#/serverapi3/mrugr3\nclass DDLogin extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            // 测试 appid\n            APPID: 'dingoauctaoft7kia4pdvx',  \n            // 跳转页面\n            REDIRECT_URI: 'https://gaobowen.github.io/excel-web/login/dingding' //https://gaobowen.github.io/excel-web\n        }\n    }\n    UNSAFE_componentWillMount () {\n        // 触发回调时处理回调链接,举例：如果查询字符串中含有state,且为dinglogin（可自行设置）,\n        // 则触发扫描登录的相应处理方法，比如登录。\n        if (this.props.location.search === undefined) {\n            return;\n        }\n        //const state = this.props.location && this.props.location.query.state;\n        if (this.props.location.search.indexOf('dinglogin') !== -1) {\n            let keyvalues = this.props.location.search.replace(\"?\", \"\").split(\"&\");\n            let kv = {};\n            for (let index = 0; index < keyvalues.length; index++) {\n                const pairs = keyvalues[index].split('=');\n                kv[pairs[0].toString()] = pairs[1];\n            }\n            //模拟获取用户数据\n            this.props.loginDingding({});\n            return;\n            //getuserinfo_bycode为服务端api 前端不支持\n            // let keyvalues = this.props.location.search.replace(\"?\", \"\").split(\"&\");\n            // let kv = {};\n            // for (let index = 0; index < keyvalues.length; index++) {\n            //     const pairs = keyvalues[index].split('=');\n            //     kv[pairs[0].toString()] = pairs[1];\n            // }\n            // console.log(kv);\n            // const code = kv.code;\n            // const timestamp = new Date().getTime().toString();\n            // let hash = CryptoJS.HmacSHA256(timestamp, \"1e2K9qeTnKJCEbQwBTiFWVZKDoEvlzgpcw2Psv3kmOguuezpbmRl2k37dMbHFaIC\");\n            // var hashInBase64 = CryptoJS.enc.Base64.stringify(hash);\n            // axios.post(`https://oapi.dingtalk.com/sns/getuserinfo_bycode?accessKey=dingoauctaoft7kia4pdvx&timestamp=${timestamp}&signature=${hashInBase64}`, {\n            //     tmp_auth_code: code,\n            // })\n            //     .then(function (response) {\n            //         console.log('resp')\n            //         console.log(response)\n            //     })\n            //     .catch(function (error) {\n            //         console.log('error')\n            //         console.log(error);\n            //     });\n            // ex: dispatch(scanLogin({tmp_auth_code: code}));\n        }\n    }\n    componentDidMount() {\n        // 监听消息处理方法\n        const handleMessage = (event) => {\n            // 获取loginTempCode\n            //const loginTempCode = event.data;\n            // 获取消息来源\n            const origin = event.origin;\n            // 拼接 url\n            //const url = `https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=${this.state.APPID}&response_type=code&scope=snsapi_login&state=dinglogin&redirect_uri=${this.state.REDIRECT_URI}&loginTmpCode=${loginTempCode}`\n            // 如果来源为https://login.dingtalk.com，则在当前窗口打开回调链接\n            if (origin === 'https://login.dingtalk.com') {\n                this.props.loginDingding({});\n                // github pages 为静态页面跳转后会丢失页面js信息。这里跳过此步骤\n                //window.open(encodeURI(url), '_parent')\n            }\n        };\n        // 监听iframe的消息\n        if (typeof window.addEventListener != 'undefined') {\n            window.addEventListener('message', handleMessage, false);\n        } else if (typeof window.attachEvent != 'undefined') {\n            window.attachEvent('onmessage', handleMessage);\n        }\n    }\n\n    //这是错误的写法，方法需要绑定，或者可以使用箭头函数自动绑定\n    loginDingding() {\n        console.log('loginDingding')\n    }\n\n    render() {\n        const options = {\n            id: \"login-container\",\n            goto: `https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=${this.state.APPID}&response_type=code&scope=snsapi_login&state=dinglogin&redirect_uri=${this.state.REDIRECT_URI}`,\n            width: '350px',\n            height: '350px',\n        }\n\n        return (\n            <div id=\"login-container\" style={{ opacity: 0.78 }}>\n                <DingQrcodeLogin options={options} />\n            </div>\n        )\n    }\n}\n\nDDLogin.propTypes = {\n    loginDingding: PropTypes.func.isRequired,\n    location : PropTypes.object.isRequired,\n}\n\nexport default connect(\n    state => ({ login : state.login }),\n    { loginDingding }\n)(DDLogin)\n","import React from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { loginGithub } from '../../redux/login/actions'\nimport { Input, Button, Avatar } from 'antd'\n\nimport githubimg from '../../static/images/login/github.svg';\nimport '../../static/css/github-login.css'\n\nclass GithubLogin extends React.Component {\n  constructor(props) {\n    super(props);\n    //props 不能扩展，只能外部传入\n  }\n\n  loginGithub = () => {\n    this.props.loginGithub(this.userName);\n  }\n\n  handleChange = (event) => {\n    this.userName = event.target.value;\n  }\n\n  render() {\n    return (\n      <div style={{ width: '100%', height: '100%' }}>\n        <Avatar src={githubimg} size={64} className='login-github-svg' />\n        <div className='login-username-text'>\n          Github User Name\n        </div>\n\n        <Input className='login-username-input' placeholder='User Name' onChange={this.handleChange}\n          onPressEnter={this.loginGithub} />\n\n        <Button type=\"primary\" className='login-github-btn' onClick={this.loginGithub}>Login</Button>\n      </div>)\n  }\n}\n\nGithubLogin.propTypes = {\n  loginGithub: PropTypes.func.isRequired,\n}\n\nexport default connect(\n  state => ({ login: state.login }),\n  { loginGithub }\n)(GithubLogin)\n","import React from 'react';\nimport PropTypes from 'prop-types'\nimport DDLogin from './ddlogin';\nimport GithubLogin from './github-login'\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom'\n\nimport '../../static/css/loginview.css'\n\n\nclass LoginView extends React.Component {\n  \n  // 设置props默认值防止报错\n  static defaultProps = {\n    options: {\n      loginMode: 'dingding'\n    }\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      options: { loginMode: 'dingding' }\n    }\n    if(props.location !== undefined)\n    {\n      if(props.location.pathname === '/excel-web/login/github')\n      {\n        props.options.loginMode = 'github';\n      }\n      else\n      {\n        props.options.loginMode = 'dingding';\n      }\n    }\n    this.state.options.loginMode = props.options.loginMode;\n\n    \n  }\n\n  changeLoginMode = (event) => {\n    let loginMode = event.target.id === 'tab-li-github' ? 'github' : 'dingding';\n    // 使用props.history前首先使用withRoute\n    this.props.history.replace('/excel-web/login/' + loginMode);\n    this.setState({ options: { loginMode } });\n  }\n\n\n  render() {\n    //刷新页面后，路由与state不匹配，导致页面显示错误\n    //解决方案：\n    //1、把路由相关参数在state中剥离\n    //2、state中相关的默认参数根据路由重新负责\n\n    return (\n      <div className='login-view'>\n        {/*这里ul没有把div撑开，需要确定height*/}\n        <div className='tab-div'>\n          <ul className='tabs'>\n            {/* 这里还可以优化，使用Link或NavLink */}\n            <li id='tab-li-dingding'\n              className={this.state.options.loginMode === 'dingding' ? 'tab-item current' : 'tab-item'}\n              onClick={this.changeLoginMode}>Dingding</li>\n            <li id='tab-li-github'\n              className={this.state.options.loginMode === 'dingding' ? 'tab-item' : 'tab-item current'}\n              onClick={this.changeLoginMode}>Github</li>\n          </ul>\n        </div>\n        \n        <div className='login-view-content' key={this.props.location.key}>\n          <Switch>\n            <Route path='/excel-web/login/dingding' component={DDLogin} />\n            <Route path='/excel-web/login/github' component={GithubLogin}/>\n            <Redirect to='/excel-web/login/dingding' />\n          </Switch>\n          {}\n        </div>\n      </div>\n    )\n  }\n}\n\n//PropTypes.shape 用于检测对象的不同属性的不同类型\nLoginView.propTypes = {\n  options:\n    PropTypes.shape({\n      loginMode: PropTypes.string.isRequired,\n    }),\n    location: PropTypes.object.isRequired,\n    history : PropTypes.object.isRequired,\n}\n\n\nexport default withRouter(LoginView);","import React from 'react';\nimport LoginView from './login-view'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\nimport { receiveUserInfo } from '../../redux/login/actions'\nimport cookie from 'react-cookies'\n\nimport bgimg from '../../static/images/login/main-bg.png';\nimport loginviewbgimg from '../../static/images/login/login-input-bg.png';\nimport '../../static/css/mainlogin.css'\n\nclass MainLogin extends React.Component {\n  constructor(props) {\n    super(props);\n\n    //在正式的web应用中，通常使用浏览器缓存的cookie值作为key，向redis等缓存服务端获取session信息，\n    //进而判断用户是否需要登录。这里刷新页面后会丢失dom中登录状态，尝试用cookie base 64 存储登录信息\n    let loginCookie = cookie.load('loginCookie');\n    if (loginCookie !== undefined) {\n      var jstr = window.atob(loginCookie)\n      let login = JSON.parse(jstr);\n      if (login.userInfo.username !== undefined) {\n        this.props.receiveUserInfo(login);\n      }\n    }\n  }\n\n\n  componentDidMount() {\n    if (this.props.userInfo.username !== undefined) {\n      this.props.history.replace('/excel-web/sheet', this.state);\n    }\n  }\n  componentDidUpdate() {\n    if (this.props.userInfo.username !== undefined) {\n      this.props.history.replace('/excel-web/sheet', this.state);\n    }\n  }\n\n  render() {\n\n    if (this.props.userInfo.username !== undefined) {\n      return (<div></div>)\n    }\n\n    return (\n      <div>\n        <div className='bgdiv'>\n          <img className='bgimg' src={bgimg} alt='loginbgimg' />\n        </div>\n        <div className='logincontainer'>\n          <div>\n            <div className='loginviewbg outradius'>\n              <img className='loginviewbgimg' src={loginviewbgimg} alt='' />\n            </div>\n            <LoginView />\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nMainLogin.propTypes = {\n  userInfo: PropTypes.object.isRequired,\n  receiveUserInfo: PropTypes.func.isRequired,\n  history :PropTypes.object.isRequired,\n}\n\n//react diff 通过setState来更新ui，这里绑定的数据集合越小，ui更新的次数越少\n//这里的state.login\nexport default connect(\n  state => ({ userInfo: state.login.userInfo }),\n  { receiveUserInfo }\n)(MainLogin)\n","\nexport const scrollData = { offsetX: 0, offsetY: 0 }\n\nexport const headerData = { offsetHeight: 0 }\n\nexport const getOperatePositon = (clientX, clientY) => {\n    return {\n        x: clientX + scrollData.offsetX,\n        y: clientY - headerData.offsetHeight + scrollData.offsetY,\n    }\n}\n\nexport const getStampId = () => (new Date().getTime().toString() + parseInt(Math.random() * 100))\n\nexport const dragMove = {\n    x: 0,\n    y: 0,\n    isDrag: false,\n\n    start: function (clientX, clientY) {\n        this.isDrag = true;\n        this.x = clientX;\n        this.y = clientY;\n    },\n\n    changed: function (clientX, clientY) {\n        if (!this.isDrag) {\n            this.x = 0;\n            this.y = 0;\n            return {\n                dx: 0,\n                dy: 0\n            }\n        }\n        let dx = clientX - this.x;\n        let dy = clientY - this.y;\n        this.x = clientX;\n        this.y = clientY;\n        //console.log('dragMovechanged')\n        return { dx, dy }\n    },\n\n    completed: function () {\n        this.x = 0;\n        this.y = 0;\n        this.isDrag = false;\n    }\n}\n\n\nexport const zIndexEventListener = {\n    callback: () => { }\n}\n\nexport const blankCellData = { value: '' }\n\nexport const currentTbody = { current : undefined };\n\n\nexport const commitCellData = (rowIdx, colIdx, data) => {\n    //采用原生赋值方式，react承载cell会产生大量fiber节点，操作反而会变慢。\n    //经过测试采用索引速度最快 tbody.rows[x].cells[y] \n    //@2019-10-27 即将弃用此方法，转向canvas\n    if (currentTbody.current.rows){\n        currentTbody.current.rows[rowIdx].cells[colIdx].childNodes[0].innerHTML = data.value;\n        //next todo 修改样式\n    }\n}\n\n// eslint-disable-next-line no-unused-vars\nexport const commitCellsRange = (start, end, dataRange)=>{\n\n\n}\n\n\n\n// eslint-disable-next-line no-unused-vars\nexport const changeRowHeight = (rowIdx, h)=>{\n\n\n}\n\n\n//export const copyRect()\n","import {\n    CHANGED_EXCEL_SIZE,\n    ADD_EXCEL_SHEET,\n    REMOVE_EXCEL_SHEET,\n    CHANGE_EXCEL_SHEET_NAME,\n    CHANGE_EXCEL_SHEET_SELECTED,\n    DOWNLOAD_EXCEL,\n    HIT_TEST_OPERATE,\n    GET_SELECTED_GRID,\n    ADD_DRAG_IMAGE,\n    SORT_MEDIA_ELEMENTS,\n    COMMIT_UPDATE_GRIDDATAS\n} from './action-types';\n\n\nexport const changedExcelSize = (params) => ({ type: CHANGED_EXCEL_SIZE, data: params });\n\nexport const addExcelSheet = (params) => ({ type: ADD_EXCEL_SHEET, data: params });\n\nexport const getSelectedGrid = (params) => ({ type: GET_SELECTED_GRID, data: params });\n\nexport const removeExcelSheet = (params) => ({ type: REMOVE_EXCEL_SHEET, data: params });\n\nexport const changeExcelSheetName = (params) => ({ type: CHANGE_EXCEL_SHEET_NAME, data: params });\n\nexport const changeExcelSheetSelected = (params) => ({ type: CHANGE_EXCEL_SHEET_SELECTED, data: params });\n\nexport const downloadExcel = (params) => ({ type: DOWNLOAD_EXCEL, data: params });\n\nexport const hitTestOperate = (params) => ({ type: HIT_TEST_OPERATE, data: params });\n\nexport const addDragImage = (params) => ({ type: ADD_DRAG_IMAGE, data: params });\n\nexport const sortMediaElements = (params) => ({ type: SORT_MEDIA_ELEMENTS, data: params });\n\nexport const commitUpdateGridDatas = (params) => ({ type: COMMIT_UPDATE_GRIDDATAS, data: params });","export const CHANGED_EXCEL_SIZE = 'CHANGED_EXCEL_SIZE';\n\nexport const ADD_EXCEL_SHEET = 'ADD_EXCEL_SHEET';\n\nexport const REMOVE_EXCEL_SHEET = 'REMOVE_EXCEL_SHEET';\n\nexport const CHANGE_EXCEL_SHEET_NAME = 'CHANGE_EXCEL_SHEET_NAME';\n\nexport const CHANGE_EXCEL_SHEET_SELECTED = 'CHANGE_EXCEL_SHEET_SELECTED';\n\nexport const DOWNLOAD_EXCEL = 'DOWNLOAD_EXCEL';\n\nexport const HIT_TEST_OPERATE = 'HIT_TEST_OPERATE';\n\nexport const GET_SELECTED_GRID = 'GET_SELECTED_GRID';\n\nexport const ADD_DRAG_IMAGE = 'ADD_DRAG_IMAGE';\n\nexport const SORT_MEDIA_ELEMENTS = 'SORT_MEDIA_ELEMENTS';\n\nexport const COMMIT_UPDATE_GRIDDATAS = 'COMMIT_UPDATE_GRIDDATAS';\n\n\n\n\n\n","import React from 'react';\nimport PropTypes from 'prop-types'\n//import Datasheet from 'react-datasheet';\nimport { connect } from 'react-redux'\nimport { currentTbody } from './current-operate'\nimport { changedExcelSize, changeExcelSheetSelected } from '../../redux/workplace/actions'\n\nimport '../../static/css/excel-sheet.css'\nimport '../../static/css/static-table.css'\n\n\n//此开源控件在每个cell上都单独处理了事件，当初始化数组达到几百上千行时，操作会延迟卡顿，\n//作为excel这种数据量比较大的控件来说，这样的设计思路是不可行的\n//excel正确的设计方式 因该是数据展示层在下面（建议用canvas），上面覆盖统一操作层作为交互层\nclass ExcelSheet extends React.Component {\n    constructor(props) {\n        super(props)\n    }\n\n    //坐标换算\n    //列A-ZZ 行1-n\n    //双字母把A看作1  列在前行在后例如 AA3\n    //返回的坐标index从0开始\n    getCoordinates = (positionStr) => {\n        const row = positionStr.match(/[0-9]+/g) || [];\n        const col = positionStr.match(/[A-Z]+/g) || [];\n\n        if (row.length === 1 && col.length === 1) {\n            let colstr = col[0].toString();\n            let baseCode = 'A'.charCodeAt();\n            let colno = 0;\n            for (let index = 0; index < colstr.length; index++) {\n                const charIdx = colstr[index].charCodeAt() - baseCode + 1;\n                let temp = (Math.pow(26, colstr.length - index - 1) * charIdx)\n                colno += temp;\n            }\n            // x列号 y行号\n            return { x: colno - 1, y: parseInt(row[0]) - 1 }\n        }\n    }\n\n    //坐标转字符串index 从0开始\n    getPositionStr = (coordinates) => {\n        let x = parseInt(coordinates.x);\n        return this.getPositionStrX(x) + (coordinates.y + 1);\n    }\n\n    getPositionStrX = (inputX) => {\n        if (inputX < 0) {\n            throw Error('Error getPositionStrX inputX < 0')\n        }\n        let codeA = 'A'.charCodeAt(0);\n        let inX = inputX + 1;\n        let x = ''\n        do {\n            let numIdx = inX - 1;\n            let ascIdx = numIdx % 26;\n            x = String.fromCharCode(codeA + ascIdx) + x;\n            inX = parseInt(numIdx / 26);\n        }\n        while (inX > 0)\n        return x;\n    }\n\n    render() {\n        this.grid = this.props.gridDatas.dic[this.props.gridDatas.selectedKey].grid;\n        this.totalWidth = this.grid[0].length * 60;\n        this.totalHeight = this.grid.length * 22;\n        if (this.totalWidth !== this.props.excelSheet.width\n            || this.totalHeight !== this.props.excelSheet.height) {\n            this.props.changedExcelSize({\n                width: this.totalWidth,\n                height: this.totalHeight,\n            })\n        }\n\n        return (\n            <div style={{ width: this.totalWidth }}>\n                {/* 第三方控件效率太差，100多行就开始卡顿，暂时采用table测试性能，不行就用canvas */}\n                {/* 经过测试 在5000行 30列， 15万数据时，使用 table 开始有明显的操作延迟 */}\n                <table className='static-table' borderspacing={0} cellSpacing={0} cellPadding={0} >\n                    <tbody id='excel-sheet-main-tbody' ref={x => { currentTbody.current = x }} >{\n                        this.grid.map((row, i) => {\n                            return (\n                                <tr key={`-${i}-`} className='row' style={{}}>{\n                                    row.map((cell, j) => {\n                                        return (\n                                            <td key={`-${i}-|${j}|`} className='cell' style={\n                                                (()=>{if(i===0 || j === 0){\n                                                    return {backgroundColor:'#ddd'}\n                                                }})()\n                                            }>\n                                                {/*border会影响布局*/}\n                                                <div\n                                                    style={{ \n                                                        width: '58px', \n                                                        height: '20px', \n                                                        textOverflow: 'ellipsis' \n                                                        }}>\n                                                    {cell.value}\n                                                </div>\n                                            </td>)\n                                    })}\n                                </tr>)\n                        })\n                    }\n                    </tbody>\n                </table>\n                {/*todo canvas 手动绘制表格 ... */}\n\n                {/* <Datasheet\n                    data={this.grid}\n                    valueRenderer={(cell) => cell.value}\n                    // eslint-disable-next-line no-unused-vars\n                    onContextMenu={(e, cell, i, j) => cell.readOnly ? e.preventDefault() : null}\n                    onCellsChanged={changes => {\n                        const grid = this.grid.map(row => [...row])\n                        changes.forEach(({ row, col, value }) => {\n                            this.grid[row][col] = { ...grid[row][col], value }\n                        })\n                        this.render()\n                    }}\n                /> */}\n            </div>\n        )\n    }\n}\n\nExcelSheet.propTypes = {\n    gridDatas: PropTypes.object.isRequired,\n    excelSheet: PropTypes.object.isRequired,\n    changedExcelSize: PropTypes.func.isRequired,\n    changeExcelSheetSelected: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => { return ({ gridDatas: state.gridDatas, excelSheet: state.excelSheet }) },\n    { changedExcelSize, changeExcelSheetSelected }\n)(ExcelSheet);","import React from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { logout } from '../../redux/login/actions'\nimport { downloadExcel } from '../../redux/workplace/actions'\nimport { Dropdown, Menu, Avatar, Button } from 'antd'\n\nimport '../../static/css/user-header.css'\n\nclass UserHeader extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {};\n        this.handleMenuClick = e => {\n            if (e.key === '2') {\n                this.props.logout({});\n                window.open(encodeURI('http://' + window.location.host + '/excel-web'), '_parent');\n            }\n        };\n\n        this.state.downMenu = (\n            <Menu onClick={this.handleMenuClick}>\n                <Menu.Item className='menu-item' key='1' >\n                    {this.props.login.userInfo.username}\n                </Menu.Item>\n                <Menu.Item className='menu-item' key='2' >\n                    Logout\n                </Menu.Item>\n            </Menu>\n        );\n    }\n\n    download = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n        this.props.downloadExcel();\n    }\n\n    render() {\n\n        return (\n            <div className='user-header'>\n                <div className='header-title'>Technology Changes Lives</div>\n                <div className='items'>\n                    <Dropdown overlay={this.state.downMenu} className='item avatar'>\n                        <Avatar size={40} src={this.props.login.userInfo.avatarUrl} className='item avatar'></Avatar>\n                    </Dropdown>\n                    <div className='item split' ></div>\n                    <Button type=\"primary\" icon=\"download\" className='item btn' onClick={this.download}>Download</Button>\n                </div>\n\n            </div>\n        );\n    }\n}\n\nUserHeader.propTypes ={\n    login : PropTypes.object.isRequired,\n    logout : PropTypes.func.isRequired,\n    downloadExcel : PropTypes.func.isRequired,\n}\n\n\nexport default connect(\n    state => state,\n    { logout, downloadExcel }//这里要用大括号，容易遗漏\n)(UserHeader);","import React from 'react';\nimport { connect } from 'react-redux'\nimport { Icon } from 'antd'\n\nimport '../../static/css/tools-header.css'\n\nclass ToolsHeader extends React.Component {\n\n    iconbtn = (type,index) => {\n        return (<div className='item' key={index}><Icon type={type} /></div>)\n    }\n\n    render() {\n        let editTypes = ['edit', 'copy', 'delete', 'align-center', 'align-left', 'align-right',\n            'bg-colors', 'bold', 'italic', 'underline', 'font-colors', 'font-size'];\n        let charts = ['area-chart', 'pie-chart', 'bar-chart', 'dot-chart', 'line-chart','radar-chart','fund'];\n        let editExts = ['line-height','column-width','column-height','sort-ascending','sort-descending'];\n        return (<div className='tools-header'>\n            <div className='item split'></div>\n            {editTypes.map((x, i) => (this.iconbtn(x,i)))}\n            <div className='item split'></div>\n            {charts.map((x, i)=> (<div className='item' key={'chart'+i}><Icon type={x} /></div>))}\n            <div className='item split'></div>\n            {editExts.map((x, i)=> (<div className='item' key={'editExts'+i}><Icon type={x} /></div>))}\n        </div>)\n    }\n}\n\nexport default connect(\n    state => state,\n    {}\n)(ToolsHeader)\n\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport {\n  addExcelSheet,\n  removeExcelSheet,\n  changeExcelSheetName,\n  changeExcelSheetSelected,\n  hitTestOperate\n} from '../../redux/workplace/actions'\n\n\nimport { Tabs } from 'antd';\n\nimport '../../static/css/tools-footer.css'\n\nconst { TabPane } = Tabs;\n\nconst initData = {\n  refObj: null,\n  eleType: 'cell',\n  hit: { x: 60, y: 22 },\n  rect: {\n    x: 60,\n    y: 22,\n    r: 0,\n    width: 60,\n    height: 22\n  },\n  preRect: {\n    x: 60,\n    y: 22,\n    r: 0,\n    width: 60,\n    height: 22\n  }\n}\n\nclass ToolsFooter extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  onChange = activeKey => {\n    this.props.changeExcelSheetSelected({ key: activeKey });\n    this.props.hitTestOperate({\n      ctrlData: initData,\n    })\n  };\n\n  onEdit = (targetKey, action) => {\n    //action 包含下面的 add 和 remove\n    this[action](targetKey);\n    this.props.hitTestOperate({\n      ctrlData: initData,\n    })\n  };\n\n  add = () => {\n    this.props.addExcelSheet();\n  };\n\n  remove = targetKey => {\n    this.props.removeExcelSheet({\n      key: targetKey\n    })\n  };\n\n  componentDidMount = () => {\n\n  }\n\n  render() {\n    this.panes = [];\n    for (let dickey in this.props.gridDatas.dic) {\n      this.panes.push({\n        title: this.props.gridDatas.dic[dickey].name,\n        content: '',\n        key: dickey\n      })\n    }\n    return (\n      <div className='tools-footer'>\n        <Tabs\n          onChange={this.onChange}\n          activeKey={this.props.gridDatas.selectedKey}\n          type=\"editable-card\"\n          onEdit={this.onEdit}\n        >\n          {this.panes.map(pane => (\n            <TabPane tab={pane.title} key={pane.key}>\n              {pane.content}\n            </TabPane>\n          ))}\n        </Tabs>\n      </div>\n    );\n  }\n}\n\nToolsFooter.propTypes = {\n  gridDatas: PropTypes.object.isRequired,\n  addExcelSheet: PropTypes.func.isRequired,\n  removeExcelSheet: PropTypes.func.isRequired,\n  changeExcelSheetName: PropTypes.func.isRequired,\n  changeExcelSheetSelected: PropTypes.func.isRequired,\n  hitTestOperate: PropTypes.func.isRequired,\n}\n\nexport default connect(\n  state => ({ gridDatas: state.gridDatas }),\n  {\n    addExcelSheet,\n    removeExcelSheet,\n    changeExcelSheetName,\n    changeExcelSheetSelected,\n    hitTestOperate\n  }\n)(ToolsFooter)\n\n\n\n","import React, { useState, useRef } from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { sortMediaElements, hitTestOperate } from '../../../redux/workplace/actions'\nimport { zIndexEventListener, getOperatePositon } from '../current-operate'\n/*\ndata:{\n    fileType: 'img',\n    src: e.target.result,\n    location: pos,\n    zIndex: 9990,\n    autoSeleted: true\n}\n*/\n\nfunction ImageView(props) {\n    //console.log(props)//方法已挂载\n    const [id, setId] = useState(props.data.id);\n    const [data, setData] = useState(props.data);\n    const [zidx, setZidx] = useState(props.data.zIndex);\n    const [target, setTarget] = useState(null);\n    const [rect, setRect] = useState(props.data.reat);\n    const [selEle, setSelEle] = useState(null);\n    const divEle = useRef(null);\n\n\n    const onChangeRect = (target, rect) => {\n        //已过期的元素，不起效果\n        //setRect({...rect})\n        //这里的props.data.id 不一定= divEle.current.id\n        //divEle.current可能为上一个元素，此字段只在重新渲染时才更新\n        if (!selEle) {\n            return;\n        }\n\n        selEle.style.left = `${rect.x}px`;\n        selEle.style.top = `${rect.y}px`;\n        selEle.style.width = `${rect.width}px`;\n        selEle.style.height = `${rect.height}px`;\n\n    }\n\n    const onChangeRectRef = useRef(onChangeRect);\n\n    const mystyle = {\n        backgroundColor: '#00000088',\n        position: 'absolute',\n        left: `${props.data.location.x}px`,\n        top: `${props.data.location.y}px`,\n        zIndex: props.data.zIndex,\n    }\n\n    if (!props.data.rect) {\n        let img = new Image();\n        img.src = props.data.src;\n        img.onload = () => {\n            let wid = img.width;\n            let heig = img.height;\n            props.data.originalSize = {\n                width: wid,\n                height: heig\n            }\n            //等比缩小\n            if (wid > 500) {\n                let ratio = heig / wid;\n                wid = 500;\n                heig = ratio * 500;\n            }\n            if (heig > 500) {\n                let ratio = wid / heig;\n                heig = 500;\n                wid = ratio * 500;\n            }\n            props.data.rect = { x: 0, y: 0 }\n            props.data.rect.x = props.data.location.x - wid / 2;\n            props.data.rect.y = props.data.location.y - heig / 2;\n            props.data.rect.width = wid;\n            props.data.rect.height = heig;\n            props.data.location.x = props.data.rect.x;\n            props.data.location.y = props.data.rect.y;\n\n            setData({ ...props.data })\n        }\n\n    }\n\n    if (props.data && props.data.rect) {\n        mystyle.left = `${props.data.rect.x}px`\n        mystyle.top = `${props.data.rect.y}px`\n        mystyle.width = `${props.data.rect.width}px`;\n        mystyle.height = `${props.data.rect.height}px`;\n    }\n\n\n    // eslint-disable-next-line no-unused-vars\n    function setOriginalSize() {\n        props.data.rect.width = props.data.originalSize.width;\n        props.data.rect.height = props.data.originalSize.height;\n        setData({ ...props.data })\n    }\n\n    //console.log('ImageView render', props)\n    return (\n        <div\n            id={props.data.id}\n            style={{ ...mystyle }}\n            ref={divEle}\n            οndragstart=\"return false;\"\n            draggable=\"false\"\n            onClick={e => {\n                e.stopPropagation();\n                e.preventDefault();\n            }}\n            onMouseDown={event => {\n                event.stopPropagation();\n                event.preventDefault();\n                props.data.zIndex = 9990;\n                setZidx(9990);\n                props.sortMediaElements();\n                zIndexEventListener.callback();\n                setTarget(event.target)\n                let sel = document.getElementById(props.data.id)\n                sel.style.zIndex = 9990;\n                setId(props.data.id)\n                props.hitTestOperate({\n                    ctrlData: {\n                        refObj: {\n                            id: props.data.id,\n                            current: divEle.current,\n                            divRef: divEle,\n                            onChangeRect,\n                            data: props.data,\n                            onChangeRectRef,\n                        },\n                        eleType: 'media',\n                        hit: getOperatePositon(event.clientX, event.clientY),\n                        rect: {\n                            r: 0,\n                            ...props.data.rect\n                        },\n                        autoPress: true,\n                    }\n                });\n\n            }}\n            onMouseUp={event => {\n                setData(props.data)\n                event.stopPropagation();\n                event.preventDefault();\n            }}\n            onLoad={() => {\n                if (props.data.autoSeleted) {\n                    props.data.autoSeleted = false;\n                    props.hitTestOperate({\n                        ctrlData: {\n                            refObj: {\n                                current: divEle.current,\n                                onChangeRect,\n                                data: props.data\n                            },\n                            eleType: 'media',\n                            hit: {\n                                x: props.data.rect.x,\n                                y: props.data.rect.y\n                            },\n                            rect: {\n                                r: 0,\n                                ...props.data.rect\n                            }\n                        }\n                    })\n                }\n            }}\n        >\n            <img src={props.data.src}\n                width='100%'\n                height='100%'\n                οndragstart=\"return false;\"\n                draggable=\"false\"\n            />\n        </div>\n    );\n}\n\nImageView.propTypes = {\n    data: PropTypes.object.isRequired,\n    ctrlData: PropTypes.object.isRequired,\n    sortMediaElements: PropTypes.func.isRequired,\n    hitTestOperate: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => {\n        return {\n            ctrlData: state.ctrlData,\n        }\n    },\n    { sortMediaElements, hitTestOperate }\n)(ImageView);\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport ImageView from './element-content/image-view'\n//import {zIndexEventListener} from './current-operate'\n\n\nclass MediaContainer extends React.Component {\n\n    //优化点：shouldComponentUpdate 比较集合或者选中的sheet是否发生变化。浅比较即可。\n\n    \n\n    render() {\n        //console.log('MediaContainer',this.props)\n        let elements = this.props.media.map((val, idx) => {\n            return (\n                <ImageView data={val} key={idx}  />\n            )\n        })\n\n        return (\n            <>\n                {elements}\n            </>\n        )\n    }\n}\n\nMediaContainer.propTypes = {\n    media: PropTypes.array,\n}\n\nexport default connect(\n    state => {\n        let key = state.gridDatas['selectedKey'];\n        let media = [];\n        if (key) {\n            media = state.gridDatas.dic[key].media;\n        }\n        return { media }\n    },\n    {}\n)(MediaContainer);\n\n","import React, { useState, useRef, useEffect } from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { commitUpdateGridDatas } from '../../../redux/workplace/actions'\nimport { commitCellData } from '../current-operate'\n\n\nfunction CellInput(props) {\n    const [data, setData] = useState(props);\n\n    let divEle = useRef();\n    let inputRef = useRef();\n    //console.log('function CellInput(props) {',props)\n    let display = props.ctrlData.eleType === 'cell' ? 'block' : 'none';\n    const divStyle = {\n        position: '',\n        display: display,\n        outlineStyle: 'none',\n        width: `${props.ctrlData.rect.width}px`,\n        height: `${props.ctrlData.rect.height}px`,\n        opacity: '0',\n        whiteSpace: 'nowrap',\n    }\n\n    const inputStyle = {\n        left: '0px',\n        top: '0px',\n        //backgroundColor: '#555',\n        borderWidth: '0px',\n        outlineStyle: 'none',\n        pointerEvents: 'none',\n        width: `${props.ctrlData.rect.width - 1}px`,\n        height: `${props.ctrlData.rect.height - 1}px`,\n        position: 'absolute',\n        overflow: 'hidden',\n        \n    }\n\n    const allStyle = {\n        divStyle,\n        inputStyle\n    }\n\n    const [allStyleData, setAllStyleData] = useState(allStyle);\n    const getGridData = () => {\n        let key = props.gridDatas['selectedKey'];\n        if (key) {\n            let grid = props.gridDatas.dic[key].grid;\n            return grid[props.ctrlData.coord.rowIdx][props.ctrlData.coord.colIdx];\n        }\n    }\n    let oneGridDataObj = getGridData();\n    const [oneGridData, setoneGridData] = useState(oneGridDataObj);\n    if (!Object.is(oneGridDataObj, oneGridData)) {\n        commitCellData(\n            data.ctrlData.coord.rowIdx,\n            data.ctrlData.coord.colIdx,\n            oneGridData,\n        )\n        setoneGridData(oneGridDataObj);\n    }\n\n    if (!Object.is(data, props)) {\n        setData(props);\n        setAllStyleData(allStyle);\n    }\n    //const [allStyleData, setAllStyleData] = useState(allStyle);\n\n    useEffect(() => {\n        if (inputRef.current) {\n            inputRef.current.value = oneGridDataObj.value;\n        }\n    });\n\n    let setEditState = (isEdit) => {\n        if (isEdit) {\n            let dstyle = { ...divStyle };\n            dstyle.opacity = '1';\n            let inStyle = { ...inputStyle };\n            inStyle.pointerEvents = 'auto';\n            setAllStyleData({\n                divStyle: dstyle,\n                inputStyle: inStyle\n            });\n            inputRef.current.readOnly='';\n            inputRef.current.focus();\n        } else {\n            inputRef.current.blur();\n            let dstyle = { ...divStyle };\n            dstyle.opacity = '0';\n            let inStyle = { ...inputStyle };\n            inStyle.pointerEvents = 'none';\n            inputRef.current.readOnly='readonly';\n            setAllStyleData({\n                divStyle: dstyle,\n                inputStyle: inStyle\n            });\n        }\n    }\n\n    let stopEvent = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n    }\n\n    //autoFocus\n    return (\n        <div ref={divEle} style={allStyleData.divStyle}\n            onDoubleClick={() => {\n                setEditState(true);\n            }}\n            onClick={stopEvent}\n            onMouseDown={stopEvent}\n        >\n            {/* {console.log('inputValue.value render = ', inputValue.value)} */}\n            {/* {inputValue.value} */}\n            {/*ie9 onpropertychange； html5 oninput*/}\n            <input\n                type={'text'} \n                readOnly=\"readonly\"\n                style={{ ...allStyleData.inputStyle }}\n                ref={inputRef}\n                onChange={e => {\n                    //onInput切换controller时会少一个字符\n                    oneGridData.value = e.target.value;\n                    commitCellData(\n                        data.ctrlData.coord.rowIdx,\n                        data.ctrlData.coord.colIdx,\n                        oneGridData,\n                    )\n                }}\n                onBlur={() => {\n                    //console.log('onBlur data.ctrlData.coord.rowIdx', data.ctrlData.coord.rowIdx)\n                    commitCellData(\n                        data.ctrlData.coord.rowIdx,\n                        data.ctrlData.coord.colIdx,\n                        oneGridData,\n                    )\n                }}\n                onKeyDown={e => {\n                    if (e.keyCode == \"13\") {\n                        setEditState(false);\n                    }\n                }}\n                width='100%' height='100%'>\n            </input>\n        </div>\n    );\n}\n\nCellInput.propTypes = {\n    ctrlData: PropTypes.object.isRequired,\n    gridDatas: PropTypes.object.isRequired,\n    commitUpdateGridDatas: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => {\n        return {\n            gridDatas: state.gridDatas,\n        }\n    },\n    { commitUpdateGridDatas }\n)(CellInput);","import React from 'react';\nimport PropTypes from 'prop-types'\nimport { dragMove } from '../current-operate'\nimport CellInput from '../element-content/cell-input'\n\n\nfunction CellController(props) {\n    dragMove.completed();\n\n    let display = props.ctrlData.eleType === 'cell' ? 'block' : 'none';\n    const mystyle = {\n        display: display,\n        backgroundColor: '#ffffff00',\n        position: 'absolute',\n        left: `${props.ctrlData.rect.x - 1.9}px`,\n        top: `${props.ctrlData.rect.y - 1.5}px`,\n        width: `${props.ctrlData.rect.width + 3}px`,\n        height: `${props.ctrlData.rect.height + 3.5}px`,\n        overflow: 'visible',\n    }\n\n    // eslint-disable-next-line no-unused-vars\n    function getDisplayRect(props) {\n        return {\n            left: `${props.ctrlData.rect.x - 1.9}px`,\n            top: `${props.ctrlData.rect.y - 1.5}px`,\n            width: `${props.ctrlData.rect.width + 3}px`,\n            height: `${props.ctrlData.rect.height + 3.5}px`,\n        }\n    }\n\n\n\n    return (\n        //contentEditable=\"true\"\n        //pointer-events: none; 忽略所有鼠标事件autoFocus\n        <div  style={{\n            ...mystyle,\n            border: '2.2px solid #1890ff',\n            zIndex: 99999,\n        }}\n            onClick={event => {\n                event.stopPropagation();\n            }}>\n                <CellInput ctrlData={{...props.ctrlData}} />\n            <div style={{\n                position: 'absolute',\n                right: '-3.7px',\n                bottom: '-3.8px',\n                width: '6px',\n                height: '6px',\n                border: '1px solid #ffffff',\n                backgroundColor: '#1890ff',\n                overflow: 'visible',\n            }}>\n                \n            </div>\n        </div>\n\n    );\n}\n\nCellController.propTypes = {\n    ctrlData: PropTypes.object.isRequired,\n\n}\n\nexport default CellController;\n\n","import React, { useRef, useState } from 'react';\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { dragMove } from '../current-operate'\nimport { getOperatePositon } from '../current-operate'\nimport { hitTestOperate, sortMediaElements } from '../../../redux/workplace/actions'\n\nimport '../../../static/css/media-controller.css'\n\n/*\nctrlData:{\n    refObj: null,\n    eleType: 'cell',\n    hit: { x: 60, y: 22 },\n    rect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        width,\n        height,\n    },\n    preRect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        width,\n        height,\n    }\n}\n*/\nvar ctrlMouseMove = function () {}\n\nfunction MediaController(props) {\n    dragMove.completed();\n    //重复注册会导致多倍位移\n    window.removeEventListener('mousemove', ctrlMouseMove, true);\n    //指向当前已渲染完成的，正在初始化的不算。\n    const divEle = useRef(null);\n    const [state, setstate] = useState(props.ctrlData)\n    //const [ctrlMouseMoveState, setCtrlMouseMoveState] = useState(null);\n    if (!Object.is(state, props.ctrlData)) {\n        window.removeEventListener('mousemove', ctrlMouseMove, true);\n        setstate(props.ctrlData);\n    }\n\n    let selEle = document.getElementById(props.ctrlData.refObj.data.id);\n    props.ctrlData.refObj.data.zIndex = 9991;\n    selEle.style.zIndex = 9991;\n\n    let display = props.ctrlData.eleType === 'media' ? 'block' : 'none';\n    if (props.ctrlData.eleType !== 'media') {\n        return;\n    }\n    const mystyle = {\n        display: display,\n        backgroundColor: '#ffffff00',\n        position: 'absolute',\n        overflow: 'visible',\n    }\n    let x = props.ctrlData.rect.x;\n    let y = props.ctrlData.rect.y;\n    let width = props.ctrlData.rect.width;\n    let height = props.ctrlData.rect.height;\n\n    if (display === 'block') {\n        mystyle.left = `${x - 1.9}px`;\n        mystyle.top = `${y - 1.5}px`;\n        mystyle.width = `${width + 3}px`;\n        mystyle.height = `${height + 3.5}px`;\n    }\n\n    //多用于耗时计算的缓存，也可以省去不必要操作\n    // const memoVal = useMemo(() => {\n    // }, [x, y, width, height]);\n\n    const onChangeRect = (rect) => {\n        if (!divEle.current) {\n            return;\n        }\n        divEle.current.style.left = `${rect.x - 1.9}px`;\n        divEle.current.style.top = `${rect.y - 1.5}px`;\n        divEle.current.style.width = `${rect.width + 3}px`;\n        divEle.current.style.height = `${rect.height + 3.5}px`;\n    }\n\n\n\n    // eslint-disable-next-line no-unused-vars\n    const changeContent = (target, rect) => {\n        target.style.left = `${rect.x}px`;\n        target.style.top = `${rect.y}px`;\n        target.style.width = `${rect.width}px`;\n        target.style.height = `${rect.height}px`;\n    }\n\n    // eslint-disable-next-line no-unused-vars\n    function getDisplayRect(rect) {\n        return {\n            left: `${rect.x - 1.9}px`,\n            top: `${rect.y - 1.5}px`,\n            width: `${rect.width + 3}px`,\n            height: `${rect.height + 3.5}px`,\n        }\n    }\n\n    const stopEvent = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n    }\n\n    let isDrag = false;\n    let dragX = 0;\n    let dragY = 0;\n\n    const localDragMove = (e) => {\n        if (!isDrag || !props.ctrlData.refObj || !selEle) {\n            return;\n        }\n        let move = getOperatePositon(e.clientX, e.clientY);\n        let dx = move.x - dragX;\n        let dy = move.y - dragY;\n        //console.log(\"move.x - dragX\", move.x - dragX)\n        dragX = move.x;\n        dragY = move.y;\n        if (dx === 0 && dy === 0) {\n            return;\n        }\n        let rect = { ...props.ctrlData.rect }\n        rect.x += dx;\n        rect.y += dy;\n\n        onChangeRect(rect);\n        props.ctrlData.rect = { ...rect };\n        props.ctrlData.refObj.data.rect = { ...rect }\n        selEle.style.left = `${rect.x}px`;\n        selEle.style.top = `${rect.y}px`;\n        selEle.style.width = `${rect.width}px`;\n        selEle.style.height = `${rect.height}px`;\n    }\n\n    let isScale = false;\n    let scaleX = 0;\n    let scaleY = 0;\n    const localScale = (e) => {\n        if (!isScale || !props.ctrlData.refObj || !selEle) {\n            return;\n        }\n        let rect = { ...props.ctrlData.rect }\n        let move = getOperatePositon(e.clientX, e.clientY)\n        let dw = (move.x - scaleX);\n        let dh = (move.y - scaleY);\n        if (rect.width < 10 || rect.height < 10) {\n            return;\n        }\n        let sw = dw / rect.width;\n        let sh = dh / rect.height;\n        if (sw >= sh) {\n            rect.width *= ++sw;\n            rect.height *= sw;\n        } else {\n            rect.width *= ++sh;\n            rect.height *= sh;\n        }\n        scaleX = rect.x + rect.width;\n        scaleY = rect.y + rect.height;\n        onChangeRect(rect);\n        props.ctrlData.rect = { ...rect };\n        props.ctrlData.refObj.data.rect = { ...rect }\n        selEle.style.left = `${rect.x}px`;\n        selEle.style.top = `${rect.y}px`;\n        selEle.style.width = `${rect.width}px`;\n        selEle.style.height = `${rect.height}px`;\n    }\n\n    window.onkeydown = (e) => {\n        if (state.refObj && divEle.current && e.keyCode === 8) {\n            deleteEle();\n        }\n    };\n\n    window.addEventListener('mouseup', () => {\n        isScale = false;\n        isDrag = false;\n        dragX = 0;\n        dragY = 0;\n        scaleX = 0;\n        scaleY = 0;\n    }, true);\n\n    ctrlMouseMove = (e) => {\n        if (isDrag) {\n            localDragMove(e);\n        } else if (isScale) {\n            localScale(e);\n        }\n    }\n\n    \n    window.addEventListener('mousemove', ctrlMouseMove, true);\n\n    if (props.ctrlData.autoPress) {\n        isDrag = true;\n        dragX = props.ctrlData.hit.x;\n        dragY = props.ctrlData.hit.y;\n    }\n\n\n    const deleteEle = () => {\n        props.ctrlData.refObj.data.isDelete = true;\n        props.sortMediaElements();\n        props.hitTestOperate({\n            ctrlData: {\n                refObj: null,\n                eleType: 'cell',\n                hit: { x: 60, y: 22 },\n                rect: {\n                    x: 60,\n                    y: 22,\n                    r: 0,\n                    width: 60,\n                    height: 22\n                },\n                preRect: {\n                    x: 60,\n                    y: 22,\n                    r: 0,\n                    width: 60,\n                    height: 22\n                }\n            }\n        })\n        selEle = null;\n        props.ctrlData.refObj = null;\n        // selEle.parentElement.removeChild(selEle)\n        divEle.current = null;\n    }\n\n    return (\n        //contentEditable=\"true\"\n        //pointer-events: none; 忽略所有鼠标事件\n        <div autoFocus ref={divEle}\n            tabIndex={0}\n            user-select='none'\n            webkit-user-select=\"none\"\n            style={{\n                ...mystyle,\n                border: '2.2px solid #1890ff',\n                contentEditable: true,\n                zIndex: 99999\n            }}\n            onClick={stopEvent}\n            onMouseDown={(e) => {\n                stopEvent(e);\n                if (display === 'block' && state.refObj) {\n                    isDrag = true;\n                    props.ctrlData.refObj.data.rect = { ...props.ctrlData.rect }\n                    let hit = getOperatePositon(e.clientX, e.clientY)\n                    props.ctrlData.hit = { ...hit }\n                    dragX = hit.x;\n                    dragY = hit.y;\n                }\n            }}\n            onMouseMove={(e) => {\n                stopEvent(e);\n            }}\n            onMouseUp={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n                isDrag = false;\n                dragX = 0;\n                dragY = 0;\n            }}\n        >\n            <div className='media-scale-btn'\n                onMouseDown={e => {\n                    isDrag = false;\n                    isScale = true;\n                    let hit = getOperatePositon(e.clientX, e.clientY)\n                    scaleX = hit.x;\n                    scaleY = hit.y;\n                    //console.log('<div className=media-scale-btn')\n                    stopEvent(e);\n                }}\n            >\n            </div>\n        </div>\n    );\n}\n\nMediaController.propTypes = {\n    ctrlData: PropTypes.object.isRequired,\n    hitTestOperate: PropTypes.func.isRequired,\n    sortMediaElements: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => {\n        return {\n            ctrlData: state.ctrlData,\n        }\n    },\n    { sortMediaElements, hitTestOperate }\n)(MediaController);\n\n//export default MediaController;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ExcelSheet from './excel-sheet'\nimport UserHeader from './user-header'\nimport ToolsHeader from './tools-header'\nimport ToolsFooter from './tools-footer'\nimport cookie from 'react-cookies'\nimport { connect } from 'react-redux'\nimport { receiveUserInfo } from '../../redux/login/actions'\nimport {\n    changedExcelSize,\n    hitTestOperate,\n    addDragImage\n} from '../../redux/workplace/actions'\nimport {\n    scrollData,\n    headerData,\n    getStampId,\n    getOperatePositon,\n} from './current-operate'\nimport MediaContainer from './media-container'\nimport CellController from './controllers/cell-controller'\nimport MediaController from './controllers/media-controller'\nimport '../../static/css/main-workplace.css'\n\n\nclass MainWorkplace extends React.Component {\n    constructor(props) {\n        super(props);\n        let loginCookie = cookie.load('loginCookie');\n        if (loginCookie !== undefined) {\n            var jstr = window.atob(loginCookie)\n            let login = JSON.parse(jstr);\n            if (login.userInfo.username !== undefined) {\n                this.props.receiveUserInfo(login);\n            }\n        }\n        this.getController();\n    }\n\n    currentController = null;\n    mediaElements = [];\n\n    componentDidMount() {\n        if (this.props.login.userInfo.username === undefined) {\n            this.props.history.replace('/excel-web/login/github')\n        }\n        let toolHeaderBox = document.getElementById(\"toolHeaderId\");\n        if (toolHeaderBox) {\n            this.toolsHeaderOffsetHeight = toolHeaderBox.offsetHeight\n            headerData.offsetHeight = toolHeaderBox.offsetHeight\n            //console.log(this.toolsHeaderOffsetHeight)\n        }\n    }\n\n    getController = () => {\n        if (this.props.ctrlData.eleType === 'cell') {\n            if (this.currentController && this.currentController instanceof CellController) {\n                //this.currentController.props.ctrlData\n                //console.log(this.currentController)\n            }\n            this.currentController = (<CellController ctrlData={{ ...this.props.ctrlData }} />)\n        } else if (this.props.ctrlData.eleType === 'media') {\n            this.currentController = (<MediaController ctrlData={{ ...this.props.ctrlData }} />)\n        }\n        return this.currentController;\n    }\n\n    getScrollData = (e) => {\n        scrollData.offsetX = e.target.scrollLeft;\n        scrollData.offsetY = e.target.scrollTop;\n    }\n\n    hitOperateLayerHandle = (e) => {\n        this.ignoreDrag(e)\n        e.target.focus();\n        let hit = getOperatePositon(e.clientX, e.clientY);\n        if (e.clientX > this.props.excelSheet.width\n            || e.clientY > this.props.excelSheet.height) {\n            return;\n        }\n        let ctrlData = { ...this.props.ctrlData };\n        ctrlData.preRect = { ...this.props.ctrlData.preRect };\n        ctrlData.rect = { ...this.props.ctrlData.rect };\n        ctrlData.refObj = null;\n        ctrlData.hit = hit;\n        ctrlData.eleType = 'cell'\n        this.props.hitTestOperate({\n            ctrlData\n        })\n    }\n\n    ignoreDrag = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n    }\n\n    dropInHandle = (event) => {\n        this.ignoreDrag(event);\n        let files = event.dataTransfer.files;\n        let file = files[0];\n        if (file) {\n            let reader = new FileReader();\n            let pos = getOperatePositon(event.clientX, event.clientY)\n            let add = this.props.addDragImage;\n            let exts = file.name.split('.');\n            reader.onload = function (e) {\n                add({\n                    id: getStampId(),\n                    fileType: 'img',\n                    ext: exts[exts.length - 1],\n                    src: e.target.result,\n                    location: pos,\n                    zIndex: 9990,\n                    autoSeleted: true\n                })\n            }\n            reader.readAsDataURL(file);\n        }\n    }\n    //功能增多后，主界面需要 shouldComponentUpdate 优化\n    render() {\n        return (\n            <div className='excel-main'>\n                <div className='tool-header' id='toolHeaderId'>\n                    <UserHeader />\n                    <ToolsHeader />\n                </div>\n                <div className='content-main' id='contentMainId' onScroll={this.getScrollData}>\n                    <div className='excel-container'>\n                        <div className='excel-component'\n                            style={{\n                                width: this.props.excelSheet.width + 300,\n                                height: parseInt(this.props.excelSheet.height) + 300\n                            }} >\n                            <ExcelSheet />\n                            <div className='operateLayer' id='operateLayerId'\n                                //屏蔽点击穿透！\n                                onClick={e => this.ignoreDrag(e)}\n                                onContextMenu={e => this.ignoreDrag(e)}\n                                onMouseDown={this.hitOperateLayerHandle}\n                                onDragEnter={this.ignoreDrag}\n                                onDragOver={(event => {\n                                    this.ignoreDrag(event)\n                                })}\n                                onDrop={this.dropInHandle}\n                            >\n                                <MediaContainer />\n                                {/* <CellController ctrlData={this.props.ctrlData} />\n                                <MediaController ctrlData={this.props.ctrlData} /> */}\n                                {this.getController()}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div className='tool-footer-container'>\n                    <ToolsFooter />\n                </div>\n            </div>\n        )\n    }\n}\n\nMainWorkplace.propTypes = {\n    history: PropTypes.object.isRequired,\n    login: PropTypes.object.isRequired,\n    excelSheet: PropTypes.object.isRequired,\n    ctrlData: PropTypes.object.isRequired,\n    gridDatas: PropTypes.object.isRequired,\n    receiveUserInfo: PropTypes.func.isRequired,\n    changedExcelSize: PropTypes.func.isRequired,\n    hitTestOperate: PropTypes.func.isRequired,\n    addDragImage: PropTypes.func.isRequired,\n}\n\nexport default connect(\n    state => (state),\n    {\n        receiveUserInfo,\n        changedExcelSize,\n        hitTestOperate,\n        addDragImage\n    }\n)(MainWorkplace);\n\n","import React from 'react';\nimport MainLogin from './components/login/main-login'\nimport MainWorkplace from './components/workplace/main-workplace'\nimport { Route, Switch, Redirect } from 'react-router-dom'\nimport './App.css';\n\n\nclass App extends React.Component {\n  render() {\n    return (< div className=\"App\" >\n      < Switch >\n        < Route path='/excel-web/sheet' component={MainWorkplace} />\n        < Route path='/excel-web/login' component={MainLogin} />\n        < Redirect to='/excel-web/login' />\n      </Switch >\n    </div >\n    );\n  }\n}\n\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { DINGDING_LOGIN, GITHUB_LOGIN, USER_LOGOUT, RECEIVE_USER_INFO } from './action-types';\nimport cookie from 'react-cookies'\n\n\nconst initState = { userInfo: { errcode: 0 } };\n\nfunction login(state = initState, action) {\n  switch (action.type) {\n    //login的状态触发由receive完成\n    case DINGDING_LOGIN: \n      return state;\n    case GITHUB_LOGIN:\n      return state;\n    case USER_LOGOUT:\n      //删除缓存的额cookie，把状态设置为初始值\n      cookie.remove('loginCookie', { path: '/' });\n      return { ...initState };\n    case RECEIVE_USER_INFO:\n      // 这里的case要用大括号，防止变量穿透，由eslint报错提醒\n      {\n        let ret = { ...action.data };\n        if (action.data.errcode !== undefined) {\n          ret.userInfo.errcode = action.data.errcode;\n        }\n        else {\n          ret.userInfo.errcode = 0;\n        }\n        return { ...ret };\n      }\n    default:\n      return { ...state };\n  }\n}\n\nexport default login;","import { CHANGED_EXCEL_SIZE } from './action-types'\n\nconst initSize = { width: 0, height: 0 }\n\nconst excelSheet = (state = initSize, action) => {\n    switch (action.type) {\n        case CHANGED_EXCEL_SIZE:\n            return {...action.data }\n        default:\n            return state;\n    }\n}\n\nexport default excelSheet;","import {\n    ADD_EXCEL_SHEET,\n    REMOVE_EXCEL_SHEET,\n    CHANGE_EXCEL_SHEET_NAME,\n    CHANGE_EXCEL_SHEET_SELECTED,\n    DOWNLOAD_EXCEL,\n    GET_SELECTED_GRID,\n    ADD_DRAG_IMAGE,\n    SORT_MEDIA_ELEMENTS,\n    COMMIT_UPDATE_GRIDDATAS\n} from './action-types'\nimport Excel from 'exceljs';\nimport FileSaver from 'file-saver'\n\nconst defaultCellSize = {\n    width: 60,\n    height: 22\n}\n\nconst getPositionStrX = (inputX) => {\n    if (inputX < 0) {\n        throw Error('Error getPositionStrX inputX < 0')\n    }\n    let codeA = 'A'.charCodeAt(0);\n    let inX = inputX + 1;\n    let x = ''\n    do {\n        let numIdx = inX - 1;\n        let ascIdx = numIdx % 26;\n        x = String.fromCharCode(codeA + ascIdx) + x;\n        inX = parseInt(numIdx / 26);\n    }\n    while (inX > 0)\n    return x;\n}\n\nconst getCoordinates = (positionStr) => {\n    const row = positionStr.match(/[0-9]+/g) || [];\n    const col = positionStr.match(/[A-Z]+/g) || [];\n\n    if (row.length === 1 && col.length === 1) {\n        let colstr = col[0].toString();\n        let baseCode = 'A'.charCodeAt();\n        let colno = 0;\n        for (let index = 0; index < colstr.length; index++) {\n            const charIdx = colstr[index].charCodeAt() - baseCode + 1;\n            let temp = (Math.pow(26, colstr.length - index - 1) * charIdx)\n            colno += temp;\n        }\n        // x列 y行\n        return { x: colno - 1, y: parseInt(row[0]) - 1 }\n    }\n}\n\n\nconst createBlankGridData = (isTest) => {\n    let initGrid = [];\n    for (let row = 0; row < 1001; row++) {\n        initGrid.push([]);\n        for (let col = 0; col < 32; col++) {\n            if (row === 0 && col === 0) {\n                initGrid[0].push({ readOnly: true, value: '' })\n            } else if (row === 0 && col > 0) {\n                let colstr = getPositionStrX(col - 1);\n                initGrid[0].push({ readOnly: true, value: colstr })\n            } else if (row > 0 && col === 0) {\n                initGrid[row].push({ readOnly: true, value: row })\n            } else {\n                //坐标测试验证\n                if (isTest) {\n                    if (row > 0 && col > 0) {\n                        var coor = getCoordinates(initGrid[0][col].value + row)\n                        initGrid[row].push({ value: `(${coor.x}, ${coor.y})` })\n                    }\n                } else {\n                    initGrid[row].push({ value: `` })\n                }\n            }\n        }\n    }\n    return initGrid;\n}\n\n\nconst download = (dic) => {\n    const wb = new Excel.Workbook();\n    for (let key in dic) {\n        const ws = wb.addWorksheet(dic[key].name);\n        ws.properties.defaultRowHeight = 17;\n        //这里行列不能搞混\n        let rowcount = dic[key].grid.length;\n        let colcount = dic[key].grid[0].length;\n\n        for (let rowidx = 1; rowidx < rowcount; rowidx++) {\n            for (let colidx = 1; colidx < colcount; colidx++) {\n                let row = ws.getRow(rowidx)\n                if (!row) {\n                    let rowdata = new Array(colcount).fill('');\n                    ws.addRow(rowdata);\n                    row = ws.getRow(rowidx)\n                }\n                row.height = 17;\n                row.getCell(colidx).value = dic[key].grid[rowidx][colidx].value;\n            }\n        }\n        //add image\n        if (dic[key].media.length > 0) {\n            let media = dic[key].media;\n            for (let index = 0; index < dic[key].media.length; index++) {\n                let imageId = wb.addImage({\n                    base64: media[index].src,\n                    extension: media[index].ext,\n                });\n                //console.log(media[index])\n                let tl = { col: 2, row: 2 }\n                let br = { col: 6, row: 5 }\n                if (media[index].rect) {\n                    tl.col = media[index].rect.x / defaultCellSize.width - 1;\n                    tl.row = media[index].rect.y / defaultCellSize.height - 1;\n                    br.col = (media[index].rect.x + media[index].rect.width) / defaultCellSize.width - 1;\n                    br.row = (media[index].rect.y + media[index].rect.height) / defaultCellSize.height - 1;\n                    tl.col = tl.col < 0 ? 0 : tl.col;\n                    tl.row = tl.row < 0 ? 0 : tl.row;\n                    br.col = br.col < 0 ? 5 : br.col;\n                    br.row = br.row < 0 ? 5 : br.row;\n                }\n                ws.addImage(imageId, { tl, br, editAs: 'oneCell' });\n            }\n        }\n\n    }\n\n    //网上的a标签+blob下载的例子会文件损坏，原因不明。\n    wb.xlsx.writeBuffer()\n        .then(buffer => FileSaver.saveAs(new Blob([buffer]), `excel-web${Date.now()}.xlsx`))\n        .catch(err => console.log('Error writing excel export', err))\n}\n\n\nconst getStamp = () => (new Date().getTime().toString() + parseInt(Math.random() * 100))\n\n/*\nmedia[]\n{\nfileType: 'img',\next:'png'\nsrc: e.target.result,\nlocation: pos,\nzIndex: 9990\n}\n*/\nconst initGridDatas = () => {\n    //字典\n    let dic = new Array();\n    let key1 = getStamp()\n    dic[key1] = {\n        name: 'Sheet1',\n        grid: createBlankGridData(false),\n        media: [],\n    }\n    dic[getStamp()] = {\n        name: 'Sheet2',\n        grid: createBlankGridData(true),\n        media: [],\n    }\n    return {\n        dic,\n        selectedKey: key1,\n        length: 2\n    };\n\n}\n\nconst blankData = initGridDatas();\n\nconst gridDatas = (state = blankData, action) => {\n    //console.log(\"gridDatas\", action);\n    switch (action.type) {\n        case ADD_EXCEL_SHEET:\n            {\n                let addstate = { ...(state) }\n                let nameidx = addstate.length + 1;\n                //sheetname 不能重复，否则download会报错\n                for (let asKey in addstate.dic) {\n                    if (addstate.dic[asKey].name === ('Sheet' + nameidx)) {\n                        nameidx++;\n                    }\n                }\n                let addkey = getStamp();\n                addstate.dic[addkey] = {\n                    grid: createBlankGridData(),\n                    name: 'Sheet' + nameidx,\n                    media: [],\n                };\n                addstate['selectedKey'] = addkey;\n                addstate.length += 1;\n                return addstate;\n            }\n        case REMOVE_EXCEL_SHEET:\n            {\n                //至少需要存在一张表\n                if (state.length < 2) {\n                    return state;\n                }\n                let rmdic = new Array();\n                let wouldSelect = undefined;\n                if (action.data.key !== state.selectedKey) {\n                    wouldSelect = state.selectedKey;\n                }\n                let hasRemove = false;\n                for (let key in state.dic) {\n                    if (key !== action.data.key) {\n                        rmdic[key] = state.dic[key]\n                        if (!wouldSelect) { wouldSelect = key }\n                        continue;\n                    }\n                    hasRemove = true;\n                }\n                if (hasRemove) {\n                    return {\n                        dic: rmdic,\n                        selectedKey: wouldSelect,\n                        length: state.length - 1\n                    };\n                }\n                return state;\n            }\n        case CHANGE_EXCEL_SHEET_NAME:\n            {\n                let changeState = { ...state }\n                if (state[action.data.key]) {\n                    changeState.dic[action.data.key].name =\n                        action.data.name;\n                    return changeState;\n                }\n                return state;\n            }\n        case CHANGE_EXCEL_SHEET_SELECTED:\n            {\n                let selectedState = { ...state }\n                if (selectedState['selectedKey']) {\n                    selectedState['selectedKey'] =\n                        action.data.key;\n                    return selectedState;\n                }\n                return state;\n            }\n        case DOWNLOAD_EXCEL:\n            {\n                download(state.dic)\n                return state;\n            }\n        case GET_SELECTED_GRID:\n            {\n                return state;\n            }\n        case ADD_DRAG_IMAGE:\n            {\n                let key = state['selectedKey'];\n                if (key) {\n                    let dic = state.dic[key];\n                    dic.media.push(action.data);\n                    dic.media = [...dic.media]\n                }\n                return state;\n            }\n        case SORT_MEDIA_ELEMENTS:\n            {\n                let key = state['selectedKey'];\n                if (key) {\n                    let dic = state.dic[key];\n                    //删除\n                    let deleteIdx = dic.media.findIndex(e => {\n                        return e.isDelete;\n                    })\n                    if (deleteIdx > -1) {\n                        //拼接此元素的前后部分\n                        dic.media = dic.media.slice(0, deleteIdx)\n                            .concat(dic.media.slice(deleteIdx + 1, dic.media.length));\n                    }\n                    //排序正常\n                    dic.media.sort((a, b) => (a.zIndex - b.zIndex));\n                    let hasChange = false;\n                    for (let idx = 0; idx < dic.media.length; idx++) {\n                        if (dic.media[idx].zIndex !== idx) {\n                            hasChange = true;\n                        }\n                        dic.media[idx].zIndex = idx;\n                    }\n                    if (!hasChange || dic.media.length < 2) {\n                        return state;\n                    }\n                    //dic.media = [...dic.media]\n                }\n                return state;\n            }\n        case COMMIT_UPDATE_GRIDDATAS:\n            {\n                return { ...state }\n            }\n        default:\n            return state;\n    }\n}\n\nexport default gridDatas;","import {\n    HIT_TEST_OPERATE\n} from './action-types'\n\n\nconst defaultCellSize = {\n    width: 60,\n    height: 22\n}\n\nconst initData = {\n    refObj: null,\n    eleType: 'cell',\n    hit: { x: 60, y: 22 },\n    rect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        ...defaultCellSize\n    },\n    preRect: {\n        x: 60,\n        y: 22,\n        r: 0,\n        ...defaultCellSize\n    },\n    coord: { rowIdx: 1, colIdx: 1 }\n}\n\nfunction locateVertical(defaultHeight, heights, offsetY) {\n    let changedCount = heights.length;\n    let changedOffset = 0;\n    for (let i = 0; i < changedCount; i++) {\n        changedOffset += heights[i][1];\n        // 之前的默认row height\n        let defaultoffset = (heights[i][0] - i) * defaultHeight;\n        // 检查是否超过offsetY\n        let checkoffset = (changedOffset + defaultoffset) - offsetY;\n        if (checkoffset >= 0) {\n            // 平齐\n            if (checkoffset === 0) {\n                return heights[i][0] + 1;\n            }\n            // 落在改变区间内\n            else if (checkoffset < heights[i][1]) {\n                return heights[i][0];\n            }\n            // 落在改变区间外\n            else {\n                // 当前的row坐标 - 多余的defaultHeight个数\n                return heights[i][0] - Math.ceil((checkoffset - heights[i][1]) / defaultHeight, 0);\n            }\n        }\n    }\n    let defaultOffset = offsetY - changedOffset;\n    let defaultCount = defaultOffset / defaultHeight;\n    let localPositionY = defaultCount + changedCount;\n    return parseInt(localPositionY)\n}\n\nfunction locateHorizontal(defaultWidth, widths, offsetX) {\n    let changedCount = widths.length;\n    let changedOffset = 0;\n    for (let i = 0; i < changedCount; i++) {\n        changedOffset += widths[i][1];\n        let defaultoffset = (widths[i][0] - i) * defaultWidth;\n        let checkoffset = (changedOffset + defaultoffset) - offsetX;\n        if (checkoffset >= 0) {\n            if (checkoffset === 0) {\n                return widths[i][0] + 1;\n            }\n            else if (checkoffset < widths[i][1]) {\n                return widths[i][0];\n            }\n            else {\n                return widths[i][0] - Math.ceil((checkoffset - widths[i][1]) / defaultWidth, 0);\n            }\n        }\n    }\n    let defaultOffset = offsetX - changedOffset;\n    let defaultCount = defaultOffset / defaultWidth;\n    let localPositionX = defaultCount + changedCount;\n    return parseInt(localPositionX)\n}\n\n\nconst ctrlData = (state = initData, action) => {\n    switch (action.type) {\n        case HIT_TEST_OPERATE:\n            {\n                //注意引用\n                state.refObj = null;\n                state.preRect = state.rect;\n                state.eleType = action.data.ctrlData.eleType;\n                if (action.data.ctrlData.eleType === 'cell') {\n                    let idxH = locateHorizontal(defaultCellSize.width, [], action.data.ctrlData.hit.x);\n                    let idxV = locateVertical(defaultCellSize.height, [], action.data.ctrlData.hit.y);\n                    //不允许选中\n                    if(idxH < 1 || idxV < 1){\n                        return state;\n                    }\n                    // 将来要改成实际宽高\n                    let x = idxH * defaultCellSize.width;\n                    let y = idxV * defaultCellSize.height;\n                    let width = defaultCellSize.width;\n                    let height = defaultCellSize.height;\n                    state.rect = { x, y, width, height }\n                    state.coord = { rowIdx: idxV, colIdx: idxH }\n\n                } else if (action.data.ctrlData.eleType === 'media') {\n                    state.refObj = {...action.data.ctrlData.refObj};\n                    state.rect = { ...action.data.ctrlData.rect }\n                    state.autoPress = action.data.ctrlData.autoPress;\n                    state.hit = {...action.data.ctrlData.hit}\n                }\n                \n                return { ...state }\n            }\n        default:\n            return state;\n    }\n}\n\nexport default ctrlData;\n\n\n\n\n\n\n//cell 只有位置，拖拽为框选（宽高+位置），无缩放\n//image 交互，有缩放，有位移，有旋转\n\n\n","import { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nimport login from './login/reducers'\nimport excelSheet from './workplace/reducers'\nimport gridDatas from './workplace/reducers-grid-datas'\nimport  ctrlData  from './workplace/reducers-operate'\n\nimport { combineReducers } from 'redux'; //用于合并多个模块的reducers\n\n\n\n\nexport default createStore(\n    combineReducers({ login, excelSheet, gridDatas, ctrlData }),\n    applyMiddleware(thunk) // 应用异步中间件\n)","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter } from 'react-router-dom'\nimport { Provider } from 'react-redux'\n\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\n//绑定时会默认调用\nimport store from './redux/store'\n\n\nReactDOM.render(\n\n  <Provider store={store}> \n    <BrowserRouter>\n      <App />\n    </BrowserRouter>\n  </Provider>\n\n  ,\n  document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}